<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: ALICEO2dataModel converter</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d5/da8/md__home_runner_work_AliceO2_AliceO2_scripts_datamodel-doc_README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ALICEO2dataModel converter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Allows to create an html representation of the ALICE O2 data model. The generated html code can be inserted in docs/datamodel/[ao2dTables, helperTaskTables, pwgTables, joinsAndIterators].md of <a href="https://github.com/AliceO2Group/analysis-framework/">https://github.com/AliceO2Group/analysis-framework/</a>.</p>
<h1>Internals</h1>
<p>The ALICE O2 Data Analysis Framework is based on a number of flat tables which contain the experimental data. The tables are declared in several header files. Some of the tables are filled automatically when an AO2D file is processed others are filled by specific tasks.</p>
<p>The ALICEO2dataModel converter analyses these header and task code files and extracts the table and column definitions of the tables. The information is converted into a html representation which can be included in the documentation site of the O2 Analysis Framework at <a href="https://github.com/AliceO2Group/analysis-framework/">https://github.com/AliceO2Group/analysis-framework/</a>.</p>
<p>The converter is implemented in python and consists of the python modules extractDataModel.py, ALICEO2dataModelTools.py, ALICEO2includeFile.py, ALICEO2codeFile.py. The process is configured with inputCard.xml.</p>
<h2>Data Items</h2>
<p>Three types of files are considered to contain information related to the ALICE O2 Data Analysis <a class="el" href="../../d6/d18/classModel.html">Model</a>:</p>
<ul>
<li>header files</li>
<li>code files</li>
<li>CMakeLists.txt</li>
</ul>
<h3><a class="el" href="../../dc/d47/structHeader.html">Header</a> files</h3>
<p><a class="el" href="../../dc/d47/structHeader.html">Header</a> files are combed for definitions of:</p>
<ul>
<li>namespace</li>
<li>#define</li>
<li>typedef</li>
<li>using</li>
<li>COLUMN declarations</li>
<li>TABLE declarations</li>
</ul>
<p>In a first step the header files are scanned and comments (//) and comment blocks (/* ... */) are removed, whereas special comments (//!) are understood to be annotations of tables and columns. Blocks of line extensions () are reduced to a single line.</p>
<p>In the such processed text #define directives are searched for and are used to substitute related text in the block starting with the actual #define directive and ending with an #undef directive or the end of the text.</p>
<p>In a next processing round the text is split into namespaces, taking into account that namespaces can be nested. Namespaces are defined either with 'using namespace ...;' which is then active until the end of the text or with 'namespace {....}' which makes the namespace active only within the curled brackets. The splitting into namespaces is implemented in an iterative way.</p>
<p>The text contained in a singular namespace (namespace not containing any other namespace) is searched for typedef specifiers which are used to substitute related types. Then column and table declarations and finally 'using' directives within the namespace block are extracted.</p>
<p>As a result of this procedure one obtains a 'datamodel' object with a list of namespaces with their column and table declarations and using directives.</p>
<h3>Code files</h3>
<p>Code files are combed for definitions of:</p>
<ul>
<li>template</li>
<li>struct</li>
<li>Produces</li>
</ul>
<p>Tables have a producer. In case of the tables filled with data from the AO2D files the producer is defined to be AO2D. For tables which are filled by analysis tasks the producer is deduced from the related Produces function declaration. The code files are scanned for Produces declarations and the name of the code file is added to the respective table in the previously described 'datamodel' object. It is taken into account, that Produces can be within templated blocks.</p>
<h3>CMakeLists.txt files</h3>
<p>CMakeLists.txt files are combed for definitions of:</p>
<ul>
<li>o2_add_dpl_workflow (executables and the related code files)</li>
</ul>
<p>The CMakeLists files are finally needed to relate a given code file with an executable, which allows to associate a table with its producing executable.</p>
<h2>Output</h2>
<p>The html representation of the 'datamodel' object is achieved with the printHTML method.</p>
<h1>As simple as that</h1>
<ul>
<li>Install the software</li>
</ul>
<p>Clone O2 as usual. Go to scripts/datamodel-doc</p>
<ul>
<li>Adapt inputCard.xml</li>
</ul>
<p>Set the pathes in tags O2general/mainDir/[O2local, O2Physicslocal] to the actual O2 installation path, e.g. /home/me/alice/[O2, O2Physics] unless you run from the directory scripts/datamodel-doc. The other parameters should fit.</p>
<ul>
<li>Run it</li>
</ul>
<p>./extractDataModel.py &gt; htmloutput.txt</p>
<ul>
<li>Update the markdown files with the content of htmloutput.txt.</li>
</ul>
<h2>Update the markdown files automatically</h2>
<p>The python script mdUpdate.py allows to update the contents of the md files automatically.</p>
<p>mdUpdate.py takes four arguments:</p>
<p>Usage: mdUpdate.py cc fn2u fnold fnnew</p>
<p>cc: 1: AO2D, 2: Helpers, 3: PWG tables, 4: Joins</p>
<p>fn2u: file with new text</p>
<p>fnold: file with old text</p>
<p>fnnew: file with replaced text</p>
<p>mdUpdate.py replaces in file fnold the block of text which is delimited by two lines containing a delimiter string. The block of text is replaced by the block of text in file fn2u which is delimited by two lines containing the same delimiter string. The resulting text is written to file fnnew. The delimiter string is obtained from the inputCard.xml, depending on the value of cc. If fnnew = fnold, the content of fnold is overwritten.</p>
<p>So to update the md files do:</p>
<ul>
<li>./extractDataModel.py &gt; htmloutput.txt</li>
<li>path2mds=./testing</li>
<li>./mdUpdate.py 1 htmloutput.txt $path2mds/ao2dTables.md $path2mds/ao2dTables.md</li>
<li>./mdUpdate.py 2 htmloutput.txt $path2mds/helperTaskTables.md $path2mds/helperTaskTables.md</li>
<li>./mdUpdate.py 3 htmloutput.txt $path2mds/helperTaskTables.md $path2mds/pwgTables.md</li>
<li>./mdUpdate.py 4 htmloutput.txt $path2mds/joinsAndIterators.md $path2mds/joinsAndIterators.md</li>
</ul>
<h2>For a full automatic update</h2>
<p>In the same directory have O2 cloned to O2 and the documentation (your fork of <a href="https://github.com/AliceO2Group/analysis-framework">https://github.com/AliceO2Group/analysis-framework</a>) in analysis-framework and execute</p>
<p>O2/scripts/datamodel-doc/update-datamodel.sh </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Feb 14 2022 05:41:08 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
