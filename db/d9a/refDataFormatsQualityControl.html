<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Data Formats Quality Control</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('db/d9a/refDataFormatsQualityControl.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Data Formats Quality Control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Data formats for tagging good quality data for analysis.</p>
<h1>Flagging time ranges</h1>
<h2>General idea</h2>
<ul>
<li>Each detector has its own CCDB (QCDB) entry - TimeRangeFlagCollection</li>
<li>The CCDB Entry validity will be run or fill, depending on the final data taking granularity</li>
<li>Each entry can define sub ranges (TimeRangeFlags) of certain data characteristics (FlagReasons) inside the CCDB Entry validity</li>
<li>Flags are defined in a CSV master file, they are used to derive the Data Tags - the final filters for good quality data during analysis.</li>
<li>Data Tag are stored as CCDB entries. They might require different detectors and may suppress different flags dependent on the analysis type.</li>
</ul>
<h2>Implementation</h2>
<p><a href="../../include/DataFormatsQualityControl/FlagReasons.h">Flag Reason</a> is defined with an identifier number, a name and a 'bad quality' determinant. The latter decides if such a flag should mark the data quality as bad by default. FlagReasons can be created only with FlagReasonFactory, so that the list of available reasons is common and centralised. For example: </p><div class="fragment"><div class="line">id: 10</div>
<div class="line">name: Limited Acceptance</div>
<div class="line">bad: true</div>
</div><!-- fragment --><p>The list of available FlagReasons is defined in <a href="../../etc/flagReasons.csv">etc/flagReasons.csv</a>, which is used to generate the corresponding list of methods in FlagReasonFactory. The existing flags should never be modified, except for marking them as obsolete. New flags may be added via pull requests if there is no flag which conveys a similar meaning.</p>
<p>With <a href="../../include/DataFormatsQualityControl/TimeRangeFlag.h">TimeRangeFlags</a> we can define the time range of a chosen FlagReason, add an additional comment and specify the source of this flag. For example: </p><div class="fragment"><div class="line">start: 1612707603626 </div>
<div class="line">end: 1613999652000</div>
<div class="line">flag: Limited Acceptance</div>
<div class="line">comment: Sector B in TPC inactive</div>
<div class="line">source: o2::quality_control_modules::tpc::ClustersCheck</div>
</div><!-- fragment --><p><a href="../../include/DataFormatsQualityControl/TimeRangeFlagCollection.h">TimeRangeFlagCollection</a> contains all TimeRangeFlags for the validity range (run or fill). TimeRangeFlags may overlap, e.g. if they use different FlagReasons and they are sorted by their start time. If certain period does not include any TimeRangeFlags with <em>bad</em> FlagReasons, then the data quality can be considered as good. The <a href="../../test/testTimeRangeFlagCollection.cxx">TimeRangeFlagCollection test</a> shows the usage example.</p>
<p>TimeRangeFlagCollections are supposed to be created automatically with QC Post-processing Tasks based on Quality Objects created by QC Checks. However, they might be created manually by QA experts as well. The procedure to do that has to be defined.</p>
<h2>TODO</h2>
<ul>
<li>Define the complete list of available Flag Reasons</li>
<li>implement CCDB storage and access<ul>
<li>define CCDB storage place e.g.<ul>
<li><code>&lt;Detector&gt;/QC/QualityFlags</code></li>
<li><code>Analysis/QualityFlags/&lt;Detector&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li>Data Tags Definitions and Data Tags</li>
</ul>
<h3>Notes on plans for Data Tags</h3>
<p>Data Tag definition has:</p><ul>
<li>name</li>
<li>global suppression list for bad flag reasons (applies to all detectors)</li>
<li>global requirement list for not bad flag reasons</li>
<li>list of needed detectors,</li>
<li>list of suppression list and requirement list specific to detectors</li>
</ul>
<p>Example configurations </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTrackingLimitedAcceptance&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [&quot;Limited acceptance&quot;, &quot;asdf&quot;],</div>
<div class="line">  &quot;globalRequiredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : [</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot; : &quot;TPC&quot;,</div>
<div class="line">      &quot;ignoredFlags&quot; : [ &quot;Reason X&quot; ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTracking&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [],</div>
<div class="line">  &quot;globalRequiredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : []</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTrackingOnlyLimitedAcceptanceinTPC&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : [</div>
<div class="line">   {</div>
<div class="line">      &quot;name&quot; : &quot;TPC&quot;,</div>
<div class="line">      &quot;requiredFlags&quot; : [ &quot;Limited acceptance&quot; ]</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">]</div>
</div><!-- fragment --><h2>Wishlist / Ideas</h2>
<ul>
<li>executable to add flags to the flag store</li>
<li>executable to extrags the flag store</li>
<li>summary of all masks for one TimeRangeFlagCollection</li>
<li>functionality to extract flags for a specific detector (from CCDB)</li>
<li>cut class to specify detectors and flags which to exclude </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dec/refDataFormats.html">Module &#39;DataFormats&#39;</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:41:07 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
