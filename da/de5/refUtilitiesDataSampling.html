<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Data Sampling</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/de5/refUtilitiesDataSampling.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Data Sampling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Data Sampling</h2>
<p>Data Sampling provides a possibility to sample data in DPL workflows based on certain conditions ( 5% randomly, when a payload is greater than 4234 bytes, etc.). The job of passing the right data is done by a data processor called <code>Dispatcher</code>. <a class="el" href="../../d2/d88/classA.html">A</a> desired data stream is specified in form of Data Sampling Policies, configured by JSON structures (example below) or by using dedicated interface methods (for advanced use). </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: &quot;policy_example1&quot;,              # name of the policy</div>
<div class="line">  &quot;active&quot;: &quot;false&quot;,                    # activation flag</div>
<div class="line">  &quot;machines&quot;: [                         # list of machines where the policy should be run (now ignored)</div>
<div class="line">    &quot;aido2flp1&quot;,</div>
<div class="line">    &quot;aido2flp2&quot;</div>
<div class="line">  ],                                    # list of data that should be sampled, the format is:</div>
<div class="line">                                        # binding1:origin1/description1/subSpec1[;binding2:...]</div>
<div class="line">  &quot;query&quot;: &quot;clusters:TPC/CLUSTERS/0;tracks:TPC/TRACKS/0&quot;,</div>
<div class="line">                                        # optional list of outputspecs for sampled data, matching the query</div>
<div class="line">                                        # if not present or specified, the default format is used</div>
<div class="line">  &quot;outputs&quot;: &quot;sampled_clusters:DS/CLUSTERS/0;sampled_tracks:DS/TRACKS/0&quot;, </div>
<div class="line">  &quot;samplingConditions&quot;: [               # list of sampling conditions</div>
<div class="line">    {</div>
<div class="line">      &quot;condition&quot;: &quot;random&quot;,            # condition type</div>
<div class="line">      &quot;fraction&quot;: &quot;0.1&quot;,                # condition-dependent parameter: fraction of data to sample</div>
<div class="line">      &quot;seed&quot;: &quot;2112&quot;                    # condition-dependent parameter: seed of PRNG</div>
<div class="line">    }</div>
<div class="line">  ],</div>
<div class="line">  &quot;blocking&quot;: &quot;false&quot;                   # should the dispatcher block the main data flow? (now ignored)</div>
<div class="line">}</div>
</div><!-- fragment --><h3>Usage</h3>
<p>One can use Data Sampling either by merging the standalone Data Sampling workflow with other DPL workflows: </p><div class="fragment"><div class="line">o2-workflow-abc | o2-datasampling-standalone --config json://path/to/config.json | o2-workflow-xyz</div>
</div><!-- fragment --><p>...or by incorporating the code below into a DPL workflow which needs sampling: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d78/DataSampling_8h.html">DataSampling/DataSampling.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html">o2::framework</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d0/d74/namespaceo2_1_1utilities.html">o2::utilities</a>;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="../../d4/d0a/barrel-alignment-workflow_8cxx.html#af2efa39a03c019e9852d51f121fe68bb">customize</a>(std::vector&lt;CompletionPolicy&gt;&amp; policies)</div>
<div class="line">{</div>
<div class="line">  DataSampling::CustomizeInfrastructure(policies);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="../../d4/d0a/barrel-alignment-workflow_8cxx.html#af2efa39a03c019e9852d51f121fe68bb">customize</a>(std::vector&lt;ChannelConfigurationPolicy&gt;&amp; policies)</div>
<div class="line">{</div>
<div class="line">  DataSampling::CustomizeInfrastructure(policies);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../db/dd0/runDataProcessing_8h.html">Framework/runDataProcessing.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;DataProcessorSpec&gt; <a class="code" href="../../d4/d0a/barrel-alignment-workflow_8cxx.html#a5114b2078defc8dfdeebada4967b5abe">defineDataProcessing</a>(<a class="code" href="../../d0/dab/classo2_1_1framework_1_1ConfigContext.html">ConfigContext</a> &amp;ctx)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#abb626288af6d80ecfbc5d647bacb16cc">WorkflowSpec</a> workflow;</div>
<div class="line"><span class="comment">// &lt;declaration of other DPL processors&gt;</span></div>
<div class="line"> </div>
<div class="line"> DataSampling::GenerateInfrastructure(workflow, <span class="stringliteral">&quot;json:///absolute/path/to/config/file.json&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">return</span> workflow;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Sampled data can be subscribed to by adding <code>InputSpecs</code> provided by <code>std::vector&lt;InputSpec&gt; DataSampling::InputSpecsForPolicy(const std::string&amp; policiesSource, const std::string&amp; policyName)</code> to a chosen data processor. Then, they can be accessed by the bindings specified in the configuration file. Dispatcher adds a <code>DataSamplingHeader</code> to the header stack, which contains statistics like total number of evaluated/accepted messages for a given Policy or the sampling time since epoch. If no sampling policies are specified, Dispatcher will not be spawned.</p>
<p>The <a href="https://github.com/AliceO2Group/AliceO2/blob/dev/Utilities/DataSampling/test/dataSamplingPodAndRoot.cxx">o2-datasampling-pod-and-root</a> workflow can serve as a usage example.</p>
<h2>Data Sampling Conditions</h2>
<p>The following sampling conditions are available. When more than one is used, a positive decision is taken when all the conditions are fulfilled.</p><ul>
<li><b>DataSamplingConditionRandom</b> - pseudo-randomly accepts specified fraction of incoming messages. Use seed "0" to have it randomly selected. The "timesliceId" parameter selects the header value that is used to select the message, the available options are "startTime" (default), "tfCounter" and "firstTForbit". <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;condition&quot;: &quot;random&quot;,</div>
<div class="line">  &quot;fraction&quot;: &quot;0.1&quot;,</div>
<div class="line">  &quot;seed&quot;: &quot;22222&quot;,</div>
<div class="line">  &quot;timesliceId&quot;: &quot;startTime&quot;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>DataSamplingConditionNConsecutive</b> - approves n consecutive samples in defined cycle. It assumes that timesliceID always increments by one. <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;condition&quot;: &quot;nConsecutive&quot;,</div>
<div class="line">  &quot;samplesNumber&quot;: &quot;3&quot;,</div>
<div class="line">  &quot;cycleSize&quot;: &quot;100&quot;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>DataSamplingConditionPayloadSize</b> - approves messages having payload size within specified boundaries. <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;condition&quot;: &quot;payloadSize&quot;,</div>
<div class="line">  &quot;lowerLimit&quot;: &quot;300&quot;,</div>
<div class="line">  &quot;upperLimit&quot;: &quot;500&quot;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>DataSamplingConditionCustom</b> - loads a custom condition, which should inherit from DataSamplingCondition, from a specified library. <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;condition&quot;: &quot;custom&quot;,</div>
<div class="line">  &quot;moduleName&quot;: &quot;QcExample&quot;,</div>
<div class="line">  &quot;className&quot;: &quot;o2::quality_control_modules::example::ExampleCondition&quot;,</div>
<div class="line">  &quot;customParam&quot;: &quot;value&quot;</div>
<div class="line">}</div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aDataSampling_8h_html"><div class="ttname"><a href="../../d7/d78/DataSampling_8h.html">DataSampling.h</a></div><div class="ttdoc">Definition of O2 Data Sampling, v1.0.</div></div>
<div class="ttc" id="abarrel-alignment-workflow_8cxx_html_af2efa39a03c019e9852d51f121fe68bb"><div class="ttname"><a href="../../d4/d0a/barrel-alignment-workflow_8cxx.html#af2efa39a03c019e9852d51f121fe68bb">customize</a></div><div class="ttdeci">void customize(std::vector&lt; o2::framework::CallbacksPolicy &gt; &amp;policies)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0a/barrel-alignment-workflow_8cxx_source.html#l00039">barrel-alignment-workflow.cxx:39</a></div></div>
<div class="ttc" id="arunDataProcessing_8h_html"><div class="ttname"><a href="../../db/dd0/runDataProcessing_8h.html">runDataProcessing.h</a></div></div>
<div class="ttc" id="anamespaceo2_1_1framework_html_abb626288af6d80ecfbc5d647bacb16cc"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#abb626288af6d80ecfbc5d647bacb16cc">o2::framework::WorkflowSpec</a></div><div class="ttdeci">std::vector&lt; DataProcessorSpec &gt; WorkflowSpec</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d63/HBFUtilsInitializer_8h_source.html#l00036">HBFUtilsInitializer.h:36</a></div></div>
<div class="ttc" id="abarrel-alignment-workflow_8cxx_html_a5114b2078defc8dfdeebada4967b5abe"><div class="ttname"><a href="../../d4/d0a/barrel-alignment-workflow_8cxx.html#a5114b2078defc8dfdeebada4967b5abe">defineDataProcessing</a></div><div class="ttdeci">WorkflowSpec defineDataProcessing(ConfigContext const &amp;configcontext)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0a/barrel-alignment-workflow_8cxx_source.html#l00072">barrel-alignment-workflow.cxx:72</a></div></div>
<div class="ttc" id="aclasso2_1_1framework_1_1ConfigContext_html"><div class="ttname"><a href="../../d0/dab/classo2_1_1framework_1_1ConfigContext.html">o2::framework::ConfigContext</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d2e/ConfigContext_8h_source.html#l00025">ConfigContext.h:25</a></div></div>
<div class="ttc" id="anamespaceo2_1_1utilities_html"><div class="ttname"><a href="../../d0/d74/namespaceo2_1_1utilities.html">o2::utilities</a></div><div class="ttdoc">A header which contains some meta-data generated by Data Sampling.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d78/DataSampling_8h_source.html#l00037">DataSampling.h:37</a></div></div>
<div class="ttc" id="anamespaceo2_1_1framework_html"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html">o2::framework</a></div><div class="ttdoc">Defining PrimaryVertex explicitly as messageable.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/Digits_8h_source.html#l00074">Digits.h:74</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d4/d23/refUtilities.html">Module &#39;Utilities&#39;</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:41:08 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
