<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/runner/work/AliceO2/AliceO2/Detectors/TPC/spacecharge/src/SpaceCharge.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d8e/SpaceCharge_8cxx_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SpaceCharge.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/d8e/SpaceCharge_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2019-2020 CERN and copyright holders of ALICE O2.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// See https://alice-o2.web.cern.ch/copyright for details of the copyright holders.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// All rights not expressly granted are reserved.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This software is distributed under the terms of the GNU General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License v3 (GPL Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/db6/SpaceCharge_8h.html">TPCSpaceCharge/SpaceCharge.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;fmt/core.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/Logger_8h.html">Framework/Logger.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d2a/PoissonSolver_8h.html">TPCSpaceCharge/PoissonSolver.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/Logger_8h.html">Framework/Logger.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;TGeoGlobalMagField.h&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d5b/ParameterGas_8h.html">TPCBase/ParameterGas.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d47/ParameterElectronics_8h.html">TPCBase/ParameterElectronics.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/MagneticField_8h.html">Field/MagneticField.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d22/TreeStreamRedirector_8h.html">CommonUtils/TreeStreamRedirector.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d81/CalDet_8h.html">TPCBase/CalDet.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/db6/Painter_8h.html">TPCBase/Painter.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;TF1.h&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;TH3.h&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a021e6e023b83ccdc5f7ff44ec3f61d41">templateClassImp</a>(<a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge</a>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html">o2::tpc</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5346cddfd4defc158d2afee623814f6c">   48</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5346cddfd4defc158d2afee623814f6c">SpaceCharge&lt;DataT&gt;::setGrid</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nZVertices, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nRVertices, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPhiVertices)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  o2::conf::ConfigurableParam::setValue&lt;unsigned short&gt;(<span class="stringliteral">&quot;TPCSpaceChargeParam&quot;</span>, <span class="stringliteral">&quot;NZVertices&quot;</span>, nZVertices);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  o2::conf::ConfigurableParam::setValue&lt;unsigned short&gt;(<span class="stringliteral">&quot;TPCSpaceChargeParam&quot;</span>, <span class="stringliteral">&quot;NRVertices&quot;</span>, nRVertices);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  o2::conf::ConfigurableParam::setValue&lt;unsigned short&gt;(<span class="stringliteral">&quot;TPCSpaceChargeParam&quot;</span>, <span class="stringliteral">&quot;NPhiVertices&quot;</span>, nPhiVertices);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">   56</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">SpaceCharge&lt;DataT&gt;::calculateDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> calcVectors)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keyword">using</span> timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keyword">using</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SC</a> = <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (!mIsChargeSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(error, <span class="stringliteral">&quot;the charge is not set!&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sglobalType{<span class="stringliteral">&quot;local distortion/correction interpolator&quot;</span>, <span class="stringliteral">&quot;Electric fields&quot;</span>};</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sglobalDistType{<span class="stringliteral">&quot;Standard method&quot;</span>, <span class="stringliteral">&quot;interpolation of global corrections&quot;</span>};</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sideName{<span class="stringliteral">&quot;A&quot;</span>, <span class="stringliteral">&quot;C&quot;</span>};</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;====== starting calculation of distortions and corrections for Side {} ======&quot;</span>, sideName[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;Using {} threads&quot;</span>, getNThreads());</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (getGlobalDistCorrMethod() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5674cfd63645f253612aa395f0b5b085a5e43b95671dcd2d36f760a17c6519686">SC::GlobalDistCorrMethod::LocalDistCorr</a>) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;calculation of global distortions and corrections are performed by using: {}&quot;</span>, sglobalType[0]);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;calculation of global distortions and corrections are performed by using: {}&quot;</span>, sglobalType[1]);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span> (getGlobalDistType() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfae16b5b7f26f54214445cbe38d72c2828">SC::GlobalDistType::Fast</a>) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;calculation of global distortions performed by following method: {}&quot;</span>, sglobalDistType[1]);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getGlobalDistType() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfaeb6d8ae6f20283755b339c0dc273988b">SC::GlobalDistType::Standard</a>) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;calculation of global distortions performed by following method: {}&quot;</span>, sglobalDistType[0]);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;skipping calculation of global distortions&quot;</span>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">auto</span> startTotal = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keyword">auto</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  poissonSolver(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">auto</span> stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  std::chrono::duration&lt;float&gt; time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;Poisson Solver time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  calcEField(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;electric field calculation time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> numEFields = getElectricFieldsInterpolator(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span> (getGlobalDistType() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfaeb6d8ae6f20283755b339c0dc273988b">SC::GlobalDistType::Standard</a>) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> dist = <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;::Type::Distortions</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    calcLocalDistortionsCorrections(dist, numEFields); <span class="comment">// local distortion calculation</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;local distortions time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;skipping local distortions (not needed)&quot;</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> corr = <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;::Type::Corrections</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  calcLocalDistortionsCorrections(corr, numEFields); <span class="comment">// local correction calculation</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;local corrections time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">if</span> (calcVectors) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    calcLocalDistortionCorrectionVector(numEFields);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;local correction/distortion vector time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> lCorrInterpolator = getLocalCorrInterpolator(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  (getGlobalDistCorrMethod() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5674cfd63645f253612aa395f0b5b085a5e43b95671dcd2d36f760a17c6519686">SC::GlobalDistCorrMethod::LocalDistCorr</a>) ? calcGlobalCorrections(lCorrInterpolator) : calcGlobalCorrections(numEFields);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;global corrections time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (getGlobalDistType() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfae16b5b7f26f54214445cbe38d72c2828">SC::GlobalDistType::Fast</a>) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> globalCorrInterpolator = getGlobalCorrInterpolator(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    calcGlobalDistWithGlobalCorrIterative(globalCorrInterpolator);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getGlobalDistType() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfaeb6d8ae6f20283755b339c0dc273988b">SC::GlobalDistType::Standard</a>) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> lDistInterpolator = getLocalDistInterpolator(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    (getGlobalDistCorrMethod() == <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5674cfd63645f253612aa395f0b5b085a5e43b95671dcd2d36f760a17c6519686">SC::GlobalDistCorrMethod::LocalDistCorr</a>) ? calcGlobalDistortions(lDistInterpolator) : calcGlobalDistortions(numEFields);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;global distortions time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  time = stop - startTotal;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;everything is done. Total Time: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">  152</a></span>&#160;<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">SpaceCharge&lt;DataT&gt;::regulateR</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> posR, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> minR = getRMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - 4 * getGridSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (posR &lt; minR) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span> minR;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> maxR = getRMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + 2 * getGridSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">if</span> (posR &gt; maxR) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> maxR;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">return</span> posR;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a93c31f250bea4dd2c4e112126cae3898">  166</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a93c31f250bea4dd2c4e112126cae3898">SpaceCharge&lt;DataT&gt;::dumpToFile</a>(TFile&amp; <a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  dumpElectricFields(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  dumpPotential(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  dumpDensity(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  dumpGlobalDistortions(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  dumpGlobalCorrections(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  dumpLocalCorrections(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  dumpLocalDistortions(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  dumpLocalDistCorrVectors(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab24f71bac9d25cff4ba12b7fb360cd39">  179</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab24f71bac9d25cff4ba12b7fb360cd39">SpaceCharge&lt;DataT&gt;::setFromFile</a>(TFile&amp; <a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  setDensityFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  setPotentialFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  setElectricFieldsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  setLocalDistortionsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  setLocalCorrectionsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  setGlobalDistortionsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  setGlobalCorrectionsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  setLocalDistCorrVectorsFromFile(<a class="code" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">  192</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">SpaceCharge&lt;DataT&gt;::setChargeDensityFromFormula</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        mDensity[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a5a124cae7990696b48d1a5bed028f07f">evalDensity</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  mIsChargeSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">  209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">SpaceCharge&lt;DataT&gt;::setPotentialFromFormula</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">  225</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryFromFormula</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = 0;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = mParamGrid.NRVertices - 1;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = 0;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a827990b889ffd8a32f23fe4ce4cb7441">  270</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a827990b889ffd8a32f23fe4ce4cb7441">SpaceCharge&lt;DataT&gt;::poissonSolver</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIteration, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stoppingConvergence, <span class="keyword">const</span> <span class="keywordtype">int</span> symmetry)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a196fbcdc355e62e60736768c7aab8189">PoissonSolver&lt;DataT&gt;::setConvergenceError</a>(stoppingConvergence);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html">PoissonSolver&lt;DataT&gt;</a> poissonSolver(mGrid3D[0]);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  poissonSolver.<a class="code" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a66d868c082110c6929f68a06fb168f3c">poissonSolver3D</a>(mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mDensity[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], symmetry);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">  278</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">SpaceCharge&lt;DataT&gt;::setEFieldFromFormula</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a308dadc8806187b1d96458f9a57e4cf3">evalEr</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#abf5346b1e3ead79c4ad78b4325c3762f">evalEz</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a21e4e90d70b37c2efe7b37b28a24bf19">evalEphi</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">  297</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">SpaceCharge&lt;DataT&gt;::calcEField</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> symmetry = 0;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">size_t</span> tmpPlus = iPhi + 1;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">int</span> signPlus = 1;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordtype">int</span> tmpMinus = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(iPhi - 1);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">int</span> signMinus = 1;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span> (symmetry == 1 || symmetry == -1) { <span class="comment">// Reflection symmetry in phi (e.g. symmetry at sector boundaries, or half sectors, etc.)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">if</span> (tmpPlus &gt; mParamGrid.NPhiVertices - 1) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (symmetry == -1) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          signPlus = -1;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        tmpPlus = mParamGrid.NPhiVertices - 2;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">if</span> (tmpMinus &lt; 0) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        tmpMinus = 1; <span class="comment">// SHOULD IT BE =0?</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span> (symmetry == -1) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          signMinus = -1;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// No Symmetries in phi, no boundaries, the calculations is continuous across all phi</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">if</span> (tmpPlus &gt; mParamGrid.NPhiVertices - 1) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        tmpPlus = iPhi + 1 - mParamGrid.NPhiVertices;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">if</span> (tmpMinus &lt; 0) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        tmpMinus = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(iPhi - 1 + mParamGrid.NPhiVertices);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// for non-boundary V</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 1; iR &lt; mParamGrid.NRVertices - 1; iR++) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices - 1; iZ++) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR + 1, iPhi) - mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR - 1, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// r direction</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) - mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// z direction</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// for boundary-r</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ++) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 0, iPhi) = -1 * (-<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 2, iPhi) + 2 * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 1, iPhi) - <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 0, iPhi)) * getInvSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                                                                                <span class="comment">// forward difference</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 1, iPhi) = -1 * (<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 1, iPhi) - 2 * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 2, iPhi) + <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 3, iPhi)) * getInvSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// backward difference</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; iR += mParamGrid.NRVertices - 1) {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices - 1; iZ++) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) - mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// z direction</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// for boundary-z</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = -1 * (-<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi) + 2 * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi)) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = -1 * (<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) - 2 * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) + <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 1; iR &lt; mParamGrid.NRVertices - 1; ++iR) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ += mParamGrid.NZVertices - 1) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR + 1, iPhi) - mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR - 1, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingR(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// r direction</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// corner points for EPhi</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; iR += mParamGrid.NRVertices - 1) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ += mParamGrid.NZVertices - 1) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa999e778564a14d513990ff202dd81a6">  378</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa999e778564a14d513990ff202dd81a6">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterative</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a>&amp; globCorr, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> approachZ, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> approachR, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diffCorr)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = globCorr.<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a2c695f47938da98e89d832edb1d881f1">getSide</a>();</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nearestiZ = iZ;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nearestiR = iR;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nearestiPhi = iPhi;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> nearestZ = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(nearestiZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> nearestR = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(nearestiR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> nearestPhi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(nearestiPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment">//==========================================================================================</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">//==== start algorithm: use tricubic upsampling to numerically approach the query point ====</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment">//==========================================================================================</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment">// 1. calculate difference from nearest point to query point with stepwidth factor x</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment">// and approach the new point</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepR = (radius - nearestR) * approachR;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepZ = (<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> - nearestZ) * approachZ;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepPhi = (phi - nearestPhi) * approachPhi;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">// needed to check for convergence</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lastCorrdR = <a class="code" href="../../d2/d0e/test__Algorithm_8cxx.html#a5216308b2bcc588018b96379974d290c">std::numeric_limits&lt;DataT&gt;::max</a>();</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lastCorrdZ = <a class="code" href="../../d2/d0e/test__Algorithm_8cxx.html#a5216308b2bcc588018b96379974d290c">std::numeric_limits&lt;DataT&gt;::max</a>();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lastCorrdRPhi = <a class="code" href="../../d2/d0e/test__Algorithm_8cxx.html#a5216308b2bcc588018b96379974d290c">std::numeric_limits&lt;DataT&gt;::max</a>();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment">// interpolated global correction</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrdR = 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrdRPhi = 0;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrdZ = 0;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; maxIter; ++iter) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="comment">// 2. get new point coordinates</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rCurrPos = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(nearestiR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + stepR;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zCurrPos = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(nearestiZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + stepZ;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiCurrPos = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(nearestiPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + stepPhi;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <span class="comment">// interpolate global correction at new point and calculate position of global correction</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          <span class="comment">// corrdR = globCorr.evalSparsedR(zCurrPos, rCurrPos, phiCurrPos);</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          corrdR = globCorr.<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#ac47ba0536e3125bacc267f613372d569">evaldR</a>(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rNewPos = rCurrPos + corrdR;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          <span class="comment">// const DataT corrPhi = globCorr.evalSparsedRPhi(zCurrPos, rCurrPos, phiCurrPos) / rCurrPos;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrPhi = globCorr.<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a9d2c379302625ac301af5e44e3cca7b2">evaldRPhi</a>(zCurrPos, rCurrPos, phiCurrPos) / rCurrPos;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;          corrdRPhi = corrPhi * rNewPos; <span class="comment">// normalize to new r coordinate</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiNewPos = phiCurrPos + corrPhi;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;          <span class="comment">// corrdZ = globCorr.evalSparsedZ(zCurrPos, rCurrPos, phiCurrPos);</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          corrdZ = globCorr.<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a6ce451ab1f382618b762cd0510c77472">evaldZ</a>(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zNewPos = zCurrPos + corrdZ;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          <span class="comment">// approach desired coordinate</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          stepR += (radius - rNewPos) * approachR;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          stepZ += (<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> - zNewPos) * approachZ;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          stepPhi += (phi - phiNewPos) * approachPhi;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          <span class="comment">// check for convergence</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diffCorrdR = std::abs(corrdR - lastCorrdR);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diffCorrdRZ = std::abs(corrdZ - lastCorrdZ);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diffCorrdRPhi = std::abs(corrdRPhi - lastCorrdRPhi);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          <span class="comment">// stop algorithm if converged</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          <span class="keywordflow">if</span> (diffCorrdR &lt; diffCorr &amp;&amp; diffCorrdRZ &lt; diffCorr &amp;&amp; diffCorrdRPhi &lt; diffCorr) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;          lastCorrdR = corrdR;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          lastCorrdZ = corrdZ;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          lastCorrdRPhi = corrdRPhi;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">// set global distortions if algorithm converged or iterations exceed max numbers of iterations</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdR;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdRPhi;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdZ;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">// set flag that global distortions are set to true</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">  471</a></span>&#160;<a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">SpaceCharge&lt;DataT&gt;::getElectricFieldsInterpolator</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">if</span> (!mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== E-Fields are not set! ==============\n&quot;</span>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> numFields(mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">  481</a></span>&#160;<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">SpaceCharge&lt;DataT&gt;::getLocalDistInterpolator</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (!mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== local distortions not set! ==============\n&quot;</span>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00491"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">  491</a></span>&#160;<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">SpaceCharge&lt;DataT&gt;::getLocalCorrInterpolator</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">if</span> (!mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== local corrections not set!  ==============\n&quot;</span>);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">  501</a></span>&#160;<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">SpaceCharge&lt;DataT&gt;::getGlobalDistInterpolator</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">if</span> (!mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== global distortions not set ==============\n&quot;</span>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">  511</a></span>&#160;<a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">SpaceCharge&lt;DataT&gt;::getGlobalCorrInterpolator</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">if</span> (!mIsGlobalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== global corrections not set ==============\n&quot;</span>);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mGlobalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab87ed7a4f08707f4816f99a495dd29ec">  521</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab87ed7a4f08707f4816f99a495dd29ec">SpaceCharge&lt;DataT&gt;::dumpElectricFields</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span> (!mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== E-Fields are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEr_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEz_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEphi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa9b66acad44dd03078a54712155355e2">  535</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa9b66acad44dd03078a54712155355e2">SpaceCharge&lt;DataT&gt;::setElectricFieldsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;{</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEr_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEz_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;fieldEphi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab7ddeaf22319914100faa6fcd7c7f4ec">  545</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab7ddeaf22319914100faa6fcd7c7f4ec">SpaceCharge&lt;DataT&gt;::dumpGlobalDistortions</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span> (!mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== global distortions are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distRphi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3401119c64d85dd8570b26835be31160">  559</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3401119c64d85dd8570b26835be31160">SpaceCharge&lt;DataT&gt;::setGlobalDistortionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;{</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;distRphi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;}</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa5095db124d7dd5e6e5fb8df3778be64">  569</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa5095db124d7dd5e6e5fb8df3778be64">SpaceCharge&lt;DataT&gt;::dumpGlobalCorrections</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">if</span> (!mIsGlobalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== global corrections are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mGlobalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mGlobalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mGlobalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00583"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a379d2928f267fad79db62a9287b01246">  583</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a379d2928f267fad79db62a9287b01246">SpaceCharge&lt;DataT&gt;::setGlobalCorrectionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;{</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  mIsGlobalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  mGlobalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  mGlobalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  mGlobalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a35717cff101e6dee972c4a31c16af78d">  593</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a35717cff101e6dee972c4a31c16af78d">SpaceCharge&lt;DataT&gt;::dumpLocalCorrections</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">if</span> (!mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== local corrections are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdR = mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdZ = mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdRPhi = mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">return</span> lCorrdR + lCorrdZ + lCorrdRPhi;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2a53c937b510d43a92ff151e1c507aac">  607</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2a53c937b510d43a92ff151e1c507aac">SpaceCharge&lt;DataT&gt;::setLocalCorrectionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;{</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdR = mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdZ = mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdRPhi = mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lcorrRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">if</span> (lCorrdR &amp;&amp; lCorrdZ &amp;&amp; lCorrdRPhi) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a833c070e9513681035f62bdbb9627343">  621</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a833c070e9513681035f62bdbb9627343">SpaceCharge&lt;DataT&gt;::dumpLocalDistortions</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordflow">if</span> (!mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== local distortions are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdR = mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdZ = mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdRPhi = mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordflow">return</span> lDistdR + lDistdZ + lDistdRPhi;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;}</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afd1257e191fd2b9e5d9cd50473f6a104">  635</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afd1257e191fd2b9e5d9cd50473f6a104">SpaceCharge&lt;DataT&gt;::dumpLocalDistCorrVectors</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordflow">if</span> (!mIsLocalVecDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;============== local distortion vectors are not set! returning ==============\n&quot;</span>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdR = mLocalVecDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdZ = mLocalVecDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdRPhi = mLocalVecDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(outf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">return</span> lVecDistdR + lVecDistdZ + lVecDistdRPhi;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00649"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aead8b71aa8906206c4c4e16985d08ddd">  649</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aead8b71aa8906206c4c4e16985d08ddd">SpaceCharge&lt;DataT&gt;::setLocalDistortionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;{</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdR = mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdZ = mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdRPhi = mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;ldistRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">if</span> (lDistdR &amp;&amp; lDistdZ &amp;&amp; lDistdRPhi) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5493891bf440b6e449f8343b306cea76">  664</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5493891bf440b6e449f8343b306cea76">SpaceCharge&lt;DataT&gt;::setLocalDistCorrVectorsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdR = mLocalVecDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistR_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdZ = mLocalVecDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistZ_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdRPhi = mLocalVecDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(inpf, <a class="code" href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">fmt::format</a>(<span class="stringliteral">&quot;lvecdistRPhi_side{}&quot;</span>, sideName).<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">if</span> (lVecDistdR &amp;&amp; lVecDistdZ &amp;&amp; lVecDistdRPhi) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    mIsLocalVecDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    mIsLocalVecDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;}</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">  679</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromFile</a>(TFile&amp; fInp, <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a>)</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;{</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  TH3* hisSCDensity3D = (TH3*)fInp.Get(<a class="code" href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  fillChargeDensityFromHisto(*hisSCDensity3D);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keyword">delete</span> hisSCDensity3D;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;}</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">  687</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromHisto</a>(<span class="keyword">const</span> TH3&amp; hisSCDensity3D)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;{</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  TH3DataT hRebin = rebinDensityHisto(hisSCDensity3D, mParamGrid.NZVertices, mParamGrid.NRVertices, mParamGrid.NPhiVertices);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>; <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> &lt; <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ab2729d1c6becc28660e849f6d60456d2">SIDES</a>; ++<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">size_t</span> zBin = <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? mParamGrid.NZVertices + iZ + 1 : mParamGrid.NZVertices - iZ;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          mDensity[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = hRebin.GetBinContent(iPhi + 1, iR + 1, zBin);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    mIsChargeSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a80b688c53b338b77f728a3d32fd01135">  704</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a80b688c53b338b77f728a3d32fd01135">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromCalDet</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d2d/namespaceo2_1_1pmr.html#aeea588f6ab06f06d4131f84d8eea272b">std::vector</a>&lt;<a class="code" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; calSCDensity3D)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;{</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> hConverted = <a class="code" href="../../dd/d9d/namespaceo2_1_1tpc_1_1painter.html#a05e760026ea24ef56d390ae76cc9d287">o2::tpc::painter::convertCalDetToTH3</a>(calSCDensity3D, <span class="keyword">true</span>, mParamGrid.NRVertices, getRMin(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), getRMax(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), mParamGrid.NPhiVertices, getZMax(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  fillChargeDensityFromHisto(hConverted);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac6e1ca7a183fc9056bdb9f15ac04b464">  711</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac6e1ca7a183fc9056bdb9f15ac04b464">SpaceCharge&lt;DataT&gt;::fillChargeFromCalDet</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d2d/namespaceo2_1_1pmr.html#aeea588f6ab06f06d4131f84d8eea272b">std::vector</a>&lt;<a class="code" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; calCharge3D)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;{</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keyword">auto</span> hConverted = <a class="code" href="../../dd/d9d/namespaceo2_1_1tpc_1_1painter.html#a05e760026ea24ef56d390ae76cc9d287">o2::tpc::painter::convertCalDetToTH3</a>(calCharge3D, <span class="keyword">false</span>, mParamGrid.NRVertices, getRMin(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), getRMax(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), mParamGrid.NPhiVertices, getZMax(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  normalizeHistoQVEps0(hConverted);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  fillChargeDensityFromHisto(hConverted);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00719"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a277f03e5b92e0b161193e776fac7fe0b">  719</a></span>&#160;<span class="keyword">typename</span> SpaceCharge&lt;DataT&gt;::TH3DataT <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a277f03e5b92e0b161193e776fac7fe0b">SpaceCharge&lt;DataT&gt;::rebinDensityHisto</a>(<span class="keyword">const</span> TH3&amp; hOrig, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsZNew, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsRNew, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsPhiNew)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;{</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  TH3DataT hRebin{};</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> nBinsZNewTwo = 2 * nBinsZNew;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> phiLow = hOrig.GetXaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> phiUp = hOrig.GetXaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsX());</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> rLow = hOrig.GetYaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> rUp = hOrig.GetYaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsY());</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> zLow = hOrig.GetZaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> zUp = hOrig.GetZaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsZ());</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  hRebin.SetBins(nBinsPhiNew, phiLow, phiUp, nBinsRNew, rLow, rUp, nBinsZNewTwo, zLow, zUp);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinPhi = 1; iBinPhi &lt;= nBinsPhiNew; ++iBinPhi) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> phiLowEdge = hRebin.GetXaxis()-&gt;GetBinLowEdge(iBinPhi);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> phiUpEdge = hRebin.GetXaxis()-&gt;GetBinUpEdge(iBinPhi);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> phiLowBinOrig = hOrig.GetXaxis()-&gt;FindBin(phiLowEdge);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> phiUpBinOrig = hOrig.GetXaxis()-&gt;FindBin(phiUpEdge);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// calculate the weights (area of original bin lies in the new bin / binwidthOrig) of the first and last bins</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> binWidthPhiOrig = hOrig.GetXaxis()-&gt;GetBinWidth(phiLowBinOrig);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightPhi = std::abs(phiLowEdge - hOrig.GetXaxis()-&gt;GetBinUpEdge(phiLowBinOrig)) / binWidthPhiOrig;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightPhi = std::abs(phiUpEdge - hOrig.GetXaxis()-&gt;GetBinLowEdge(phiUpBinOrig)) / binWidthPhiOrig;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinR = 1; iBinR &lt;= nBinsRNew; ++iBinR) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> rLowEdge = hRebin.GetYaxis()-&gt;GetBinLowEdge(iBinR);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> rUpEdge = hRebin.GetYaxis()-&gt;GetBinUpEdge(iBinR);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> rLowBinOrig = hOrig.GetYaxis()-&gt;FindBin(rLowEdge);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> rUpBinOrig = hOrig.GetYaxis()-&gt;FindBin(rUpEdge);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="comment">// calculate the weights (area of original bin lies in the new bin / binwidthOrig) of the first and last bins</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> binWidthROrig = hOrig.GetYaxis()-&gt;GetBinWidth(rLowBinOrig);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightR = std::abs(rLowEdge - hOrig.GetYaxis()-&gt;GetBinUpEdge(rLowBinOrig)) / binWidthROrig;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightR = std::abs(rUpEdge - hOrig.GetYaxis()-&gt;GetBinLowEdge(rUpBinOrig)) / binWidthROrig;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinZ = 1; iBinZ &lt;= nBinsZNewTwo; ++iBinZ) {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> zLowEdge = hRebin.GetZaxis()-&gt;GetBinLowEdge(iBinZ);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> zUpEdge = hRebin.GetZaxis()-&gt;GetBinUpEdge(iBinZ);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> zCenter = hRebin.GetZaxis()-&gt;GetBinCenter(iBinZ);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordtype">int</span> zLowBinOrig = hOrig.GetZaxis()-&gt;FindBin(zLowEdge);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordtype">int</span> zUpBinOrig = hOrig.GetZaxis()-&gt;FindBin(zUpEdge);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> currside = getSide(zCenter); <span class="comment">// set the side of the current z-bin</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="comment">// get the side of the lowest and uppest bin from the orig histo</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> sideLowOrig = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zLowBinOrig));</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> sideUpOrig = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zUpBinOrig));</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="comment">// make bounds/side check of the zLowBinOrig and zUpBinOrig bins. They must be on the same side as the currside!!!</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">if</span> (currside != sideLowOrig &amp;&amp; zLowBinOrig != zUpBinOrig) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          <span class="comment">// if the lower bins from the orig histo are not on the same side as the rebinned increase the binnumber until they are on the same side</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          <span class="keywordtype">bool</span> notequal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            zLowBinOrig += 1;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">if</span> (zLowBinOrig &gt; zUpBinOrig) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;SOMETHING WENT WRONG: SETTING BINS TO: {}&quot;</span>, zUpBinOrig);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;              zLowBinOrig = zUpBinOrig;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> sideTmp = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zLowBinOrig));</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">if</span> (sideTmp == currside) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          } <span class="keywordflow">while</span> (notequal);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">if</span> (currside != sideUpOrig &amp;&amp; zLowBinOrig != zUpBinOrig) {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          <span class="comment">// if the upper bins from the orig histo are not on the same side as the rebinned increase the binnumber until they are on the same side</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          <span class="keywordtype">bool</span> notequal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            zUpBinOrig -= 1;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="keywordflow">if</span> (zUpBinOrig &lt; zLowBinOrig) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;SOMETHING WENT WRONG: SETTING BINS TO: {}&quot;</span>, zLowBinOrig);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;              zUpBinOrig = zLowBinOrig;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> sideTmp = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zUpBinOrig));</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keywordflow">if</span> (sideTmp == currside) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;          } <span class="keywordflow">while</span> (notequal);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> binWidthZOrig = hOrig.GetZaxis()-&gt;GetBinWidth(zLowBinOrig);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightZ = std::abs(zLowEdge - hOrig.GetZaxis()-&gt;GetBinUpEdge(zLowBinOrig)) / binWidthZOrig;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightZ = std::abs(zUpEdge - hOrig.GetZaxis()-&gt;GetBinLowEdge(zUpBinOrig)) / binWidthZOrig;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">// get the mean value of the original histogram of the found bin range</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> = 0;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> sumW = 0;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPhi = phiLowBinOrig; iPhi &lt;= phiUpBinOrig; ++iPhi) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> weightPhi = 1;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          <span class="keywordflow">if</span> (iPhi == phiLowBinOrig) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            weightPhi = lowerBinWeightPhi;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iPhi == phiUpBinOrig) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            weightPhi = upperBinWeightPhi;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = rLowBinOrig; iR &lt;= rUpBinOrig; ++iR) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> weightR = 1;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordflow">if</span> (iR == rLowBinOrig) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;              weightR = lowerBinWeightR;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iR == rUpBinOrig) {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;              weightR = upperBinWeightR;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = zLowBinOrig; iZ &lt;= zUpBinOrig; ++iZ) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;              <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> weightZ = 1;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;              <span class="keywordflow">if</span> (iZ == zLowBinOrig) {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                weightZ = lowerBinWeightZ;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iZ == zUpBinOrig) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                weightZ = upperBinWeightZ;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;              }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a> = hOrig.GetBinContent(iPhi, iR, iZ);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;              <span class="comment">// if(val==0){</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;              <span class="comment">// what to do now???</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;              <span class="comment">// }</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span> totalWeight = weightPhi * weightR * weightZ;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;              <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> += <a class="code" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a> * totalWeight;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;              sumW += totalWeight;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> /= sumW;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        hRebin.SetBinContent(iBinPhi, iBinR, iBinZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a>);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">return</span> hRebin;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160; </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="line"><a name="l00853"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa585f3a2ce68bf3bd40768aa377aa855">  853</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">SpaceCharge&lt;DataT&gt;::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">SpaceCharge&lt;DataT&gt;::Type</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> ElectricFields&amp; formulaStruct)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;{</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// calculate local distortions/corrections for each vertex in the tpc</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="comment">// set z coordinate depending on distortions or correction calculation</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ + 1, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ + 1, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> drTmp = 0;   <span class="comment">// local distortion dR</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dPhiTmp = 0; <span class="comment">// local distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dzTmp = 0;   <span class="comment">// local distortion dZ</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSize = (<a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> - z0) / sSteps; <span class="comment">// the distortions are calculated by leting the elctron drift this distance in z direction</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; sSteps; ++iter) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0Tmp = (z0 + iter * stepSize + dzTmp); <span class="comment">// starting z position</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z1Tmp = (z0Tmp + stepSize);             <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radiusTmp = regulateR(radius + drTmp, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current radial position</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiTmp = regulatePhi(phi + dPhiTmp, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);   <span class="comment">// current phi position</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          <span class="comment">// calculate distortions/corrections</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;          calcDistCorr(radiusTmp, phiTmp, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;          <span class="comment">// add temp distortions to local distortions</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          drTmp += ddR;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          dPhiTmp += ddPhi;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;          dzTmp += ddZ;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">// store local distortions/corrections</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = drTmp;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dPhiTmp * radius;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dzTmp;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drTmp;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dPhiTmp * radius;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzTmp;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="comment">//extrapolate local distortion/correction to last/first bin using legendre polynoms with x0=0, x1=1, x2=2 and x=-1. This has to be done to ensure correct interpolation in the last,second last/first,second bin!</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;          mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;}</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="line"><a name="l00935"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">  935</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">SpaceCharge&lt;DataT&gt;::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> ElectricFields&amp; formulaStruct)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;{</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="comment">// calculate local distortion/correction vector for each vertex in the tpc</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ezField = getEzField(formulaStruct.getSide());</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> er = mElectricFieldEr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ez0 = mElectricFieldEz[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ephi = mElectricFieldEphi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ez = getSign(formulaStruct.getSide()) * 1. / (ezField + ez0);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> erez = er * ez;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ephiez = ephi * ez;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> vecdR = mC0 * erez + mC1 * ephiez;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> vecdRPhi = mC0 * ephiez - mC1 * erez;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> vecdZ = -ez0 * <a class="code" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">TPCParameters&lt;DataT&gt;::DVDE</a>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        mLocalVecDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdR;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        mLocalVecDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdRPhi;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        mLocalVecDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdZ;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  mIsLocalVecDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;}</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="line"><a name="l00966"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af8775655acd2df55f4e312a0fd83a70c">  966</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7cf35cd4d86df75c69cb3a79697775d7">SpaceCharge&lt;DataT&gt;::calcLocalDistortionsCorrectionsRK4</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">SpaceCharge&lt;DataT&gt;::Type</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;{</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// see: https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">// calculate local distortions/corrections for each vertex in the tpc using Runge Kutta 4 method</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="comment">// set z coordinate depending on distortions or correction calculation</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ0 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? iZ + 1 : iZ;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ1 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? iZ : iZ + 1;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ0, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ1, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSize = <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> - z0; <span class="comment">// h in the RK4 method</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> absstepSize = std::abs(stepSize);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSizeHalf = 0.5 * stepSize; <span class="comment">// half z bin for RK4</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> absstepSizeHalf = std::abs(stepSizeHalf);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="comment">// starting position for RK4</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zk1 = z0;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rk1 = radius;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phik1 = phi;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k1dR = 0;    <span class="comment">// derivative in r direction</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k1dZ = 0;    <span class="comment">// derivative in z direction</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k1dRPhi = 0; <span class="comment">// derivative in rphi direction</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="comment">// get derivative on current vertex</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            k1dR = getLocalVecCorrR(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            k1dZ = getLocalVecCorrZ(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            k1dRPhi = getLocalVecCorrRPhi(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            k1dR = getLocalVecDistR(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            k1dZ = getLocalVecDistZ(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            k1dRPhi = getLocalVecDistRPhi(iZ0, iR, iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="comment">// approximate position after half stepSize</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zk2 = zk1 + stepSizeHalf + absstepSizeHalf * k1dZ;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rk2 = rk1 + absstepSizeHalf * k1dR;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k1dPhi = k1dRPhi / rk1;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phik2 = phik1 + absstepSizeHalf * k1dPhi;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="comment">// get derivative for new position</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k2dR = 0;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k2dZ = 0;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k2dRPhi = 0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk2, rk2, phik2, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k2dZ, k2dR, k2dRPhi) : getLocalDistortionVectorCyl(zk2, rk2, phik2, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k2dZ, k2dR, k2dRPhi);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment">// approximate new position</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zk3 = zk1 + stepSizeHalf + absstepSizeHalf * k2dZ;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rk3 = rk1 + absstepSizeHalf * k2dR;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k2dPhi = k2dRPhi / rk2;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phik3 = phik1 + absstepSizeHalf * k2dPhi;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k3dR = 0;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k3dZ = 0;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k3dRPhi = 0;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk3, rk3, phik3, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k3dZ, k3dR, k3dRPhi) : getLocalDistortionVectorCyl(zk3, rk3, phik3, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k3dZ, k3dR, k3dRPhi);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zk4 = zk1 + stepSize + absstepSize * k3dZ;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rk4 = rk1 + absstepSize * k3dR;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k3dPhi = k3dRPhi / rk3;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phik4 = phik1 + absstepSize * k3dPhi;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k4dR = 0;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k4dZ = 0;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k4dRPhi = 0;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk4, rk4, phik4, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k4dZ, k4dR, k4dRPhi) : getLocalDistortionVectorCyl(zk4, rk4, phik4, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k4dZ, k4dR, k4dRPhi);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> k4dPhi = k4dRPhi / rk4;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="comment">// RK4 formula. See wikipedia: u = h * 1/6 * (k1 + 2*k2 + 2*k3 + k4)</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepsizeSixth = absstepSize / 6;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> drRK = stepsizeSixth * (k1dR + 2 * k2dR + 2 * k3dR + k4dR);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dzRK = stepsizeSixth * (k1dZ + 2 * k2dZ + 2 * k3dZ + k4dZ);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dphiRK = stepsizeSixth * (k1dPhi + 2 * k2dPhi + 2 * k3dPhi + k4dPhi);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="comment">// store local distortions/corrections</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = drRK;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dphiRK * radius;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dzRK;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drRK;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dphiRK * radius;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzRK;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="comment">//extrapolate local distortion/correction to last/first bin using legendre polynoms with x0=0, x1=1, x2=2 and x=-1. This has to be done to ensure correct interpolation in the last,second last/first,second bin!</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;          mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;          mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      }</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      mIsLocalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      mIsLocalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  }</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;}</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a name="l01096"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19"> 1096</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">SpaceCharge&lt;DataT&gt;::calcGlobalDistortions</a>(<span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;{</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSize = formulaStruct.getID() == 2 ? getGridSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : getGridSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / sSteps; <span class="comment">// if one used local distortions then no smaller stepsize is needed. if electric fields are used then smaller stepsize can be used</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">// loop over tpc volume and let the electron drift from each vertex to the readout of the tpc</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> r0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// the electron starts at z0, r0, phi0</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> drDist = 0.0;                    <span class="comment">// global distortion dR</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dPhiDist = 0.0;                  <span class="comment">// global distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dzDist = 0.0;                    <span class="comment">// global distortion dZ</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;          <span class="keywordflow">if</span> (iter &gt; maxIterations) {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(error, <span class="stringliteral">&quot;Aborting calculation of distortions for iZ: {}, iR: {}, iPhi: {} due to iteration &#39;{}&#39; &gt; maxIterations &#39;{}&#39;!&quot;</span>, iZ, iR, iPhi, iter, maxIterations);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0Tmp = z0 + dzDist + iter * stepSize; <span class="comment">// starting z position</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;          <span class="keywordflow">if</span> (getSide(z0Tmp) != <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(error, <span class="stringliteral">&quot;Aborting calculation of distortions for iZ: {}, iR: {}, iPhi: {} due to change in the sides!&quot;</span>, iZ, iR, iPhi);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z1Tmp = z0Tmp + stepSize;                 <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = regulateR(r0 + drDist, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);    <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = regulatePhi(phi0 + dPhiDist, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct);</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;          <span class="comment">// if one uses local distortions the interpolated value for the last bin has to be scaled.</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the last bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> checkReached = <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? z1Tmp &gt;= getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : z1Tmp &lt;= getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;          <span class="keywordflow">if</span> (formulaStruct.getID() == 2 &amp;&amp; checkReached) {</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> fac = std::abs((getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - z0Tmp) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            ddR *= fac;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            ddZ *= fac;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            ddPhi *= fac;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;          <span class="comment">// add local distortions to global distortions</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;          drDist += ddR;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;          dPhiDist += ddPhi;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          dzDist += ddZ;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          <span class="comment">// set loop to exit if the readout is reached and approximate distortion of &#39;missing&#39; (one never ends exactly on the readout: z1Tmp + ddZ != ZMAX) drift distance.</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;          <span class="comment">// approximation is done by the current calculated values of the distortions and scaled linear to the &#39;missing&#39; distance.</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          <span class="keywordflow">if</span> (checkReached) {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> deltaZ = getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - endPoint; <span class="comment">// distance from last point to read out</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diff = endPoint - z0Tmp;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> fac = diff != 0 ? std::abs(deltaZ / diff) : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            drDist += ddR * fac;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            dPhiDist += ddPhi * fac;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            dzDist += ddZ * fac;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;          }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          ++iter;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="comment">// store global distortions</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drDist;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dPhiDist * r0;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzDist;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="comment">// set flag that global distortions are set to true</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;}</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Formulas&gt;</div>
<div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abfdca38152bfd70cb42379dd20b81885"> 1178</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">SpaceCharge&lt;DataT&gt;::calcGlobalCorrections</a>(<span class="keyword">const</span> Formulas&amp; formulaStruct)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;{</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> iSteps = formulaStruct.getID() == 2 ? 1 : sSteps; <span class="comment">// if one used local corrections no step width is needed. since it is already used for calculation of the local corrections</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSize = -getGridSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / iSteps;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// loop over tpc volume and let the electron drift from each vertex to the readout of the tpc</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> r0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> drCorr = 0;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dPhiCorr = 0;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dzCorr = 0;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="comment">// start at the readout and follow electron towards central electrode</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1; iZ &gt;= 1; --iZ) {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0 = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// the electron starts at z0, r0, phi0</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="comment">// flag which is set when the central electrode is reached. if the central electrode is reached the calculation of the global corrections is aborted and the value set is the last calculated value.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordtype">bool</span> centralElectrodeReached = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; iSteps; ++iter) {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          <span class="keywordflow">if</span> (centralElectrodeReached) {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;          }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = regulateR(r0 + drCorr, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);     <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = regulatePhi(phi0 + dPhiCorr, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);  <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0Tmp = z0 + dzCorr + iter * stepSize;     <span class="comment">// starting z position</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z1Tmp = regulateZ(z0Tmp + stepSize, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// follow electron from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddR = 0;                                         <span class="comment">// distortion dR for z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddPhi = 0;                                       <span class="comment">// distortion dPhi for z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddZ = 0;                                         <span class="comment">// distortion dZ for z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="comment">// if one uses local corrections the interpolated value for the first bin has to be scaled.</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the first bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          centralElectrodeReached = getSign(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * z1Tmp &lt;= getZMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <span class="keywordflow">if</span> (formulaStruct.getID() == 2 &amp;&amp; centralElectrodeReached) {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> fac = (z0Tmp - getZMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)) * getInvSpacingZ(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            ddR *= fac;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            ddZ *= fac;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            ddPhi *= fac;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          }</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          <span class="comment">// add local corrections to global corrections</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          drCorr += ddR;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          dPhiCorr += ddPhi;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          dzCorr += ddZ;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;          <span class="comment">// set loop to exit if the central electrode is reached and approximate correction of &#39;missing&#39; (one never ends exactly on the central electrode: z1Tmp + ddZ != ZMIN) distance.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          <span class="comment">// approximation is done by the current calculated values of the corrections and scaled linear to the &#39;missing&#39; distance deltaZ. (NOT TESTED)</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          <span class="keywordflow">if</span> (centralElectrodeReached) {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> deltaZ = endPoint - getZMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diff = z0Tmp - endPoint;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> fac = diff != 0 ? deltaZ / diff : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            drCorr += ddR * fac;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            dPhiCorr += ddPhi * fac;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            dzCorr += ddZ * fac;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <span class="comment">// store global corrections</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        mGlobalCorrdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = drCorr;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        mGlobalCorrdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = dPhiCorr * r0;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        mGlobalCorrdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = dzCorr;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">// set flag that global corrections are set to true</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  mIsGlobalCorrSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;}</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01254"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881"> 1254</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881">SpaceCharge&lt;DataT&gt;::correctElectron</a>(<a class="code" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a>&amp; point)</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;{</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrX{};</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrY{};</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrZ{};</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(point.Z());</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160; </div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">// get the distortions for input coordinate</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  getCorrections(point.X(), point.Y(), point.Z(), <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="comment">// set distorted coordinates</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  point.SetXYZ(point.X() + corrX, point.Y() + corrY, point.Y() + corrY);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;}</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01269"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a775660a92e6edeb20ef3da048aede32f"> 1269</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a775660a92e6edeb20ef3da048aede32f">SpaceCharge&lt;DataT&gt;::distortElectron</a>(<a class="code" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a>&amp; point)<span class="keyword"> const</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">distX</a>{};</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">distY</a>{};</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distZ{};</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(point.Z());</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="comment">// get the distortions for input coordinate</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  getDistortions(point.X(), point.Y(), point.Z(), <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">distX</a>, <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">distY</a>, distZ);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="comment">// set distorted coordinates</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  point.SetXYZ(point.X() + <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">distX</a>, point.Y() + <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">distY</a>, point.Z() + distZ);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;}</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01283"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d"> 1283</a></span>&#160;<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">SpaceCharge&lt;DataT&gt;::getDensityCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">return</span> mInterpolatorDensity[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;}</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01289"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48"> 1289</a></span>&#160;<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">SpaceCharge&lt;DataT&gt;::getPotentialCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="keywordflow">return</span> mInterpolatorPotential[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;}</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01295"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043"> 1295</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043">SpaceCharge&lt;DataT&gt;::getElectricFieldsCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; eZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; eR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; ePhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  eZ = mInterpolatorEField[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalEz(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  eR = mInterpolatorEField[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalEr(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  ePhi = mInterpolatorEField[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalEphi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;}</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01303"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2"> 1303</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">SpaceCharge&lt;DataT&gt;::getLocalCorrectionsCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lcorrZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lcorrR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lcorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  lcorrZ = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  lcorrR = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  lcorrRPhi = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;}</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01311"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae4eb9dfe90bd58959447c41842b400b5"> 1311</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">SpaceCharge&lt;DataT&gt;::getLocalCorrectionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lcorrZ, std::vector&lt;DataT&gt;&amp; lcorrR, std::vector&lt;DataT&gt;&amp; lcorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  lcorrZ.resize(nPoints);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  lcorrR.resize(nPoints);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  lcorrRPhi.resize(nPoints);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    lcorrZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    lcorrR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    lcorrRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;}</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01326"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676"> 1326</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">SpaceCharge&lt;DataT&gt;::getCorrectionsCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  corrZ = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  corrR = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  corrRPhi = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;}</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01334"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abdb871166e6604ba577957b30c8075c4"> 1334</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">SpaceCharge&lt;DataT&gt;::getCorrectionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; corrZ, std::vector&lt;DataT&gt;&amp; corrR, std::vector&lt;DataT&gt;&amp; corrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  corrZ.resize(nPoints);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  corrR.resize(nPoints);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  corrRPhi.resize(nPoints);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    corrZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    corrR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    corrRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalCorr[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;}</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160; </div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01349"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176"> 1349</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">SpaceCharge&lt;DataT&gt;::getCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrX, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrY, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; corrZ)<span class="keyword"> const</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="comment">// convert cartesian to polar</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = getRadiusFromCartesian(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = getPhiFromCartesian(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrR{};</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrRPhi{};</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  getCorrectionsCyl(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ, corrR, corrRPhi);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="comment">// Calculate corrected position</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radiusCorr = radius + corrR;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiCorr = phi + corrRPhi / radius;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  corrX = getXFromPolar(radiusCorr, phiCorr) - <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>; <span class="comment">// difference between corrected and original x coordinate</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  corrY = getYFromPolar(radiusCorr, phiCorr) - <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>; <span class="comment">// difference between corrected and original y coordinate</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;}</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01368"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86"> 1368</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">SpaceCharge&lt;DataT&gt;::getLocalDistortionsCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; ldistZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; ldistR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; ldistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  ldistZ = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  ldistR = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  ldistRPhi = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;}</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160; </div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01376"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac34ea9c44d2f1e891f86a5dde307749e"> 1376</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">SpaceCharge&lt;DataT&gt;::getLocalDistortionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; ldistZ, std::vector&lt;DataT&gt;&amp; ldistR, std::vector&lt;DataT&gt;&amp; ldistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  ldistZ.resize(nPoints);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  ldistR.resize(nPoints);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  ldistRPhi.resize(nPoints);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    ldistZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    ldistR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    ldistRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;}</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01391"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f"> 1391</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">SpaceCharge&lt;DataT&gt;::getLocalDistortionVectorCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lvecdistZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lvecdistR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lvecdistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  lvecdistZ = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  lvecdistR = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  lvecdistRPhi = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;}</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01399"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25ce586cf19f34be49b0c1dbba57c79d"> 1399</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">SpaceCharge&lt;DataT&gt;::getLocalDistortionVectorCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lvecdistZ, std::vector&lt;DataT&gt;&amp; lvecdistR, std::vector&lt;DataT&gt;&amp; lvecdistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  lvecdistZ.resize(nPoints);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  lvecdistR.resize(nPoints);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  lvecdistRPhi.resize(nPoints);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    lvecdistZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    lvecdistR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    lvecdistRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;}</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01414"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8"> 1414</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">SpaceCharge&lt;DataT&gt;::getLocalCorrectionVectorCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lveccorrZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lveccorrR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; lveccorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  lveccorrZ = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  lveccorrR = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  lveccorrRPhi = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;}</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160; </div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7a1077333667739133b0ed53354294d5"> 1422</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">SpaceCharge&lt;DataT&gt;::getLocalCorrectionVectorCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lveccorrZ, std::vector&lt;DataT&gt;&amp; lveccorrR, std::vector&lt;DataT&gt;&amp; lveccorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  lveccorrZ.resize(nPoints);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  lveccorrR.resize(nPoints);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  lveccorrRPhi.resize(nPoints);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    lveccorrZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    lveccorrR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    lveccorrRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -mInterpolatorLocalVecDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;}</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01437"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797"> 1437</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">SpaceCharge&lt;DataT&gt;::getDistortionsCyl</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; distZ, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; distR, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; distRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  distZ = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  distR = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  distRPhi = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01445"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb0e50f91355e2e621479f2beffec4bd"> 1445</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">SpaceCharge&lt;DataT&gt;::getDistortionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; distZ, std::vector&lt;DataT&gt;&amp; distR, std::vector&lt;DataT&gt;&amp; distRPhi)<span class="keyword"> const</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  distZ.resize(nPoints);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  distR.resize(nPoints);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  distRPhi.resize(nPoints);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nPoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    distZ[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    distR[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    distRPhi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mInterpolatorGlobalDist[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], phi[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;}</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; </div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01460"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032"> 1460</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">SpaceCharge&lt;DataT&gt;::getDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">distX</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">distY</a>, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; distZ)<span class="keyword"> const</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="comment">// convert cartesian to polar</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = getRadiusFromCartesian(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = getPhiFromCartesian(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distR{};</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distRPhi{};</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  getDistortionsCyl(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distZ, distR, distRPhi);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="comment">// Calculate distorted position</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radiusDist = radius + distR;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiDist = phi + distRPhi / radius;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">distX</a> = getXFromPolar(radiusDist, phiDist) - <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>; <span class="comment">// difference between distorted and original x coordinate</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <a class="code" href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">distY</a> = getYFromPolar(radiusDist, phiDist) - <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>; <span class="comment">// difference between distorted and original y coordinate</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01479"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4"> 1479</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4">SpaceCharge&lt;DataT&gt;::init</a>()</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;{</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="keyword">using</span> timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordflow">if</span> (!mInitLookUpTables) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keyword">auto</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keyword">auto</span> o2field = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a>*<span class="keyword">&gt;</span>(TGeoGlobalMagField::Instance()-&gt;GetField());</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> bzField = o2field-&gt;<a class="code" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">solenoidField</a>(); <span class="comment">// magnetic field in kGauss</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment"></span>    <span class="keyword">auto</span>&amp; gasParam = <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">ParameterGas::Instance</a>();</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordtype">float</span> vDrift = gasParam.DriftV; <span class="comment">// drift velocity in cm/us</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a> = 1.;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> t2 = 1.;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> omegaTau = -10. * bzField * vDrift / std::abs(getEzField(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    setOmegaTauT1T2(omegaTau, <a class="code" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a>, t2);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordflow">if</span> (mUseInitialSCDensity) {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(warning) &lt;&lt; <span class="stringliteral">&quot;mUseInitialSCDensity&quot;</span> &lt;&lt; mUseInitialSCDensity;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      calculateDistortionsCorrections(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      calculateDistortionsCorrections(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      mInitLookUpTables = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keyword">auto</span> stop = <a class="code" href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">timer::now</a>();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    std::chrono::duration&lt;float&gt; time = stop - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(info, <span class="stringliteral">&quot;Total Time Distortions and Corrections for A and C Side: {}&quot;</span>, time.count());</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;}</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160; </div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01508"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642"> 1508</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642">SpaceCharge&lt;DataT&gt;::setDistortionLookupTables</a>(<span class="keyword">const</span> <a class="code" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdZ, <span class="keyword">const</span> <a class="code" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdR, <span class="keyword">const</span> <a class="code" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdRPhi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;{</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  mGlobalDistdR[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdR;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  mGlobalDistdZ[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdZ;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  mGlobalDistdRPhi[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdRPhi;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  mIsGlobalDistSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;}</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::integrateEFieldsRoot</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> p1r, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> p1phi, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> p1z, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> p2z, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; localIntErOverEz, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; localIntEPhiOverEz, <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a>&amp; localIntDeltaEz, <span class="keyword">const</span> Fields&amp; formulaStruct)<span class="keyword"> const</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ezField = getEzField(formulaStruct.getSide());</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <a class="code" href="../../d5/d1a/classTF1.html">TF1</a> fErOverEz(</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="stringliteral">&quot;fErOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalEr(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) / (formulaStruct.evalEz(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) + ezField)); }, p1z, p2z, 1);</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  localIntErOverEz = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(fErOverEz.Integral(p1z, p2z));</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160; </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <a class="code" href="../../d5/d1a/classTF1.html">TF1</a> fEphiOverEz(</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="stringliteral">&quot;fEPhiOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalEphi(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) / (formulaStruct.evalEz(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) + ezField)); }, p1z, p2z, 1);</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  localIntEPhiOverEz = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(fEphiOverEz.Integral(p1z, p2z));</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160; </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <a class="code" href="../../d5/d1a/classTF1.html">TF1</a> fEz(</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="stringliteral">&quot;fEZOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalEz(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) - ezField); }, p1z, p2z, 1);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  localIntDeltaEz = getSign(formulaStruct.getSide()) * <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(fEz.Integral(p1z, p2z));</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;}</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01535"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1"> 1535</a></span>&#160;std::vector&lt;std::pair&lt;std::vector&lt;o2::math_utils::Point3D&lt;float&gt;&gt;, std::array&lt;DataT, 3&gt;&gt;&gt; <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1">SpaceCharge&lt;DataT&gt;::calculateElectronDriftPath</a>(<span class="keyword">const</span> std::vector&lt;GlobalPosition3D&gt;&amp; elePos, <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints, <span class="keyword">const</span> std::string_view outFile)<span class="keyword"> const</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nElectrons = elePos.size();</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  std::vector&lt;std::pair&lt;std::vector&lt;o2::math_utils::Point3D&lt;float&gt;&gt;, std::array&lt;DataT, 3&gt;&gt;&gt; electronTracks(nElectrons);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nElectrons; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].first.reserve(nSamplingPoints + 1);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nElectrons; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0 = elePos[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].Z();</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> r0 = elePos[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].Rho();</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi0 = elePos[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].Phi();</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(z0);</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">if</span> (!mIsEfieldSet[<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]) {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;E-Fields are not set! Calculation of drift path is not possible\n&quot;</span>);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    }</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> numEFields{getElectricFieldsInterpolator(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)};</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> stepSize = getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / nSamplingPoints;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160; </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> drDist = 0.0;   <span class="comment">// global distortion dR</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dPhiDist = 0.0; <span class="comment">// global distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> dzDist = 0.0;   <span class="comment">// global distortion dZ</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z0Tmp = z0 + dzDist + iter * stepSize;     <span class="comment">// starting z position</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z1Tmp = regulateZ(z0Tmp + stepSize, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = r0 + drDist;                      <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      <span class="comment">// abort calculation of drift path if electron reached inner/outer field cage or central electrode</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">if</span> (radius &lt;= getRMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || radius &gt;= getRMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || getSide(z0Tmp) != <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      }</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = regulatePhi(phi0 + dPhiDist, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].first.emplace_back(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">GlobalPosition3D</a>(radius * std::cos(phi), radius * std::sin(phi), z0Tmp));</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160; </div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160; </div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, numEFields);</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="comment">// add local distortions to global distortions</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      drDist += ddR;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      dPhiDist += ddPhi;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      dzDist += ddZ;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="comment">// if one uses local distortions the interpolated value for the last bin has to be scaled.</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the last bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> checkReached = <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? z1Tmp &gt;= getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : z1Tmp &lt;= getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160; </div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="comment">// set loop to exit if the readout is reached and approximate distortion of &#39;missing&#39; (one never ends exactly on the readout: z1Tmp + ddZ != ZMAX) drift distance.</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="comment">// approximation is done by the current calculated values of the distortions and scaled linear to the &#39;missing&#39; distance.</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="keywordflow">if</span> (checkReached) {</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> deltaZ = getZMax(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - endPoint; <span class="comment">// distance from last point to read out</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> diff = endPoint - z0Tmp;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> fac = diff != 0 ? std::abs(deltaZ / diff) : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        drDist += ddR * fac;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        dPhiDist += ddPhi * fac;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        dzDist += ddZ * fac;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> z1TmpEnd = regulateZ(z0Tmp + stepSize, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radiusEnd = regulateR(r0 + drDist, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);     <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiEnd = regulatePhi(phi0 + dPhiDist, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);  <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].first.emplace_back(<a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">GlobalPosition3D</a>(radiusEnd * std::cos(phiEnd), radiusEnd * std::sin(phiEnd), z1TmpEnd));</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      }</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      ++iter;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    }</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].second = std::array&lt;DataT, 3&gt;{drDist, dPhiDist * r0, dzDist};</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">if</span> (!outFile.empty()) {</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    dumpElectronTracksToTree(electronTracks, nSamplingPoints, outFile.data());</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="keywordflow">return</span> electronTracks;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;}</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::dumpElectronTracksToTree</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d2d/namespaceo2_1_1pmr.html#aeea588f6ab06f06d4131f84d8eea272b">std::vector</a>&lt;std::pair&lt;<a class="code" href="../../dd/d2d/namespaceo2_1_1pmr.html#aeea588f6ab06f06d4131f84d8eea272b">std::vector</a>&lt;<a class="code" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">o2::math_utils::Point3D&lt;float&gt;</a>&gt;, std::array&lt;DataT, 3&gt;&gt;&gt;&amp; electronTracks, <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints, <span class="keyword">const</span> <span class="keywordtype">char</span>* outFile)<span class="keyword"> const</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <a class="code" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a> pcstream(outFile, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  pcstream.GetFile()-&gt;cd();</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160; </div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="keyword">auto</span>&amp; gasParam = <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">ParameterGas::Instance</a>();</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="keyword">auto</span>&amp; eleParam = <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">ParameterElectronics::Instance</a>();</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; electronTracks.size(); ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="keyword">auto</span> electronPath = electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints = electronPath.size();</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span> (electronPath.empty()) {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a>(warning, <span class="stringliteral">&quot;Track is empty. Continue to next track.&quot;</span>);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    std::vector&lt;float&gt; relDriftVel;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    relDriftVel.reserve(nPoints);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPoint = 0; iPoint &lt; (nPoints - 2); ++iPoint) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> relDriftVelTmp = (electronPath[iPoint + 1].Z() - electronPath[iPoint].Z()) / getZMax(getSide(electronPath[iPoint].Z())) * nSamplingPoints; <span class="comment">// comparison of drift distance without distortions and with distortions (rel. drift velocity)</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      relDriftVel.emplace_back(std::abs(relDriftVelTmp));</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="comment">// just copy the last value to avoid wrong values</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    relDriftVel.emplace_back(relDriftVel.back());</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    relDriftVel.emplace_back(relDriftVel.back());</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160; </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distR = electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].second[0];</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distRPhi = electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].second[1];</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distZ = electronTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].second[2];</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160; </div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> driftTime = std::abs(getZMax(getSide(electronPath.front().Z())) - (distZ + electronPath.front().Z())) / gasParam.DriftV;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> timeBin = driftTime / eleParam.ZbinWidth;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160; </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    pcstream &lt;&lt; <span class="stringliteral">&quot;drift&quot;</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;electronPath=&quot;</span> &lt;&lt; electronPath</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;relDriftVel.=&quot;</span> &lt;&lt; relDriftVel <span class="comment">// relative drift velocity in z direction</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;distR=&quot;</span> &lt;&lt; distR</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;distRPhi=&quot;</span> &lt;&lt; distRPhi</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;distZ=&quot;</span> &lt;&lt; distZ</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;driftTime=&quot;</span> &lt;&lt; driftTime</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;timeBin=&quot;</span> &lt;&lt; timeBin</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  }</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  pcstream.Close();</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;}</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160; </div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01664"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6"> 1664</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6">SpaceCharge&lt;DataT&gt;::makeElectronDriftPathGif</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* inpFile, TH2F&amp; hDummy, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> gifSpeed, <span class="keyword">const</span> <span class="keywordtype">int</span> maxsamplingpoints, <span class="keyword">const</span> <span class="keywordtype">char</span>* outName)</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;{</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="comment">// read in the tree and convert to vector of std::vector&lt;o2::tpc::GlobalPosition3D&gt;</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  TFile fInp(inpFile, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  TTree* <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a810321c0bf757979316de72e4c5066ad">tree</a> = (TTree*)fInp.Get(<span class="stringliteral">&quot;drift&quot;</span>);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  std::vector&lt;o2::tpc::GlobalPosition3D&gt;* electronPathTree = <span class="keyword">new</span> std::vector&lt;o2::tpc::GlobalPosition3D&gt;;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a810321c0bf757979316de72e4c5066ad">tree</a>-&gt;SetBranchAddress(<span class="stringliteral">&quot;electronPath&quot;</span>, &amp;electronPathTree);</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  std::vector&lt;std::vector&lt;o2::tpc::GlobalPosition3D&gt;&gt; electronPaths;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  std::vector&lt;o2::tpc::GlobalPosition3D&gt; elePosTmp;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> entries = <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a810321c0bf757979316de72e4c5066ad">tree</a>-&gt;GetEntriesFast();</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; entries; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a810321c0bf757979316de72e4c5066ad">tree</a>-&gt;GetEntry(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    electronPaths.emplace_back(*electronPathTree);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keyword">delete</span> electronPathTree;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  fInp.Close();</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160; </div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  TCanvas can(<span class="stringliteral">&quot;canvas&quot;</span>, <span class="stringliteral">&quot;canvas&quot;</span>, 1000, 600);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  can.SetTopMargin(0.04<a class="code" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  can.SetRightMargin(0.04<a class="code" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>);</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  can.SetBottomMargin(0.12<a class="code" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  can.SetLeftMargin(0.11<a class="code" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>);</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> nElectrons = electronPaths.size();</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  std::vector&lt;int&gt; indexStartEle(nElectrons);</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  std::vector&lt;int&gt; countReadoutReached(nElectrons);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160; </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="comment">// define colors of electrons</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keyword">const</span> std::vector&lt;int&gt; colorsPalette{kViolet + 2, kViolet + 1, kViolet, kViolet - 1, kGreen + 3, kGreen + 2, kGreen + 1, kOrange - 1, kOrange, kOrange + 1, kOrange + 2, kRed - 1, kRed, kRed + 1, kRed + 2, kBlue - 1, kBlue, kBlue + 1, kBlue + 2};</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160; </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="comment">// create for each electron an individual graph</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxPoints = 0;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  std::vector&lt;TGraph&gt; gr(nElectrons);</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nElectrons; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    gr[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].SetMarkerColor(colorsPalette[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> % colorsPalette.size()]);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">if</span> (electronPaths[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a>() &gt; maxPoints) {</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      maxPoints = electronPaths[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160; </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> pointsPerIteration = maxPoints / <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a><span class="keyword">&gt;</span>(maxsamplingpoints);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  std::vector&lt;DataT&gt; zRemainder(nElectrons);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; graph : gr) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      graph.Set(0);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    }</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160; </div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iEle = 0; iEle &lt; nElectrons; ++iEle) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints = electronPaths[iEle].size();</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints = std::round(pointsPerIteration + zRemainder[iEle]);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      zRemainder[iEle] = pointsPerIteration - nPoints;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; electronPath = electronPaths[iEle];</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160; </div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <span class="keywordflow">if</span> (nPoints == 0 &amp;&amp; countReadoutReached[iEle] == 0) {</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> indexPoint = indexStartEle[iEle];</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = electronPath[indexPoint].Rho();</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = electronPath[indexPoint].Z();</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = electronPath[indexPoint].Phi();</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 ? gr[iEle].AddPoint(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius) : gr[iEle].AddPoint(phi, radius);</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      }</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160; </div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPoint = 0; iPoint &lt; nPoints; ++iPoint) {</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> indexPoint = indexStartEle[iEle];</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="keywordflow">if</span> (indexPoint &gt;= nSamplingPoints) {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;          countReadoutReached[iEle] = 1;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160; </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> radius = electronPath[indexPoint].Rho();</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = electronPath[indexPoint].Z();</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phi = electronPath[indexPoint].Phi();</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="keywordflow">if</span> (iPoint == nPoints / 2) {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;          <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 ? gr[iEle].AddPoint(<a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius) : gr[iEle].AddPoint(phi, radius);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        ++indexStartEle[iEle];</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    hDummy.Draw();</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; graph : gr) {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <span class="keywordflow">if</span> (graph.GetN() &gt; 0) {</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        graph.Draw(<span class="stringliteral">&quot;P SAME&quot;</span>);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      }</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    can.Print(Form(<span class="stringliteral">&quot;%s.gif+%i&quot;</span>, outName, gifSpeed));</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160; </div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> sumReadoutReached = std::accumulate(countReadoutReached.begin(), countReadoutReached.end(), 0);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordflow">if</span> (sumReadoutReached == nElectrons) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  }</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  can.Print(Form(<span class="stringliteral">&quot;%s.gif++&quot;</span>, outName));</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;}</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160; </div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01762"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2ac5f10bbe5fbe8d96c75b97a930817c"> 1762</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2ac5f10bbe5fbe8d96c75b97a930817c">SpaceCharge&lt;DataT&gt;::dumpToTree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* outFileName, <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> nZPoints, <span class="keyword">const</span> <span class="keywordtype">int</span> nRPoints, <span class="keyword">const</span> <span class="keywordtype">int</span> nPhiPoints)<span class="keyword"> const</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiSpacing = GridProp::getGridSpacingPhi(nPhiPoints);</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rSpacing = GridProp::getGridSpacingR(nRPoints);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zSpacing = <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? GridProp::getGridSpacingZ(nZPoints) : -GridProp::getGridSpacingZ(nZPoints);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <a class="code" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a> pcstream(outFileName, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  pcstream.<a class="code" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html#ab4841c33ad465c7d4da3b7fd59ec3b79">GetFile</a>()-&gt;cd();</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPhi = 0; iPhi &lt; nPhiPoints; ++iPhi) {</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> phiPos = iPhi * phiSpacing;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = 0; iR &lt; nRPoints; ++iR) {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> rPos = getRMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + iR * rSpacing;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = 0; iZ &lt; nZPoints; ++iZ) {</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> zPos = getZMin(<a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + iZ * zSpacing;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> density = getDensityCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> potential = getPotentialCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160; </div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distZ{};</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distR{};</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> distRPhi{};</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        getDistortionsCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distZ, distR, distRPhi);</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="comment">// get average distortions</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrZ{};</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrR{};</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> corrRPhi{};</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        getCorrectionsCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ, corrR, corrRPhi);</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160; </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lcorrZ{};</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lcorrR{};</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> lcorrRPhi{};</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        getLocalCorrectionsCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, lcorrZ, lcorrR, lcorrRPhi);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160; </div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ldistZ{};</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ldistR{};</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ldistRPhi{};</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        getLocalDistortionsCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, ldistZ, ldistR, ldistRPhi);</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="comment">// get average distortions</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> eZ{};</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> eR{};</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">DataT</a> ePhi{};</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        getElectricFieldsCyl(zPos, rPos, phiPos, <a class="code" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, eZ, eR, ePhi);</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160; </div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        pcstream &lt;&lt; <span class="stringliteral">&quot;sc&quot;</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;phi=&quot;</span> &lt;&lt; phiPos</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;r=&quot;</span> &lt;&lt; rPos</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;z=&quot;</span> &lt;&lt; zPos</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;scdensity=&quot;</span> &lt;&lt; density</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;potential=&quot;</span> &lt;&lt; potential</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;eZ=&quot;</span> &lt;&lt; eZ</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;eR=&quot;</span> &lt;&lt; eR</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;ePhi=&quot;</span> &lt;&lt; ePhi</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;distZ=&quot;</span> &lt;&lt; distZ</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;distR=&quot;</span> &lt;&lt; distR</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;distRPhi=&quot;</span> &lt;&lt; distRPhi</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;corrZ=&quot;</span> &lt;&lt; corrZ</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;corrR=&quot;</span> &lt;&lt; corrR</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;corrRPhi=&quot;</span> &lt;&lt; corrRPhi</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;lcorrZ=&quot;</span> &lt;&lt; lcorrZ</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;lcorrR=&quot;</span> &lt;&lt; lcorrR</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;lcorrRPhi=&quot;</span> &lt;&lt; lcorrRPhi</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;ldistZ=&quot;</span> &lt;&lt; ldistZ</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;ldistR=&quot;</span> &lt;&lt; ldistR</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;ldistRPhi=&quot;</span> &lt;&lt; ldistRPhi</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      }</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    }</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  pcstream.<a class="code" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html#a1dfdda5764b666230fae2e847117388d">Close</a>();</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;}</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160; </div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a name="l01835"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22"> 1835</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22">SpaceCharge&lt;DataT&gt;::normalizeHistoQVEps0</a>(TH3&amp; histoIonsPhiRZ)</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;{</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> deltaPhi = histoIonsPhiRZ.GetXaxis()-&gt;GetBinWidth(1);</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> deltaZ = histoIonsPhiRZ.GetZaxis()-&gt;GetBinWidth(1);</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> fac = deltaPhi * deltaZ * <a class="code" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">o2::tpc::TPCParameters&lt;DataT&gt;::E0</a> / (2 * 100 * TMath::Qe()); <span class="comment">// 100 to normalize to cm: vacuum permittivity [A·s/(V·cm)]</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a> = 1; <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a> &lt;= histoIonsPhiRZ.GetNbinsY(); ++<a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a>) {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> r0 = histoIonsPhiRZ.GetYaxis()-&gt;GetBinLowEdge(<a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a>);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> r1 = histoIonsPhiRZ.GetYaxis()-&gt;GetBinUpEdge(<a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a>);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> norm = fac * (r1 * r1 - r0 * r0);</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi = 1; iphi &lt;= histoIonsPhiRZ.GetNbinsX(); ++iphi) {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">iz</a> = 1; <a class="code" href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">iz</a> &lt;= histoIonsPhiRZ.GetNbinsZ(); ++<a class="code" href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">iz</a>) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> charge = histoIonsPhiRZ.GetBinContent(iphi, <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a>, <a class="code" href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">iz</a>);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        histoIonsPhiRZ.SetBinContent(iphi, <a class="code" href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a>, <a class="code" href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">iz</a>, charge / norm);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      }</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    }</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  }</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;}</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160; </div>
<div class="line"><a name="l01853"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d"> 1853</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a> = double;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataTD&gt;</a>;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160; </div>
<div class="line"><a name="l01856"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#adecbfe0a9b630d5f59491ce8258541b2"> 1856</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a> = <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataTD&gt;</a>;</div>
<div class="line"><a name="l01857"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#adf7cbd7fe4d86c753f6d1b530cdf91cb"> 1857</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a> = <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataTD&gt;</a>;</div>
<div class="line"><a name="l01858"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a43d42999b18ff5a96d2f5400c5d51154"> 1858</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a> = <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataTD&gt;</a>;</div>
<div class="line"><a name="l01859"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#ad1219660c145fabf4a130cf2796f5e43"> 1859</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">O2TPCSpaceCharge3DCalcD</a> = <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataTD&gt;</a>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160; </div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::integrateEFieldsRoot(<span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::integrateEFieldsRoot(<span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcD::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcD::Type</a>, <span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcD::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcD::Type</a>, <span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcD::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcD::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a>&amp;);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160; </div>
<div class="line"><a name="l01874"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a"> 1874</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a> = <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#aebfb0b7e3e9628efbc7f77fa55284840">float</a>;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataTF&gt;</a>;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160; </div>
<div class="line"><a name="l01877"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a4a9a9ce647fc38420dd8733afb52bc27"> 1877</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a> = <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataTF&gt;</a>;</div>
<div class="line"><a name="l01878"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a78bb0a43dd2d99d4c2711a20b52b83cb"> 1878</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a> = <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataTF&gt;</a>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a195b56d4c3729f76f479c3a78bdf5efa"> 1879</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a> = <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataTF&gt;</a>;</div>
<div class="line"><a name="l01880"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a4e23d6527d8451c9c961dbbed5e50b12"> 1880</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">O2TPCSpaceCharge3DCalcF</a> = <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataTF&gt;</a>;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::integrateEFieldsRoot(<span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::integrateEFieldsRoot(<span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <span class="keyword">const</span> <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <a class="code" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a>&amp;, <span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcF::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcF::Type</a>, <span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcF::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcF::Type</a>, <span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcF::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcF::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;);</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a>&amp;);</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a99f1e72b6f806fcad68a339cad9c7a86"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">o2::tpc::SpaceCharge::getLocalDistortionsCyl</a></div><div class="ttdeci">void getLocalDistortionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;ldistZ, DataT &amp;ldistR, DataT &amp;ldistRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01368">SpaceCharge.cxx:1368</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a8d4a5ec380e9bf29fec628a7a2255bcfaeb6d8ae6f20283755b339c0dc273988b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfaeb6d8ae6f20283755b339c0dc273988b">o2::tpc::SpaceCharge::GlobalDistType::Standard</a></div><div class="ttdeci">@ Standard</div><div class="ttdoc">classical method (start calculation of global distortion at each voxel in the tpc and follow electron...</div></div>
<div class="ttc" id="atest__Algorithm_8cxx_html_a5216308b2bcc588018b96379974d290c"><div class="ttname"><a href="../../d2/d0e/test__Algorithm_8cxx.html#a5216308b2bcc588018b96379974d290c">max</a></div><div class="ttdeci">const size_t max</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0e/test__Algorithm_8cxx_source.html#l00044">test_Algorithm.cxx:44</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a3401119c64d85dd8570b26835be31160"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3401119c64d85dd8570b26835be31160">o2::tpc::SpaceCharge::setGlobalDistortionsFromFile</a></div><div class="ttdeci">void setGlobalDistortionsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00559">SpaceCharge.cxx:559</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a6ce451ab1f382618b762cd0510c77472"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a6ce451ab1f382618b762cd0510c77472">o2::tpc::DistCorrInterpolator::evaldZ</a></div><div class="ttdeci">DataT evaldZ(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00226">SpaceChargeHelpers.h:226</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aff7fa9095cf2e4f061143333b6369aa1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">o2::tpc::SpaceCharge::fillChargeDensityFromFile</a></div><div class="ttdeci">void fillChargeDensityFromFile(TFile &amp;fInp, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00679">SpaceCharge.cxx:679</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a76bdf739697723796fcd8110e045b032"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">o2::tpc::SpaceCharge::getDistortions</a></div><div class="ttdeci">void getDistortions(const DataT x, const DataT y, const DataT z, const Side side, DataT &amp;distX, DataT &amp;distY, DataT &amp;distZ) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01460">SpaceCharge.cxx:1460</a></div></div>
<div class="ttc" id="astandalone-cluster-dump-entropy-analysed_8cxx_html_af0baa3ccdd9d2a6adf03b72e2bea5789"><div class="ttname"><a href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a></div><div class="ttdeci">const char * file</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx_source.html#l00052">standalone-cluster-dump-entropy-analysed.cxx:52</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_acaa5cb1a79cbeb9a878f7cc4e86f93bc"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">o2::tpc::SpaceCharge::setChargeDensityFromFormula</a></div><div class="ttdeci">void setChargeDensityFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00192">SpaceCharge.cxx:192</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1NumericalFields_html"><div class="ttname"><a href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">o2::tpc::NumericalFields</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00139">SpaceChargeHelpers.h:139</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a340511ce458d96bcb957243a25f14a4f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">o2::tpc::SpaceCharge::getLocalDistortionVectorCyl</a></div><div class="ttdeci">void getLocalDistortionVectorCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lvecdistZ, DataT &amp;lvecdistR, DataT &amp;lvecdistRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01391">SpaceCharge.cxx:1391</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a3d1e3edfcf61ca2d831883e1afbad89e"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a></div><div class="ttdeci">GLsizeiptr size</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00659">glcorearb.h:659</a></div></div>
<div class="ttc" id="aclasso2_1_1utils_1_1TreeStreamRedirector_html_a1dfdda5764b666230fae2e847117388d"><div class="ttname"><a href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html#a1dfdda5764b666230fae2e847117388d">o2::utils::TreeStreamRedirector::Close</a></div><div class="ttdeci">void Close()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc3/TreeStreamRedirector_8cxx_source.html#l00111">TreeStreamRedirector.cxx:111</a></div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_aa4f840ce7cb69a862630b67217f4da7d"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a></div><div class="ttdeci">double DataTD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01853">SpaceCharge.cxx:1853</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aff760ce186c6f55c70b42e28b6ae32e1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1">o2::tpc::SpaceCharge::calculateElectronDriftPath</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::vector&lt; o2::math_utils::Point3D&lt; float &gt; &gt;, std::array&lt; DataT, 3 &gt; &gt; &gt; calculateElectronDriftPath(const std::vector&lt; GlobalPosition3D &gt; &amp;elePos, const int nSamplingPoints, const std::string_view outFile=&quot;electron_tracks.root&quot;) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01535">SpaceCharge.cxx:1535</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab45e362fb4bf0d9e7a181b7a2637063c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">o2::tpc::SpaceCharge::fillChargeDensityFromHisto</a></div><div class="ttdeci">void fillChargeDensityFromHisto(const TH3 &amp;hisSCDensity3D)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00687">SpaceCharge.cxx:687</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a74d80fd479c0f6d0153c709949a089ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00270">glcorearb.h:270</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2a53c937b510d43a92ff151e1c507aac"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2a53c937b510d43a92ff151e1c507aac">o2::tpc::SpaceCharge::setLocalCorrectionsFromFile</a></div><div class="ttdeci">void setLocalCorrectionsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00607">SpaceCharge.cxx:607</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_ae2d3db041c6004a67047659b42f73a44"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ae2d3db041c6004a67047659b42f73a44">format</a></div><div class="ttdeci">GLint GLint GLsizei GLint GLenum format</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00275">glcorearb.h:275</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a61654209212ec0ab829f8c4da16a2961"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">o2::tpc::SpaceCharge::setEFieldFromFormula</a></div><div class="ttdeci">void setEFieldFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00278">SpaceCharge.cxx:278</a></div></div>
<div class="ttc" id="aclasso2_1_1conf_1_1ConfigurableParamHelper_html_acd640717f419212c67fecff71d876d39"><div class="ttname"><a href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::conf::ConfigurableParamHelper&lt; ParameterGas &gt;::Instance</a></div><div class="ttdeci">static const ParameterGas &amp; Instance()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d6b/ConfigurableParamHelper_8h_source.html#l00076">ConfigurableParamHelper.h:76</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a></div><div class="ttdeci">Side</div><div class="ttdoc">TPC readout sidE.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00037">Defs.h:37</a></div></div>
<div class="ttc" id="anamespaceo2_1_1its_1_1math__utils_html_ac713be41b5cad67abc4e4d0581961905"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">o2::its::math_utils::z1</a></div><div class="ttdeci">float float float float z1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00044">MathUtils.h:44</a></div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_a6cad7be1fe9e41f12c1d66fba3648d6a"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a></div><div class="ttdeci">float DataTF</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01874">SpaceCharge.cxx:1874</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a93c31f250bea4dd2c4e112126cae3898"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a93c31f250bea4dd2c4e112126cae3898">o2::tpc::SpaceCharge::dumpToFile</a></div><div class="ttdeci">void dumpToFile(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00166">SpaceCharge.cxx:166</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5e4c572eda5e6db7ad6a27c8cdf5d74e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">o2::tpc::SpaceCharge::getLocalCorrInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getLocalCorrInterpolator(const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00491">SpaceCharge.cxx:491</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5493891bf440b6e449f8343b306cea76"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5493891bf440b6e449f8343b306cea76">o2::tpc::SpaceCharge::setLocalDistCorrVectorsFromFile</a></div><div class="ttdeci">void setLocalDistCorrVectorsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00664">SpaceCharge.cxx:664</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a44692338c734f401f929f2e7c1c5ef4f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">o2::tpc::SpaceCharge::setPotentialBoundaryFromFormula</a></div><div class="ttdeci">void setPotentialBoundaryFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00225">SpaceCharge.cxx:225</a></div></div>
<div class="ttc" id="aPoissonSolver_8h_html"><div class="ttname"><a href="../../dc/d2a/PoissonSolver_8h.html">PoissonSolver.h</a></div><div class="ttdoc">This class provides implementation of Poisson equation solver by MultiGrid Method Original version of...</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_ac5f253a17f2f1c0f5a0b1e3659de4b19"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">o2::tpc::AnalyticalFields::getSide</a></div><div class="ttdeci">o2::tpc::Side getSide() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00041">SpaceChargeHelpers.h:41</a></div></div>
<div class="ttc" id="aclassROOT_1_1Math_1_1PositionVector3D_html"><div class="ttname"><a href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">ROOT::Math::PositionVector3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/GPUROOTCartesianFwd_8h_source.html#l00036">GPUROOTCartesianFwd.h:36</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ae835161d4fc0064a05655670e8256e1f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">o2::tpc::SpaceCharge::setPotentialFromFormula</a></div><div class="ttdeci">void setPotentialFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00209">SpaceCharge.cxx:209</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_abf5346b1e3ead79c4ad78b4325c3762f"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#abf5346b1e3ead79c4ad78b4325c3762f">o2::tpc::AnalyticalFields::evalEz</a></div><div class="ttdeci">DataT evalEz(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00072">SpaceChargeHelpers.h:72</a></div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_a021e6e023b83ccdc5f7ff44ec3f61d41"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#a021e6e023b83ccdc5f7ff44ec3f61d41">templateClassImp</a></div><div class="ttdeci">templateClassImp(o2::tpc::SpaceCharge)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2ac5f10bbe5fbe8d96c75b97a930817c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2ac5f10bbe5fbe8d96c75b97a930817c">o2::tpc::SpaceCharge::dumpToTree</a></div><div class="ttdeci">void dumpToTree(const char *outFileName, const Side side, const int nZPoints=50, const int nRPoints=150, const int nPhiPoints=180) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01762">SpaceCharge.cxx:1762</a></div></div>
<div class="ttc" id="anamespaceo2_1_1pmr_html_aeea588f6ab06f06d4131f84d8eea272b"><div class="ttname"><a href="../../dd/d2d/namespaceo2_1_1pmr.html#aeea588f6ab06f06d4131f84d8eea272b">o2::pmr::vector</a></div><div class="ttdeci">std::vector&lt; T, o2::pmr::polymorphic_allocator&lt; T &gt; &gt; vector</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d03/MemoryResources_8h_source.html#l00307">MemoryResources.h:307</a></div></div>
<div class="ttc" id="anamespaceo2_1_1dcs_html_a2ff5ac95be3b020fec5e671ab6fe0e7b"><div class="ttname"><a href="../../db/d0e/namespaceo2_1_1dcs.html#a2ff5ac95be3b020fec5e671ab6fe0e7b">o2::dcs::now</a></div><div class="ttdeci">uint64_t now() noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/Clock_8h_source.html#l00069">Clock.h:69</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">o2::tpc::A</a></div><div class="ttdeci">@ A</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00037">Defs.h:37</a></div></div>
<div class="ttc" id="aGPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00412">GPUCommonAlgorithm.h:412</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a21e4e90d70b37c2efe7b37b28a24bf19"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a21e4e90d70b37c2efe7b37b28a24bf19">o2::tpc::AnalyticalFields::evalEphi</a></div><div class="ttdeci">DataT evalEphi(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00078">SpaceChargeHelpers.h:78</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a27fd5e5e157568a28d5859c3695c4375"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">o2::tpc::getZVertex</a></div><div class="ttdeci">DataT getZVertex(const size_t indexZ, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00060">testO2TPCPoissonSolver.cxx:60</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a775660a92e6edeb20ef3da048aede32f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a775660a92e6edeb20ef3da048aede32f">o2::tpc::SpaceCharge::distortElectron</a></div><div class="ttdeci">void distortElectron(GlobalPosition3D &amp;point) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01269">SpaceCharge.cxx:1269</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a08ab2a3a5767a4e41e5461d4fe7b1797"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">o2::tpc::SpaceCharge::getDistortionsCyl</a></div><div class="ttdeci">void getDistortionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;distZ, DataT &amp;distR, DataT &amp;distRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01437">SpaceCharge.cxx:1437</a></div></div>
<div class="ttc" id="aclasso2_1_1field_1_1MagneticField_html_af81094cbf8b590f954df3ec5f58612f8"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">o2::field::MagneticField::solenoidField</a></div><div class="ttdeci">Double_t solenoidField() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00213">MagneticField.h:213</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html">o2::tpc</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbc/SimTraits_8h_source.html#l00160">SimTraits.h:160</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a5a124cae7990696b48d1a5bed028f07f"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a5a124cae7990696b48d1a5bed028f07f">o2::tpc::AnalyticalFields::evalDensity</a></div><div class="ttdeci">DataT evalDensity(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00090">SpaceChargeHelpers.h:90</a></div></div>
<div class="ttc" id="aTreeStreamRedirector_8h_html"><div class="ttname"><a href="../../d1/d22/TreeStreamRedirector_8h.html">TreeStreamRedirector.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a833c070e9513681035f62bdbb9627343"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a833c070e9513681035f62bdbb9627343">o2::tpc::SpaceCharge::dumpLocalDistortions</a></div><div class="ttdeci">int dumpLocalDistortions(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00621">SpaceCharge.cxx:621</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aead8b71aa8906206c4c4e16985d08ddd"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aead8b71aa8906206c4c4e16985d08ddd">o2::tpc::SpaceCharge::setLocalDistortionsFromFile</a></div><div class="ttdeci">void setLocalDistortionsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00649">SpaceCharge.cxx:649</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">o2::tpc::DistCorrInterpolator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00201">SpaceChargeHelpers.h:201</a></div></div>
<div class="ttc" id="aclasso2_1_1utils_1_1TreeStreamRedirector_html"><div class="ttname"><a href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/TreeStreamRedirector_8h_source.html#l00041">TreeStreamRedirector.h:41</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1DataContainer3D_html"><div class="ttname"><a href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">o2::tpc::DataContainer3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dcd/DataContainer3D_8h_source.html#l00038">DataContainer3D.h:38</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5e313e6ec7dee6ce18834a8d37d2c06c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">o2::tpc::SpaceCharge::getGlobalCorrInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getGlobalCorrInterpolator(const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00511">SpaceCharge.cxx:511</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_af48031a37b713afa3b0d0d7d29653d7c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat t1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2e145dc7463fb21cf9f69cd8e7015f48"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">o2::tpc::SpaceCharge::getPotentialCyl</a></div><div class="ttdeci">DataT getPotentialCyl(const DataT z, const DataT r, const DataT phi, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01289">SpaceCharge.cxx:1289</a></div></div>
<div class="ttc" id="aGPUCommonLogger_8h_html_a7320d94921626161019977b54d80d6fe"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#a7320d94921626161019977b54d80d6fe">LOGP</a></div><div class="ttdeci">#define LOGP(type, string,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00061">GPUCommonLogger.h:61</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa9b66acad44dd03078a54712155355e2"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa9b66acad44dd03078a54712155355e2">o2::tpc::SpaceCharge::setElectricFieldsFromFile</a></div><div class="ttdeci">void setElectricFieldsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00535">SpaceCharge.cxx:535</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a827990b889ffd8a32f23fe4ce4cb7441"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a827990b889ffd8a32f23fe4ce4cb7441">o2::tpc::SpaceCharge::poissonSolver</a></div><div class="ttdeci">void poissonSolver(const Side side, const int maxIteration=300, const DataT stoppingConvergence=1e-6, const int symmetry=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00270">SpaceCharge.cxx:270</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5674cfd63645f253612aa395f0b5b085a5e43b95671dcd2d36f760a17c6519686"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5674cfd63645f253612aa395f0b5b085a5e43b95671dcd2d36f760a17c6519686">o2::tpc::SpaceCharge::GlobalDistCorrMethod::LocalDistCorr</a></div><div class="ttdeci">@ LocalDistCorr</div><div class="ttdoc">using local dis/corr interpolator for calculation of global distortions/corrections</div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">o2::tpc::C</a></div><div class="ttdeci">@ C</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00038">Defs.h:38</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a0dcc989405da5da7ac58d984be490881"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881">o2::tpc::SpaceCharge::correctElectron</a></div><div class="ttdeci">void correctElectron(GlobalPosition3D &amp;point)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01254">SpaceCharge.cxx:1254</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a3ddcf5bdc94f41edd8795de3b777a46a"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">o2::tpc::getRVertex</a></div><div class="ttdeci">DataT getRVertex(const size_t indexR, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00052">testO2TPCPoissonSolver.cxx:52</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_1_1painter_html_a05e760026ea24ef56d390ae76cc9d287"><div class="ttname"><a href="../../dd/d9d/namespaceo2_1_1tpc_1_1painter.html#a05e760026ea24ef56d390ae76cc9d287">o2::tpc::painter::convertCalDetToTH3</a></div><div class="ttdeci">TH3F convertCalDetToTH3(const std::vector&lt; CalDet&lt; DataT &gt;&gt; &amp;calDet, const bool norm=true, const int nRBins=150, const float rMin=83.5, const float rMax=254.5, const int nPhiBins=720, const float zMax=1)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d5f/Painter_8cxx_source.html#l00671">Painter.cxx:671</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a2c695f47938da98e89d832edb1d881f1"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a2c695f47938da98e89d832edb1d881f1">o2::tpc::DistCorrInterpolator::getSide</a></div><div class="ttdeci">o2::tpc::Side getSide() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00234">SpaceChargeHelpers.h:234</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a9d2c379302625ac301af5e44e3cca7b2"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a9d2c379302625ac301af5e44e3cca7b2">o2::tpc::DistCorrInterpolator::evaldRPhi</a></div><div class="ttdeci">DataT evaldRPhi(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00232">SpaceChargeHelpers.h:232</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_ac55adc720a3098c1b454d2a4647f4361"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a></div><div class="ttdeci">GLuint start</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00469">glcorearb.h:469</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">o2::tpc::AnalyticalFields</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00036">SpaceChargeHelpers.h:36</a></div></div>
<div class="ttc" id="aGPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00056">GPUCommonLogger.h:56</a></div></div>
<div class="ttc" id="anamespaceo2_1_1mid_html_a3981ab16632142674c332f084fccec9b"><div class="ttname"><a href="../../df/d18/namespaceo2_1_1mid.html#a3981ab16632142674c332f084fccec9b">o2::mid::distY</a></div><div class="ttdeci">std::uniform_real_distribution&lt; float &gt; distY(-68., 68.)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a8d4a5ec380e9bf29fec628a7a2255bcfae16b5b7f26f54214445cbe38d72c2828"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8d4a5ec380e9bf29fec628a7a2255bcfae16b5b7f26f54214445cbe38d72c2828">o2::tpc::SpaceCharge::GlobalDistType::Fast</a></div><div class="ttdeci">@ Fast</div><div class="ttdoc">interpolation of global corrections (use the global corrections to apply an iterative approach to obt...</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab7ddeaf22319914100faa6fcd7c7f4ec"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab7ddeaf22319914100faa6fcd7c7f4ec">o2::tpc::SpaceCharge::dumpGlobalDistortions</a></div><div class="ttdeci">int dumpGlobalDistortions(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00545">SpaceCharge.cxx:545</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad0549b2431c04af932fe5e6b2c3c5043"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043">o2::tpc::SpaceCharge::getElectricFieldsCyl</a></div><div class="ttdeci">void getElectricFieldsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;eZ, DataT &amp;eR, DataT &amp;ePhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01295">SpaceCharge.cxx:1295</a></div></div>
<div class="ttc" id="aRawData_8h_html_a7a83cc244d83d7cdff1229328d79a45e"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a></div><div class="ttdeci">uint32_t side</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d62/RawData_8h_source.html#l00142">RawData.h:142</a></div></div>
<div class="ttc" id="aLogger_8h_html"><div class="ttname"><a href="../../dd/da4/Logger_8h.html">Logger.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a9605d29586015f2f88aa63243964f582"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">o2::tpc::SpaceCharge::getElectricFieldsInterpolator</a></div><div class="ttdeci">NumericalFields&lt; DataT &gt; getElectricFieldsInterpolator(const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00471">SpaceCharge.cxx:471</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa5095db124d7dd5e6e5fb8df3778be64"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa5095db124d7dd5e6e5fb8df3778be64">o2::tpc::SpaceCharge::dumpGlobalCorrections</a></div><div class="ttdeci">int dumpGlobalCorrections(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00569">SpaceCharge.cxx:569</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a821350016d42e87acb42422ab3ed16c2"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">o2::tpc::SpaceCharge::getLocalCorrectionsCyl</a></div><div class="ttdeci">void getLocalCorrectionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lcorrZ, DataT &amp;lcorrR, DataT &amp;lcorrRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01303">SpaceCharge.cxx:1303</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_ac47ba0536e3125bacc267f613372d569"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#ac47ba0536e3125bacc267f613372d569">o2::tpc::DistCorrInterpolator::evaldR</a></div><div class="ttdeci">DataT evaldR(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00220">SpaceChargeHelpers.h:220</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_aef2b3470d9c23d365364d3060d5f68a0"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">o2::tpc::sum</a></div><div class="ttdeci">DataT sum(const Vector&lt; DataT, N &gt; &amp;a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d54/TPC_2spacecharge_2include_2TPCSpaceCharge_2Vector_8h_source.html#l00138">Vector.h:138</a></div></div>
<div class="ttc" id="aclasso2_1_1utils_1_1TreeStreamRedirector_html_ab4841c33ad465c7d4da3b7fd59ec3b79"><div class="ttname"><a href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html#ab4841c33ad465c7d4da3b7fd59ec3b79">o2::utils::TreeStreamRedirector::GetFile</a></div><div class="ttdeci">TFile * GetFile()</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/TreeStreamRedirector_8h_source.html#l00047">TreeStreamRedirector.h:47</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a984c671dc37272789ab30252c8cc2676"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">o2::tpc::SpaceCharge::getCorrectionsCyl</a></div><div class="ttdeci">void getCorrectionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;corrZ, DataT &amp;corrR, DataT &amp;corrRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01326">SpaceCharge.cxx:1326</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a5c4947d4516dd7cfa3505ce3a648a4ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a></div><div class="ttdeci">GLuint const GLchar * name</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1TPCParameters_html"><div class="ttname"><a href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">o2::tpc::TPCParameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d58/PoissonSolverHelpers_8h_source.html#l00061">PoissonSolverHelpers.h:61</a></div></div>
<div class="ttc" id="aclasso2_1_1field_1_1MagneticField_html"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00045">MagneticField.h:45</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a3f687c6ba28de402a264d5e6b6980ec8"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3f687c6ba28de402a264d5e6b6980ec8">o2::tpc::SpaceCharge::calcGlobalCorrections</a></div><div class="ttdeci">void calcGlobalCorrections(const Fields &amp;formulaStruct)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a379d2928f267fad79db62a9287b01246"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a379d2928f267fad79db62a9287b01246">o2::tpc::SpaceCharge::setGlobalCorrectionsFromFile</a></div><div class="ttdeci">void setGlobalCorrectionsFromFile(TFile &amp;inpf, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00583">SpaceCharge.cxx:583</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00843">glcorearb.h:843</a></div></div>
<div class="ttc" id="anamespaceo2_1_1mid_html_aa83623ec04226a365ca631221d719a71"><div class="ttname"><a href="../../df/d18/namespaceo2_1_1mid.html#aa83623ec04226a365ca631221d719a71">o2::mid::distX</a></div><div class="ttdeci">std::uniform_real_distribution&lt; float &gt; distX(-127.5, 127.5)</div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ab2729d1c6becc28660e849f6d60456d2"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ab2729d1c6becc28660e849f6d60456d2">o2::tpc::SIDES</a></div><div class="ttdeci">constexpr unsigned char SIDES</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00043">Defs.h:43</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aac3129a509588df0937376f883788fb6"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6">o2::tpc::SpaceCharge::makeElectronDriftPathGif</a></div><div class="ttdeci">static void makeElectronDriftPathGif(const char *inpFile, TH2F &amp;hBorder, const int type=0, const int gifSpeed=2, const int maxsamplingpoints=100, const char *outName=&quot;electron_drift_path&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01664">SpaceCharge.cxx:1664</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a93c3023de017de4ec63c5e8f906db287"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">o2::tpc::GlobalPosition3D</a></div><div class="ttdeci">math_utils::Point3D&lt; float &gt; GlobalPosition3D</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00102">Defs.h:102</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a670dc917d73d739a3531eacd5f05f176"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">o2::tpc::SpaceCharge::getCorrections</a></div><div class="ttdeci">void getCorrections(const DataT x, const DataT y, const DataT z, const Side side, DataT &amp;corrX, DataT &amp;corrY, DataT &amp;corrZ) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01349">SpaceCharge.cxx:1349</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a277f03e5b92e0b161193e776fac7fe0b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a277f03e5b92e0b161193e776fac7fe0b">o2::tpc::SpaceCharge::rebinDensityHisto</a></div><div class="ttdeci">static TH3DataT rebinDensityHisto(const TH3 &amp;hOrig, const unsigned short nBinsZNew, const unsigned short nBinsRNew, const unsigned short nBinsPhiNew)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00719">SpaceCharge.cxx:719</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa999e778564a14d513990ff202dd81a6"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa999e778564a14d513990ff202dd81a6">o2::tpc::SpaceCharge::calcGlobalDistWithGlobalCorrIterative</a></div><div class="ttdeci">void calcGlobalDistWithGlobalCorrIterative(const DistCorrInterpolator&lt; DataT &gt; &amp;globCorr, const int maxIter=100, const DataT approachZ=0.5, const DataT approachR=0.5, const DataT approachPhi=0.5, const DataT diffCorr=1e-6)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00378">SpaceCharge.cxx:378</a></div></div>
<div class="ttc" id="aMagneticField_8h_html"><div class="ttname"><a href="../../db/d4b/MagneticField_8h.html">MagneticField.h</a></div><div class="ttdoc">Definition of the MagF class.</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5346cddfd4defc158d2afee623814f6c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5346cddfd4defc158d2afee623814f6c">o2::tpc::SpaceCharge::setGrid</a></div><div class="ttdeci">static void setGrid(const unsigned short nZVertices, const unsigned short nRVertices, const unsigned short nPhiVertices)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00048">SpaceCharge.cxx:48</a></div></div>
<div class="ttc" id="aParameterElectronics_8h_html"><div class="ttname"><a href="../../d3/d47/ParameterElectronics_8h.html">ParameterElectronics.h</a></div><div class="ttdoc">Definition of the parameter class for the detector electronics.</div></div>
<div class="ttc" id="aglcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ac6e1ca7a183fc9056bdb9f15ac04b464"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac6e1ca7a183fc9056bdb9f15ac04b464">o2::tpc::SpaceCharge::fillChargeFromCalDet</a></div><div class="ttdeci">void fillChargeFromCalDet(const std::vector&lt; CalDet&lt; float &gt;&gt; &amp;calCharge3D)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00711">SpaceCharge.cxx:711</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a539978c05ed43feae754f81168bdccfd"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">o2::tpc::SpaceCharge::calcLocalDistortionsCorrections</a></div><div class="ttdeci">void calcLocalDistortionsCorrections(const Type type, const ElectricFields &amp;formulaStruct)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a87b0207c6672f0fb60920f7cd60ae8d4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4">o2::tpc::SpaceCharge::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01479">SpaceCharge.cxx:1479</a></div></div>
<div class="ttc" id="aParameterGas_8h_html"><div class="ttname"><a href="../../db/d5b/ParameterGas_8h.html">ParameterGas.h</a></div><div class="ttdoc">Definition of the parameter class for the detector gas.</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab81eb32c44b9187f071b4cc50d9080c8"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">o2::tpc::SpaceCharge::getLocalCorrectionVectorCyl</a></div><div class="ttdeci">void getLocalCorrectionVectorCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lveccorrZ, DataT &amp;lveccorrR, DataT &amp;lveccorrRPhi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01414">SpaceCharge.cxx:1414</a></div></div>
<div class="ttc" id="anamespaceo2_1_1its_1_1math__utils_html_aebfb0b7e3e9628efbc7f77fa55284840"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#aebfb0b7e3e9628efbc7f77fa55284840">o2::its::math_utils::float</a></div><div class="ttdeci">const float</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00038">MathUtils.h:38</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab87ed7a4f08707f4816f99a495dd29ec"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab87ed7a4f08707f4816f99a495dd29ec">o2::tpc::SpaceCharge::dumpElectricFields</a></div><div class="ttdeci">int dumpElectricFields(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00521">SpaceCharge.cxx:521</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html_a196fbcdc355e62e60736768c7aab8189"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a196fbcdc355e62e60736768c7aab8189">o2::tpc::PoissonSolver::setConvergenceError</a></div><div class="ttdeci">static void setConvergenceError(const DataT error)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2a/PoissonSolver_8h_source.html#l00085">PoissonSolver.h:85</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a72c9a75864562f65cb6983dd67d0bd22"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22">o2::tpc::SpaceCharge::normalizeHistoQVEps0</a></div><div class="ttdeci">static void normalizeHistoQVEps0(TH3 &amp;histoIonsPhiRZ)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01835">SpaceCharge.cxx:1835</a></div></div>
<div class="ttc" id="aCalDet_8h_html"><div class="ttname"><a href="../../d8/d81/CalDet_8h.html">CalDet.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aceb6220f59d6f3d24a8e7178317d8e8d"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">o2::tpc::SpaceCharge::getDensityCyl</a></div><div class="ttdeci">DataT getDensityCyl(const DataT z, const DataT r, const DataT phi, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01283">SpaceCharge.cxx:1283</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a887647a028a1218fd6c216d3771ac174"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a887647a028a1218fd6c216d3771ac174">o2::tpc::DataT</a></div><div class="ttdeci">double DataT</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00030">testO2TPCPoissonSolver.cxx:30</a></div></div>
<div class="ttc" id="anamespaceo2_1_1track_html_a567454fb3eaf3ab3023c13f051bd8d99"><div class="ttname"><a href="../../d1/dec/namespaceo2_1_1track.html#a567454fb3eaf3ab3023c13f051bd8d99">o2::track::iz</a></div><div class="ttdeci">const int iz</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d97/TrackUtils_8h_source.html#l00066">TrackUtils.h:66</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_abe08814c2f72843fde4d8df41440d5a0"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a></div><div class="ttdeci">GLboolean r</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a8922a680b00df660c57f47c1971d04c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00298">glcorearb.h:298</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab3ccf914d5c9d28ff5b13883f9501443"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">o2::tpc::SpaceCharge::calcEField</a></div><div class="ttdeci">void calcEField(const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00297">SpaceCharge.cxx:297</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00052">SpaceCharge.h:52</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a7a76ec1f2ac8914d9ab4b6d3c0a3db7b"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">o2::tpc::getPhiVertex</a></div><div class="ttdeci">DataT getPhiVertex(const size_t indexPhi, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00044">testO2TPCPoissonSolver.cxx:44</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_afd1257e191fd2b9e5d9cd50473f6a104"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afd1257e191fd2b9e5d9cd50473f6a104">o2::tpc::SpaceCharge::dumpLocalDistCorrVectors</a></div><div class="ttdeci">int dumpLocalDistCorrVectors(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00635">SpaceCharge.cxx:635</a></div></div>
<div class="ttc" id="atest__ctf__io__ctp_8cxx_html_a7c662e4f033cd397d59721887ffd5c5a"><div class="ttname"><a href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a7c662e4f033cd397d59721887ffd5c5a">ir</a></div><div class="ttdeci">o2::InteractionRecord ir(ir0)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html">o2::tpc::PoissonSolver</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2a/PoissonSolver_8h_source.html#l00045">PoissonSolver.h:45</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_aa857b95cc76669c2a9109239ef40a47c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a></div><div class="ttdeci">GLuint GLfloat * val</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01582">glcorearb.h:1582</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab24f71bac9d25cff4ba12b7fb360cd39"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab24f71bac9d25cff4ba12b7fb360cd39">o2::tpc::SpaceCharge::setFromFile</a></div><div class="ttdeci">void setFromFile(TFile &amp;file, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00179">SpaceCharge.cxx:179</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a950fc91edb4504f62f1c577bf4727c29"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a></div><div class="ttdeci">typedef void(APIENTRYP PFNGLCULLFACEPROC)(GLenum mode)</div></div>
<div class="ttc" id="aglcorearb_8h_html_a6a8efad2e332fcd916bde9e19ddef215"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a></div><div class="ttdeci">GLdouble f</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00310">glcorearb.h:310</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a308dadc8806187b1d96458f9a57e4cf3"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a308dadc8806187b1d96458f9a57e4cf3">o2::tpc::AnalyticalFields::evalEr</a></div><div class="ttdeci">DataT evalEr(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00066">SpaceChargeHelpers.h:66</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a10a709181743c1200590da8f93c877db"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">o2::tpc::SpaceCharge::regulateR</a></div><div class="ttdeci">DataT regulateR(const DataT posR, const Side side) const</div><div class="ttdoc">set r coordinate between 'RMIN - 4 * GRIDSPACINGR' and 'RMAX + 2 * GRIDSPACINGR'. the r coordinate is...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00152">SpaceCharge.cxx:152</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa4af27826aa0fb803ce60a3e803c4642"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642">o2::tpc::SpaceCharge::setDistortionLookupTables</a></div><div class="ttdeci">void setDistortionLookupTables(const DataContainer &amp;distdZ, const DataContainer &amp;distdR, const DataContainer &amp;distdRPhi, const Side side)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01508">SpaceCharge.cxx:1508</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad3ebb9a326377e00a4ec6a5a5c20e11f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">o2::tpc::SpaceCharge::calculateDistortionsCorrections</a></div><div class="ttdeci">void calculateDistortionsCorrections(const o2::tpc::Side side, const bool calcVectors=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00056">SpaceCharge.cxx:56</a></div></div>
<div class="ttc" id="aclassTF1_html"><div class="ttname"><a href="../../d5/d1a/classTF1.html">TF1</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a7d05960f4f1c1b11f3177dc963a45d86"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a></div><div class="ttdeci">GLint GLint GLsizei GLint GLenum GLenum type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00275">glcorearb.h:275</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_ac393c2f9ec370c9bd53f820a02d910af"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">o2::tpc::AnalyticalFields::evalPotential</a></div><div class="ttdeci">DataT evalPotential(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00084">SpaceChargeHelpers.h:84</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad1e9a7cb42eb9c18bb632c133c56373f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">o2::tpc::SpaceCharge::getGlobalDistInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getGlobalDistInterpolator(const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00501">SpaceCharge.cxx:501</a></div></div>
<div class="ttc" id="atest__ctf__io__ctp_8cxx_html_a810321c0bf757979316de72e4c5066ad"><div class="ttname"><a href="../../db/dbc/test__ctf__io__ctp_8cxx.html#a810321c0bf757979316de72e4c5066ad">tree</a></div><div class="ttdeci">std::unique_ptr&lt; TTree &gt; tree((TTree *) flIn.Get(std::string(o2::base::NameConf::CTFTREENAME).c_str()))</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a6618b4bb2dbcb99deb7b9668050e2b19"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6618b4bb2dbcb99deb7b9668050e2b19">o2::tpc::SpaceCharge::calcGlobalDistortions</a></div><div class="ttdeci">void calcGlobalDistortions(const Fields &amp;formulaStruct, const int maxIterations=3 *sSteps *mParamGrid.NZVertices)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01096">SpaceCharge.cxx:1096</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a14c8c621edb520a80aa7196c9b8652ca"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">o2::tpc::SpaceCharge::Type</a></div><div class="ttdeci">Type</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00086">SpaceCharge.h:86</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7cf35cd4d86df75c69cb3a79697775d7"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7cf35cd4d86df75c69cb3a79697775d7">o2::tpc::SpaceCharge::calcLocalDistortionsCorrectionsRK4</a></div><div class="ttdeci">void calcLocalDistortionsCorrectionsRK4(const Type type, const Side side)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a35717cff101e6dee972c4a31c16af78d"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a35717cff101e6dee972c4a31c16af78d">o2::tpc::SpaceCharge::dumpLocalCorrections</a></div><div class="ttdeci">int dumpLocalCorrections(TFile &amp;outf, const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00593">SpaceCharge.cxx:593</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html_a66d868c082110c6929f68a06fb168f3c"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a66d868c082110c6929f68a06fb168f3c">o2::tpc::PoissonSolver::poissonSolver3D</a></div><div class="ttdeci">void poissonSolver3D(DataContainer &amp;matricesV, const DataContainer &amp;matricesCharge, const int symmetry)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/ddc/PoissonSolver_8cxx_source.html#l00035">PoissonSolver.cxx:35</a></div></div>
<div class="ttc" id="aPainter_8h_html"><div class="ttname"><a href="../../d8/db6/Painter_8h.html">Painter.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a8192363c5c378c3d1c54c424bc89e754"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">o2::tpc::SpaceCharge::getLocalDistInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getLocalDistInterpolator(const Side side) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00481">SpaceCharge.cxx:481</a></div></div>
<div class="ttc" id="aSpaceCharge_8h_html"><div class="ttname"><a href="../../d3/db6/SpaceCharge_8h.html">SpaceCharge.h</a></div><div class="ttdoc">This class contains the algorithms for calculation the distortions and corrections.</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a80b688c53b338b77f728a3d32fd01135"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a80b688c53b338b77f728a3d32fd01135">o2::tpc::SpaceCharge::fillChargeDensityFromCalDet</a></div><div class="ttdeci">void fillChargeDensityFromCalDet(const std::vector&lt; CalDet&lt; float &gt;&gt; &amp;calSCDensity3D)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00704">SpaceCharge.cxx:704</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1CalDet_html"><div class="ttname"><a href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">o2::tpc::CalDet&lt; float &gt;</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ae64d2d0ed97678181c4e13cfa993ce5f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">o2::tpc::SpaceCharge::calcLocalDistortionCorrectionVector</a></div><div class="ttdeci">void calcLocalDistortionCorrectionVector(const ElectricFields &amp;formulaStruct)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00935">SpaceCharge.cxx:935</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_a597e8e061b11201a1dff411feb10d0b.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_eb851ed57c05376a3db13e33864acbb2.html">spacecharge</a></li><li class="navelem"><a class="el" href="../../dir_5baa4b952cbb1daf3a28665e1d18d3fd.html">src</a></li><li class="navelem"><a class="el" href="../../da/d8e/SpaceCharge_8cxx.html">SpaceCharge.cxx</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:40:55 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
