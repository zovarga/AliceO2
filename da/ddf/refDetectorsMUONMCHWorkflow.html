<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Workflows</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/ddf/refDetectorsMUONMCHWorkflow.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Workflows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>MCH Workflows</h1>
<ul>
<li><a href="../../#a-note-for-developers">A note for developers</a></li>
<li><a href="../../#raw-to-digits">Raw to digits</a></li>
<li><a href="../../#digit-filtering">Digit filtering</a></li>
<li><a href="../../#time-clustering">Time clustering</a></li>
<li><a href="../../#event-finding">Event finding</a></li>
<li><a href="../../#preclustering">Preclustering</a></li>
<li><a href="../../#clustering">Clustering</a></li>
<li><a href="../../#ctf-encodingdecoding">CTF encoding/decoding</a></li>
<li><a href="../../#local-to-global-cluster-transformation">Local to global cluster transformation</a></li>
<li><a href="../../#tracking">Tracking</a><ul>
<li><a href="../../#original-track-finder">Original track finder</a></li>
<li><a href="../../#new-track-finder">New track finder</a></li>
</ul>
</li>
<li><a href="../../#track-extrapolation-to-vertex">Track extrapolation to vertex</a></li>
<li><a href="../../#track-fitter">Track fitter</a></li>
<li><a href="../../#samplers">Samplers</a><ul>
<li><a href="../../#digit-sampler">Digit sampler</a></li>
<li><a href="../../#cluster-sampler">Cluster sampler</a></li>
<li><a href="../../#cluster-reader">Cluster reader</a></li>
<li><a href="../../#track-sampler">Track sampler</a></li>
<li><a href="../../#track-reader">Track reader</a></li>
<li><a href="../../#vertex-sampler">Vertex sampler</a></li>
</ul>
</li>
<li><a href="../../#sinks">Sinks</a><ul>
<li><a href="../../#precluster-sink">Precluster sink</a></li>
<li><a href="../../#cluster-sink">Cluster sink</a></li>
<li><a href="../../#cluster-writer">Cluster writer</a></li>
<li><a href="../../#track-sink">Track sink</a></li>
<li><a href="../../#track-writer">Track writer</a></li>
</ul>
</li>
</ul>
<h2><a class="el" href="../../d2/d88/classA.html">A</a> note for developers</h2>
<p>When defining a function that returns a <code>DataProcessorSpec</code>, please stick to the following pattern for its parameters : </p><pre class="fragment">DataProcessorSpec getXXX([bool useMC], const char* specName="mch-xxx", other parameters);
</pre><ul>
<li>first parameter, if relevant, should be a boolean indicating whether the processor has to deal with Monte Carlo data or not. For a processor that never has to deal with MC, leave that parameter out</li>
<li>second parameter is the name by which that device will be referenced in all log files, so, in order to be easily recognizable, it <em>must</em> start with the prefix <code>mch-</code></li>
<li>the rest of the parameters (if any) is specific to each device</li>
</ul>
<h2>Raw to digits</h2>
<div class="fragment"><div class="line">o2-mch-raw-to-digits-workflow</div>
</div><!-- fragment --><p>The workflow accepts the following options:</p>
<ul>
<li><code>--debug</code>: enable verbose output</li>
<li><code>--dataspec</code>: selection string for the input data (default: <code>"TF:MCH/RAWDATA"</code>)</li>
<li><code>--cru-map</code>: path to custom CRU mapping file</li>
<li><code>--fec-map</code>: path to custom FEC mapping file</li>
<li><code>--ds2manu</code>: convert channel numbering from Run3 to Run1-2 order</li>
</ul>
<p>Example of a DPL chain to go from a raw data file to a file of preclusters :</p>
<div class="fragment"><div class="line">o2-raw-file-sampler-workflow --input-conf file-reader.cfg --loop 0  -b |</div>
<div class="line">o2-mch-raw-to-digits-workflow -b |</div>
<div class="line">o2-mch-digits-to-preclusters-workflow -b |</div>
<div class="line">o2-mch-preclusters-sink-workflow -b</div>
</div><!-- fragment --><p>where the <code>file-reader.cfg</code> looks like this:</p>
<div class="fragment"><div class="line">[input-0]</div>
<div class="line">dataOrigin = MCH</div>
<div class="line">dataDescription = RAWDATA</div>
<div class="line">filePath = /home/data/data-de819-ped-raw.raw</div>
</div><!-- fragment --><h2>Digit filtering</h2>
<div class="fragment"><div class="line">o2-mch-digits-filtering-workflow</div>
</div><!-- fragment --><p>Filter out some digits. For the moment only removes digits that have a null ADC.</p>
<p>Inputs :</p><ul>
<li>list of all digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) in the current time frame, with the (default) data description <code>DIGITS</code> (can be changed with <code>--input-digits-data-description</code> option)</li>
<li>the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the digits associated to each interaction, with the (default) data description <code>DIGITROFS</code> (can be changed with <code>--input-digit-rofs-data-description</code> option)</li>
</ul>
<p>Outputs :</p><ul>
<li>list of digits that pass the filtering criteria (for the moment ADC&gt;0), with the (default) data description <code>F-DIGITS</code> (can be changed with <code>--output-digits-data-description</code> option)</li>
<li>list of ROF records corresponding to the digits above, with a (default) data description of <code>F-DIGITROFS</code> (can be changed with <code>--output-digit-rofs-data-description</code> option)</li>
</ul>
<h2>Time clustering</h2>
<div class="fragment"><div class="line">o2-mch-digits-to-timeclusters-workflow</div>
</div><!-- fragment --><p>Take as input the list of all digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) in the current time frame, with the data description "DIGITS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the digits associated to each interaction, with the data description "DIGITROFS". Send a new list of ROF records that combine all the digits correlated in time within a user-defined time window, with the data description "TIMECLUSTERROFS".</p>
<p>The option <code>--time-cluster-width xxx</code> allows to set the width of the time correlation window.</p>
<p>The time clustering is based on a brute-force peak search algorithm, which arranges the input digits into coarse time bins. The number of bins in one time cluster window can be set via the <code>--peak-search-nbins</code> option.</p>
<h2>Event finding</h2>
<div class="fragment"><div class="line">o2-mch-event-finder-workflow</div>
</div><!-- fragment --><p>Inputs :</p><ul>
<li>list of all MCH digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) in the current time frame, with the (default) data description <code>F-DIGITS</code> (can be changed with <code>--input-digits-data-description</code> option)</li>
<li>list of MCH ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the digits associated to each ROF, with the (default) data description <code>F-DIGITROFS</code> (can be changed with <code>--input-digit-rofs-data-description</code> option)</li>
<li>list of MID ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MID/include/DataFormatsMID/ROFRecord.h">ROFRecord</a>) used to trigger the event finding, with the data description <code>TRACKROFS</code></li>
</ul>
<p>Outputs :</p><ul>
<li>list of MCH digits associated to an event, with the (default) data description <code>E-F-DIGITS</code> (can be changed with <code>--output-digits-data-description</code> option)</li>
<li>list of MCH ROF records pointing to the digits associated to each event, with the (default) data description <code>E-F-DIGITROFS</code> (can be changed with <code>--output-digit-rofs-data-description</code> option)</li>
</ul>
<p>Option <code>--mch-config "file.json"</code> or <code>--mch-config "file.ini"</code> allows to change the triggering parameters from a configuration file. This file can be either in JSON or in INI format, as described below:</p>
<ul>
<li>Example of configuration file in JSON format: <div class="fragment"><div class="line">{</div>
<div class="line">    &quot;MCHTriggering&quot;: {</div>
<div class="line">        &quot;triggerRange[0]&quot;: &quot;-3&quot;,</div>
<div class="line">        &quot;triggerRange[1]&quot;: &quot;3&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Example of configuration file in INI format: <div class="fragment"><div class="line">[MCHTriggering]</div>
<div class="line">triggerRange[0]=-3</div>
<div class="line">triggerRange[1]=3</div>
</div><!-- fragment --></li>
</ul>
<p>Option <code>--configKeyValues "key1=value1;key2=value2;..."</code> allows to change the triggering parameters from the command line. The parameters changed from the command line will supersede the ones changed from a configuration file.</p>
<ul>
<li>Example of parameters changed from the command line: <div class="fragment"><div class="line">--configKeyValues &quot;MCHTriggering.triggerRange[0]=-3;MCHTriggering.triggerRange[1]=3&quot;</div>
</div><!-- fragment --></li>
</ul>
<h2>Preclustering</h2>
<div class="fragment"><div class="line">o2-mch-digits-to-preclusters-workflow</div>
</div><!-- fragment --><p>Take as input the list of all digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) in the current time frame, with the data description "DIGITS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the digits associated to each interaction. The ROF records input can have the data description "inputrofs:MCH/DIGITROFS" if the direct output of the raw decoder is used, or "inputrofs:MCH/TIMECLUSTERROFS" if the time clustering output is used (default option). The ROF input description can be set on the command line via the <code>rof-spec</code> option.</p>
<p>Send the list of all preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>) in the time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the preclusters associated to each interaction in three separate messages with the data description "PRECLUSTERS", "PRECLUSTERDIGITS" and "PRECLUSTERROFS", respectively.</p>
<p>Option <code>--check-no-leftover-digits xxx</code> allows to drop an error message (<code>xxx = "error"</code> (default)) or an exception (<code>xxx = "fatal"</code>) in case not all the input digits end up in a precluster, or to disable this check (<code>xxx = "off"</code>).</p>
<h2>Clustering</h2>
<div class="fragment"><div class="line">o2-mch-preclusters-to-clusters-original-workflow</div>
</div><!-- fragment --><p>Take as input the list of all preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>) in the current time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the preclusters associated to each interaction, with the data description "PRECLUSTERS", "PRECLUSTERDIGITS" and "PRECLUSTERROFS", respectively. Send the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction in three separate messages with the data description "CLUSTERS", "CLUSTERDIGITS" and "CLUSTERROFS", respectively.</p>
<p>Option <code>--run2-config</code> allows to configure the clustering to process run2 data.</p>
<p>Option <code>--mch-config "file.json"</code> or <code>--mch-config "file.ini"</code> allows to change the clustering parameters from a configuration file. This file can be either in JSON or in INI format, as described below:</p>
<ul>
<li>Example of configuration file in JSON format: <div class="fragment"><div class="line">{</div>
<div class="line">    &quot;MCHClustering&quot;: {</div>
<div class="line">        &quot;lowestPadCharge&quot;: &quot;4.&quot;,</div>
<div class="line">        &quot;defaultClusterResolution&quot;: &quot;0.4&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Example of configuration file in INI format: <div class="fragment"><div class="line">[MCHClustering]</div>
<div class="line">lowestPadCharge=4.</div>
<div class="line">defaultClusterResolution=0.4</div>
</div><!-- fragment --></li>
</ul>
<p>Option <code>--configKeyValues "key1=value1;key2=value2;..."</code> allows to change the clustering parameters from the command line. The parameters changed from the command line will supersede the ones changed from a configuration file.</p>
<ul>
<li>Example of parameters changed from the command line: <div class="fragment"><div class="line">--configKeyValues &quot;MCHClustering.lowestPadCharge=4.;MCHClustering.defaultClusterResolution=0.4&quot;</div>
</div><!-- fragment --></li>
</ul>
<h2>CTF encoding/decoding</h2>
<p>Entropy encoding is done be attaching the <code>o2-mch-entropy-encoder-workflow</code> to the output of <code>DIGITS</code> and <code>DIGITROF</code> data-descriptions, providing <code>Digit</code> and <code>ROFRecord</code> respectively. Afterwards the encoded data can be stored by the <code>o2-ctf-writer-workflow</code>.</p>
<div class="fragment"><div class="line">o2-raw-file-reader-workflow --input-conf raw/MCH/MCHraw.cfg | o2-mch-raw-to-digits-workflow  | o2-mch-entropy-encoder-workflow | o2-ctf-writer-workflow --onlyDet MCH</div>
</div><!-- fragment --><p>The decoding is done automatically by the <code>o2-ctf-reader-workflow</code>.</p>
<h2>Local to global cluster transformation</h2>
<p>The <code>o2-mch-clusters-transformer-workflow</code> takes as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>), in local reference frame, in the current time frame, with the data description "CLUSTERS".</p>
<p>It sends the list of the same clusters, but converted in global reference frame, with the data description "GLOBALCLUSTERS".</p>
<p>To test it one can use e.g. a sampler-transformer-sink pipeline as such :</p>
<div class="fragment"><div class="line">o2-mch-clusters-sampler-workflow</div>
<div class="line">    -b --nEventsPerTF 1000 --infile someclusters.data |</div>
<div class="line">o2-mch-clusters-transformer-workflow</div>
<div class="line">    -b --geometry Detectors/MUON/MCH/Geometry/Test/ideal-geometry-o2.json |</div>
<div class="line">o2-mch-clusters-sink-workflow</div>
<div class="line">    -b --txt --outfile global-clusters.txt --no-digits --global</div>
</div><!-- fragment --><h2>Tracking</h2>
<h3>Original track finder</h3>
<div class="fragment"><div class="line">o2-mch-clusters-to-tracks-original-workflow</div>
</div><!-- fragment --><p>Take as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "CLUSTERS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS". Send the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction in three separate messages with the data description "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively.</p>
<p><a class="el" href="../../db/d4f/structOptions.html">Options</a> <code>--l3Current xxx</code> and <code>--dipoleCurrent yyy</code> allow to specify the current in L3 and in the dipole to be used to set the magnetic field.</p>
<p>Option <code>--debug x</code> allows to enable the debug level x (0 = no debug, 1 or 2).</p>
<p>Option <code>--mch-config "file.json"</code> or <code>--mch-config "file.ini"</code> allows to change the tracking parameters from a configuration file. This file can be either in JSON or in INI format, as described below:</p>
<ul>
<li>Example of configuration file in JSON format: <div class="fragment"><div class="line">{</div>
<div class="line">    &quot;MCHTracking&quot;: {</div>
<div class="line">        &quot;chamberResolutionY&quot;: &quot;0.1&quot;,</div>
<div class="line">        &quot;requestStation[1]&quot;: &quot;false&quot;,</div>
<div class="line">        &quot;moreCandidates&quot;: &quot;true&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Example of configuration file in INI format: <div class="fragment"><div class="line">[MCHTracking]</div>
<div class="line">chamberResolutionY=0.1</div>
<div class="line">requestStation[1]=false</div>
<div class="line">moreCandidates=true</div>
</div><!-- fragment --></li>
</ul>
<p>Option <code>--configKeyValues "key1=value1;key2=value2;..."</code> allows to change the tracking parameters from the command line. The parameters changed from the command line will supersede the ones changed from a configuration file.</p>
<ul>
<li>Example of parameters changed from the command line: <div class="fragment"><div class="line">--configKeyValues &quot;MCHTracking.chamberResolutionY=0.1;MCHTracking.requestStation[1]=false;MCHTracking.moreCandidates=true&quot;</div>
</div><!-- fragment --></li>
</ul>
<h3>New track finder</h3>
<div class="fragment"><div class="line">o2-mch-clusters-to-tracks-workflow</div>
</div><!-- fragment --><p>Same behavior and options as <a href="../../#original-track-finder">Original track finder</a></p>
<h2>Track extrapolation to vertex</h2>
<div class="fragment"><div class="line">o2-mch-tracks-to-tracks-at-vertex-workflow</div>
</div><!-- fragment --><p>Take as input the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the current time frame, the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction and their vertex position (<code>Point3D&lt;double&gt;</code>), with the data description "TRACKS", "TRACKROFS" and "VERTICES", respectively. Send the list of all tracks at vertex (<code>TrackAtVtxStruct</code> as described below) in the time frame with the data description "TRACKSATVERTEX".</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>TrackAtVtxStruct {</div>
<div class="line">  TrackParamStruct paramAtVertex{};</div>
<div class="line">  <span class="keywordtype">double</span> dca = 0.;</div>
<div class="line">  <span class="keywordtype">double</span> rAbs = 0.;</div>
<div class="line">  <span class="keywordtype">int</span> mchTrackIdx = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="el" href="../../db/d4f/structOptions.html">Options</a> <code>--l3Current xxx</code> and <code>--dipoleCurrent yyy</code> allow to specify the current in L3 and in the dipole to be used to set the magnetic field.</p>
<h2>Track fitter</h2>
<div class="fragment"><div class="line">o2-mch-tracks-to-tracks-workflow</div>
</div><!-- fragment --><p>Take as input the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the current time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction, with the data description "TRACKSIN", "TRACKCLUSTERSIN" and "TRACKROFSIN", respectively. Send the list of all refitted MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction in three separate messages with the data description "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively.</p>
<p><a class="el" href="../../db/d4f/structOptions.html">Options</a> <code>--l3Current xxx</code> and <code>--dipoleCurrent yyy</code> allow to specify the current in L3 and in the dipole to be used to set the magnetic field.</p>
<h2>Samplers</h2>
<h3>Digit sampler</h3>
<div class="fragment"><div class="line">o2-mch-digits-sampler-workflow --infile &quot;digits.in&quot;</div>
</div><!-- fragment --><p>where <code>digits.in</code> is a binary file containing for each event:</p>
<ul>
<li>number of digits (int)</li>
<li>list of digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)</li>
</ul>
<p>Send the list of all digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) in the current time frame, with the data description "DIGITS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the digits associated to each interaction, with the data description "DIGITROFS".</p>
<p>Option <code>--useRun2DigitUID</code> allows to specify that the input digits data member mPadID contains the digit UID in run2 format and need to be converted in the corresponding run3 pad ID.</p>
<p>Option <code>--print</code> allows to print the digitUID - padID conversion in the terminal.</p>
<p>Option <code>--nEvents xxx</code> allows to limit the number of events to process (all by default).</p>
<p>Option <code>--event xxx</code> allows to process only this event.</p>
<p>Option <code>--nEventsPerTF xxx</code> allows to set the number of events (i.e. ROF records) to send per time frame (default = 1).</p>
<h3>Cluster sampler</h3>
<div class="fragment"><div class="line">o2-mch-clusters-sampler-workflow --infile &quot;clusters.in&quot; [--global]</div>
</div><!-- fragment --><p>where <code>clusters.in</code> is a binary file containing for each event:</p>
<ul>
<li>number of clusters (int)</li>
<li>number of associated digits (int)</li>
<li>list of clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)</li>
</ul>
<p>Send the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "CLUSTERS" (or "GLOBALCLUSTERS" if <code>--global</code> option is used), and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS".</p>
<p>Option <code>--nEventsPerTF xxx</code> allows to set the number of events (i.e. ROF records) to send per time frame (default = 1).</p>
<h3>Cluster reader</h3>
<div class="fragment"><div class="line">o2-mch-clusters-reader-workflow --infile mchclusters.root [--enable-mc] [--local] [--digits]</div>
</div><!-- fragment --><p>Send the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "GLOBALCLUSTERS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS".</p>
<p>Option <code>--local</code> assumes that clusters are in the local coordinate system and send them with the description "CLUSTERS".</p>
<p>Option <code>--digits</code> allows to also send the associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) with the data description "CLUSTERDIGITS".</p>
<p>Option <code>--enable-mc</code> allows to also send the cluster MC labels with the data description "CLUSTERLABELS".</p>
<h3>Track sampler</h3>
<div class="fragment"><div class="line">o2-mch-tracks-sampler-workflow --infile &quot;tracks.in&quot;</div>
</div><!-- fragment --><p>where <code>tracks.in</code> is a binary file with the same format as the one written by the workflow <a href="../../#track-sink">o2-mch-tracks-sink-workflow</a></p>
<p>Send the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the current time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction in three separate messages with the data description "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively.</p>
<p>Option <code>--forTrackFitter</code> allows to send the messages with the data description "TRACKSIN", "TRACKCLUSTERSIN" and TRACKROFSIN, respectively, as expected by the workflow <a href="../../#track-fitter">o2-mch-tracks-to-tracks-workflow</a>.</p>
<p>Option <code>--nEventsPerTF xxx</code> allows to set the number of events (i.e. ROF records) to send per time frame (default = 1).</p>
<h3>Track reader</h3>
<div class="fragment"><div class="line">o2-mch-tracks-reader-workflow --infile mchtracks.root</div>
</div><!-- fragment --><p>Does the same work as the <a href="../../#track-sampler">Track sampler</a> but starting from a Root file (<code>mchtracks.root</code>) containing <code>TRACKS</code>, <code>TRACKROFS</code> and <code>TRACKCLUSTERS</code> containers written e.g. by the <a href="../../#track-writer">o2-mch-tracks-writer-workflow</a>. Note that a very basic utility also exists to get a textual dump of a Root tracks file : <code>o2-mch-tracks-file-dumper</code>.</p>
<h3>Vertex sampler</h3>
<div class="fragment"><div class="line">o2-mch-vertex-sampler-workflow</div>
</div><!-- fragment --><p>Take as input the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) in the current time frame, with the data description "TRACKROFS". Send the list of all vertex positions (<code>Point3D&lt;double&gt;</code>) in the time frame, one per interaction, with the data description "VERTICES".</p>
<p>Option <code>--infile "vertices.in"</code> allows to read the position of the vertex from the binary file <code>vertices.in</code> containing for each event:</p>
<ul>
<li>event number (int)</li>
<li>x (double)</li>
<li>y (double)</li>
<li>z (double)</li>
</ul>
<p>If no binary file is provided, the vertex is always set to (0,0,0).</p>
<h2>Sinks</h2>
<h3>Precluster sink</h3>
<div class="fragment"><div class="line">o2-mch-preclusters-sink-workflow --outfile &quot;preclusters.out&quot;</div>
</div><!-- fragment --><p>Take as input the list of all preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>) in the current time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the preclusters associated to each interaction, with the data description "PRECLUSTERS", "PRECLUSTERDIGITS" and "PRECLUSTERROFS", respectively, and write them event-by-event in the binary file <code>preclusters.out</code> with the following format for each event:</p>
<ul>
<li>number of preclusters (int)</li>
<li>number of associated digits (int)</li>
<li>list of preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)</li>
</ul>
<p>Option <code>--txt</code> allows to write the preclusters in the output file in text format.</p>
<p>Option <code>--useRun2DigitUID</code> allows to convert the run3 pad ID stored in the digit data member mPadID into a digit UID in run2 format.</p>
<h3>Cluster sink</h3>
<div class="fragment"><div class="line">o2-mch-clusters-sink-workflow --outfile &quot;clusters.out&quot; [--txt] [--no-digits] [--global]</div>
</div><!-- fragment --><p>Take as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, and, optionnally, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERS" (or "GLOBALCLUSTERS" if <code>--global</code> option is used), "CLUSTERDIGITS" (unless <code>--no-digits</code> option is used) and "CLUSTERROFS", respectively, and write them event-by-event in the binary file <code>clusters.out</code> with the following format for each event:</p>
<ul>
<li>number of clusters (int)</li>
<li>number of associated digits (int) (= 0 if <code>--no-digits</code> is used)</li>
<li>list of clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)(unless option <code>--no-digits</code> is used)</li>
</ul>
<p>Option <code>--txt</code> allows to write the clusters in the output file in text format.</p>
<p>Option <code>--useRun2DigitUID</code> allows to convert the run3 pad ID stored in the digit data member mPadID into a digit UID in run2 format.</p>
<h3>Cluster writer</h3>
<div class="fragment"><div class="line">o2-mch-clusters-writer-workflow [--enable-mc] [--local] [--no-digits]</div>
</div><!-- fragment --><p>Take as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "GLOBALCLUSTERS", the list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>), with the data description "CLUSTERDIGITS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS", and write them in the root file "mchclusters.root".</p>
<p>Option <code>--local</code> allows to write the list of clusters in the local coordinate system, with the data description "CLUSTERS".</p>
<p>Option <code>--no-digits</code> allows to do not write the associated digits.</p>
<p>Option <code>--enable-mc</code> allows to also write the cluster MC labels, with the data description "CLUSTERLABELS".</p>
<h3>Track sink</h3>
<div class="fragment"><div class="line">o2-mch-tracks-sink-workflow --outfile &quot;tracks.out&quot;</div>
</div><!-- fragment --><p>Take as input the list of all tracks at vertex (<a href="../../#track-extrapolation-to-vertex">TrackAtVtxStruct</a>) in the current time frame, the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>), the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the MCH tracks associated to each interaction, with the data description "TRACKSATVERTEX", "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively, and write them event-by-event in the binary file <code>tracks.out</code> with the following format for each event:</p>
<ul>
<li>number of tracks at vertex (int)</li>
<li>number of MCH tracks (int)</li>
<li>number of associated clusters (int)</li>
<li>list of tracks at vertex (<a href="../../#track-extrapolation-to-vertex">TrackAtVtxStruct</a>)</li>
<li>list of MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>)</li>
<li>list of associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
</ul>
<p>Option <code>--tracksAtVertexOnly</code> allows to take as input and write only the tracks at vertex (number of MCH tracks and number of associated clusters = 0).</p>
<p>Option <code>--mchTracksOnly</code> allows to take as input and write only the MCH tracks and associated clusters (number of tracks at vertex = 0).</p>
<h3>Track writer</h3>
<div class="fragment"><div class="line">o2-mch-tracks-writer-workflow --outfile &quot;mchtracks.root&quot;</div>
</div><!-- fragment --><p>Does the same kind of work as the <a href="../../#track-sink">track sink</a> but the output is in Root format instead of custom binary one. It is implemented using the generic <a href="../..//DPLUtils/MakeRootTreeWriterSpec.h">MakeRootTreeWriterSpec</a> and thus offers the same options. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dff/refDetectorsMUON.html">MUON</a></li><li class="navelem"><a class="el" href="../../d0/daf/refDetectorsMUONMCH.html">MCH</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:41:08 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
