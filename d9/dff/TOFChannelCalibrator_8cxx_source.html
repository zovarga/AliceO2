<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/runner/work/AliceO2/AliceO2/Detectors/TOF/calibration/src/TOFChannelCalibrator.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d9/dff/TOFChannelCalibrator_8cxx_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TOFChannelCalibrator.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/dff/TOFChannelCalibrator_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2019-2020 CERN and copyright holders of ALICE O2.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// See https://alice-o2.web.cern.ch/copyright for details of the copyright holders.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// All rights not expressly granted are reserved.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This software is distributed under the terms of the GNU General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License v3 (GPL Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dc2/TOFChannelCalibrator_8h.html">TOFCalibration/TOFChannelCalibrator.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/Logger_8h.html">Framework/Logger.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;TStopwatch.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;Fit/Fitter.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;Fit/BinData.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;Math/WrappedMultiTF1.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span>tof</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a> = <a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">o2::calibration::TimeSlot&lt;o2::tof::TOFChannelData&gt;</a>;</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../d7/dae/namespaceo2_1_1tof.html#a3973e777d569ad62c68b4d7dcbbb657d">   32</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">TimeSlewing</a> = <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">o2::dataformats::CalibTimeSlewingParamTOF</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">clbUtils</a> = <a class="code" href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">o2::calibration::Utils</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> boost::histogram::indexed;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d7/dae/namespaceo2_1_1tof.html">o2::tof</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//using boost::histogram::algorithm; // not sure why it does not work...</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">   39</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">TOFChannelData::fill</a>(<span class="keyword">const</span> gsl::span&lt;const o2::dataformats::CalibInfoTOF&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// check on multiplicity to avoid noisy events (SAFE MODE)</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> ntf = 0;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> sumDt = 0;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">if</span> (mSafeMode) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">float</span> sumdt = 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">int</span> ngood = 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> = 0; <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>.size(); <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>++) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="keywordtype">float</span> dtraw = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>].getDeltaTimePi();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordtype">float</span> dt = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">getTimeCalibration</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>].getTOFChIndex(), <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>].getTot());</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">if</span> (dt &gt; -50000 &amp;&amp; dt &lt; 50000) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        sumdt += dt;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        ngood++;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (ngood) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      sumdt /= ngood;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      sumDt += sumdt;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      ntf++;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">if</span> (ntf &amp;&amp; (sumdt &gt; 5000 + sumDt / ntf || sumdt &lt; -5000 + sumDt / ntf)) { <span class="comment">// skip TF since it is very far from average behaviour (probably noise if detector already partial calibrated)</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// fill container</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>.size(); <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--;) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">auto</span> ch = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTOFChIndex();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">int</span> sector = ch / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">int</span> chInSect = ch % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">auto</span> dt = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getDeltaTimePi();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">auto</span> tot = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTot();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// TO BE DISCUSSED: could it be that the LHCphase is too old? If we ar ein sync mode, it could be that it is not yet created for the current run, so the one from the previous run (which could be very old) is used. But maybe it does not matter much, since soon enough a calibrated LHC phase should be produced</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">auto</span> corr = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">getTimeCalibration</a>(ch, tot); <span class="comment">// we take into account LHCphase, offsets and time slewing</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">auto</span> dtcorr = dt - corr;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// add calib info for computation of LHC phase</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#a41fb6a309fd255c39d87453254492034">Utils::addCalibTrack</a>(dtcorr);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    dtcorr -= <a class="code" href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#a5f452177904878a16144ade530f21e93">Utils::mLHCPhase</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;LHCphase = &quot;</span> &lt;&lt; <a class="code" href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#a5f452177904878a16144ade530f21e93">Utils::mLHCPhase</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    mChannelDist-&gt;Fill(ch, dtcorr);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (!mPerStrip) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      mHisto[sector](dtcorr, chInSect); <span class="comment">// we pass the calibrated time</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      mEntries[ch] += 1;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordtype">int</span> istrip = ch / 96;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordtype">int</span> istripInSector = chInSect / 96;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keywordtype">int</span> halffea = (chInSect % 96) / 12;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordtype">int</span> choffset = (istrip - istripInSector) * 96;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">//int minch = istripInSector * 96;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="comment">//int maxch = minch + 96;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordtype">int</span> minch = istripInSector * 96 + halffea * 12;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordtype">int</span> maxch = minch + 12;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ich = minch; ich &lt; maxch; ich++) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        mHisto[sector](dtcorr, ich); <span class="comment">// we pass the calibrated time</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        mEntries[ich + choffset] += 1;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a7275108ac647cf2263c76534eadcc94f">  112</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">TOFChannelData::fill</a>(<span class="keyword">const</span> gsl::span&lt;const o2::tof::CalibInfoCluster&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">// fill container</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>.size(); <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--;) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">auto</span> ch = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getCH();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keyword">auto</span> dch = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getDCH(); <span class="comment">// this is a char! if you print it, you need to cast it to int</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">auto</span> dt = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getDT();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">auto</span> tot1 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTOT1();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">auto</span> tot2 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTOT2();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// we order them so that the channel number of the first cluster is smaller than</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// the one of the second cluster</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (dch &lt; 0) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      ch += dch;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      dt = -dt;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      dch = -dch;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordtype">float</span> inv = tot1;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      tot1 = tot2;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      tot2 = inv;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">int</span> sector = ch / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">int</span> absoluteStrip = ch / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">Geo::NPADS</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">int</span> stripInSect = absoluteStrip % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a52f130aea4ceee8757a03e4adbefad92">Geo::NSTRIPXSECTOR</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">int</span> shift = 0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (dch == 1) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      shift = 0; <span class="comment">// 2nd channel is on the right</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dch == 48) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      shift = 1; <span class="comment">// 2nd channel is at the top</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">int</span> chOnStrip = ch % 96;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">int</span> comb = 96 * shift + chOnStrip; <span class="comment">// index of the current pair of clusters on the strip; there are in total 96 + 48</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">auto</span> corr1 = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">getTimeCalibration</a>(ch, tot1);       <span class="comment">// we take into account LHCphase, offsets and time slewing</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">auto</span> corr2 = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">getTimeCalibration</a>(ch + dch, tot2); <span class="comment">// we take into account LHCphase, offsets and time slewing</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;inserting in channel &quot;</span> &lt;&lt; ch &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; ch + dch &lt;&lt; <span class="stringliteral">&quot;: dt = &quot;</span> &lt;&lt; dt &lt;&lt; <span class="stringliteral">&quot;, tot1 = &quot;</span> &lt;&lt; tot1 &lt;&lt; <span class="stringliteral">&quot;, tot2 = &quot;</span> &lt;&lt; tot2 &lt;&lt; <span class="stringliteral">&quot;, corr1 = &quot;</span> &lt;&lt; corr1 &lt;&lt; <span class="stringliteral">&quot;, corr2 = &quot;</span> &lt;&lt; corr2 &lt;&lt; <span class="stringliteral">&quot;, corrected dt = &quot;</span> &lt;&lt; dt - corr1 + corr2;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    dt -= corr1 - corr2;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">int</span> combInSect = comb + stripInSect * <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a0d278f986cbaae17e4af336f2431f89f">NCOMBINSTRIP</a>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;ch = &quot;</span> &lt;&lt; ch &lt;&lt; <span class="stringliteral">&quot;, sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot;, absoluteStrip = &quot;</span> &lt;&lt; absoluteStrip &lt;&lt; <span class="stringliteral">&quot;, stripInSect = &quot;</span> &lt;&lt; stripInSect &lt;&lt; <span class="stringliteral">&quot;, shift = &quot;</span> &lt;&lt; shift &lt;&lt; <span class="stringliteral">&quot;, dch = &quot;</span> &lt;&lt; (<a class="code" href="../../df/d73/namespaceo2_1_1its_1_1gpu_1_1utils_1_1device.html#a4679f96aa931479958ac05d8c19002de">int</a>)dch &lt;&lt; <span class="stringliteral">&quot;, chOnStrip = &quot;</span> &lt;&lt; chOnStrip &lt;&lt; <span class="stringliteral">&quot;, comb = &quot;</span> &lt;&lt; comb;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    mHisto[sector](dt, combInSect); <span class="comment">// we pass the difference of the *calibrated* times</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    mEntries[comb + <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a0d278f986cbaae17e4af336f2431f89f">NCOMBINSTRIP</a> * absoluteStrip] += 1;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    mChannelDist-&gt;Fill(comb + <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a0d278f986cbaae17e4af336f2431f89f">NCOMBINSTRIP</a> * absoluteStrip, dt);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">  167</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">TOFChannelData::merge</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">TOFChannelData</a>* prev)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// merge data of 2 slots</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isect = 0; isect &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a>; isect++) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    mHisto[isect] += prev-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a1777d0fe702c095d9819568246bc63cf">getHisto</a>(isect);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iel = 0; iel &lt; mEntries.size(); iel++) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    mEntries[iel] += prev-&gt;mEntries[iel];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">  179</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">TOFChannelData::hasEnoughData</a>(<span class="keywordtype">int</span> minEntries)<span class="keyword"> const</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">// true if all channels can be fitted --&gt; have enough statistics</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">// We consider that we have enough entries if the mean of the number of entries in the channels</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// with at least one entry is greater than the cut at &quot;minEntries&quot;</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// Channels/pairs with zero entries are assumed to be off --&gt; we do not consider them</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">//printEntries();</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">int</span> nValid = 0;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">float</span> mean = 0;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">int</span> smallestElementIndex = -1;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">int</span> smallestEntries = 1e5;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">int</span> largestElementIndex = -1;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">int</span> largestEntries = 0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mEntries.size(); ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] != 0) { <span class="comment">// skipping channels/pairs if they have zero entries (most likely they are simply off)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      mean += mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      ++nValid;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">if</span> (mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; smallestEntries) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        smallestEntries = mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        smallestElementIndex = <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">if</span> (mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; largestEntries) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        largestEntries = mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        largestElementIndex = <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span> (nValid == 0) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;hasEnough = false: all channels/pairs are empty&quot;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;mean = &quot;</span> &lt;&lt; mean &lt;&lt; <span class="stringliteral">&quot;, nvalid = &quot;</span> &lt;&lt; nValid;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  mean /= nValid;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;minElement is at position &quot;</span> &lt;&lt; smallestElementIndex &lt;&lt; <span class="stringliteral">&quot; and has &quot;</span> &lt;&lt; smallestEntries &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;maxElement is at position &quot;</span> &lt;&lt; largestElementIndex &lt;&lt; <span class="stringliteral">&quot; and has &quot;</span> &lt;&lt; largestEntries &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">float</span> threshold = minEntries + 5 * std::sqrt(minEntries);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">bool</span> enough = mean &lt; threshold ? false : <span class="keyword">true</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">if</span> (enough) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;hasEnough: &quot;</span> &lt;&lt; (<a class="code" href="../../df/d73/namespaceo2_1_1its_1_1gpu_1_1utils_1_1device.html#a4679f96aa931479958ac05d8c19002de">int</a>)enough &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;              &lt;&lt; nValid &lt;&lt; <span class="stringliteral">&quot; valid channels found (should be &quot;</span> &lt;&lt; mEntries.size() &lt;&lt; <span class="stringliteral">&quot;) with mean = &quot;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;              &lt;&lt; mean &lt;&lt; <span class="stringliteral">&quot; with cut at = &quot;</span> &lt;&lt; threshold &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">return</span> enough;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">  229</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">TOFChannelData::print</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Printing histograms:&quot;</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  std::ostringstream os;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isect = 0; isect &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a>; isect++) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Sector: &quot;</span> &lt;&lt; isect;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    os &lt;&lt; mHisto[isect];</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keyword">auto</span> nentriesInSec = <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">boost::histogram::algorithm::sum</a>(mHisto[isect]);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Number of entries in histogram: &quot;</span> &lt;&lt; <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">boost::histogram::algorithm::sum</a>(mHisto[isect]);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">int</span> cnt = 0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (nentriesInSec != 0) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> : indexed(mHisto[isect])) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &gt; 0) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(0); <span class="comment">// current index along first axis --&gt; t-texp</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(1); <span class="comment">// current index along second axis --&gt; channel</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> b0 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(0);  <span class="comment">// current bin interval along first axis --&gt; t-texp</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> b1 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(1);  <span class="comment">// current bin interval along second axis --&gt; channel</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;bin &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot;: channel = &quot;</span> &lt;&lt; <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> &lt;&lt; <span class="stringliteral">&quot; in [&quot;</span> &lt;&lt; b1.lower() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b1.upper()</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;], t-texp in [&quot;</span> &lt;&lt; b0.lower() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b0.upper() &lt;&lt; <span class="stringliteral">&quot;], has entries = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        cnt++;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; bins inspected&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ad1978708df097963b60d9ae805056522">  257</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">TOFChannelData::print</a>(<span class="keywordtype">int</span> isect)<span class="keyword"> const</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;*** Printing histogram &quot;</span> &lt;&lt; isect;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  std::ostringstream os;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">int</span> cnt = 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  os &lt;&lt; mHisto[isect];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Number of entries in histogram: &quot;</span> &lt;&lt; <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">boost::histogram::algorithm::sum</a>(mHisto[isect]);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> : indexed(mHisto[isect])) { <span class="comment">// does not work also when I use indexed(*(mHisto[sector]))</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    cnt++;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot; c &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; i &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(0) &lt;&lt; <span class="stringliteral">&quot; j &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(1) &lt;&lt; <span class="stringliteral">&quot; b0 &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(0) &lt;&lt; <span class="stringliteral">&quot; b1 &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(1) &lt;&lt; <span class="stringliteral">&quot; val= &quot;</span> &lt;&lt; *<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> &lt;&lt; <span class="stringliteral">&quot;|&quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &gt; 0) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;x = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &lt;&lt; <span class="stringliteral">&quot; c &quot;</span> &lt;&lt; cnt;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; bins inspected&quot;</span>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">  275</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">TOFChannelData::printEntries</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">// to print number of entries per channel</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mEntries.size(); ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (mEntries.size() &gt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">tof::Geo::NCHANNELS</a>) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;pair of channels &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;channel &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">  288</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">TOFChannelData::findBin</a>(<span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// find the bin along the x-axis (with t-texp) where the value &quot;v&quot; is; this does not depend on the channel</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// (axis 1), nor on the sector, so we use sector0</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> == mRange) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> -= 1.e-1;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;In FindBin, v = : &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;bin0 limits: lower = &quot;</span> &lt;&lt; mHisto[0].axis(0).bin(0).lower() &lt;&lt; <span class="stringliteral">&quot;, upper = &quot;</span> &lt;&lt; mHisto[0].axis(0).bin(0).upper();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;bin1000 limits: lower = &quot;</span> &lt;&lt; mHisto[0].axis(0).bin(mNBins - 1).lower() &lt;&lt; <span class="stringliteral">&quot;, upper = &quot;</span> &lt;&lt; mHisto[0].axis(0).bin(mNBins - 1).upper();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;v = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> &lt;&lt; <span class="stringliteral">&quot; is in bin &quot;</span> &lt;&lt; mHisto[0].axis(0).index(<a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">return</span> mHisto[0].axis(0).index(<a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">  306</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> chmin, <span class="keywordtype">int</span> chmax, <span class="keywordtype">float</span> binmin, <span class="keywordtype">float</span> binmax)<span class="keyword"> const</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// calculates the integral in [chmin, chmax] and in [binmin, binmax]</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">if</span> (binmin &lt; -mRange || binmax &gt; mRange || chmin &lt; 0 || chmax &gt;= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a> * mNElsPerSector) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;Check your bins, we cannot calculate the integrals in under/overflows bins&quot;</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">if</span> (binmax &lt; binmin || chmax &lt; chmin) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;Check your bin limits!&quot;</span>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">int</span> sector = chmin / mNElsPerSector;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (sector != chmax / mNElsPerSector) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;We cannot integrate over channels that belong to different sectors&quot;</span>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordtype">int</span> chinsectormin = chmin % mNElsPerSector;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">int</span> chinsectormax = chmax % mNElsPerSector;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">float</span> res2 = 0;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">//TStopwatch t3;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordtype">int</span> ind = -1;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordtype">int</span> binxmin = <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">findBin</a>(binmin);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">int</span> binxmax = <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">findBin</a>(binmax);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;binxmin = &quot;</span> &lt;&lt; binxmin &lt;&lt; <span class="stringliteral">&quot;, binxmax = &quot;</span> &lt;&lt; binxmax;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">//t3.Start();</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> = chinsectormin; <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> &lt;= chinsectormax; ++<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = binxmin; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= binxmax; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = mHisto[sector].at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      res2 += <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">//t3.Stop();</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Time for integral looping over axis (result = &quot;</span> &lt;&lt; res2 &lt;&lt; <span class="stringliteral">&quot;):&quot;</span>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">//t3.Print();</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">return</span> res2;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ab54e9116e5ad021b0a607dae077ccc72">  347</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch, <span class="keywordtype">float</span> binmin, <span class="keywordtype">float</span> binmax)<span class="keyword"> const</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in [binmin, binmax]</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ch, ch, binmin, binmax);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a77bc188925de89b48ee9b7b0e807b31e">  355</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> chmin, <span class="keywordtype">int</span> chmax, <span class="keywordtype">int</span> binxmin, <span class="keywordtype">int</span> binxmax)<span class="keyword"> const</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// calculates the integral in [chmin, chmax] and in [binmin, binmax]</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span> (binxmin &lt; 0 || binxmax &gt; mNBins || chmin &lt; 0 || chmax &gt;= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a> * mNElsPerSector) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;Check your bins, we cannot calculate the integrals in under/overflows bins&quot;</span>);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">if</span> (binxmax &lt; binxmin || chmax &lt; chmin) {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;Check your bin limits!&quot;</span>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordtype">int</span> sector = chmin / mNElsPerSector;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (sector != chmax / mNElsPerSector) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">std::runtime_error</a>(<span class="stringliteral">&quot;We cannot integrate over channels that belong to different sectors&quot;</span>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordtype">int</span> chinsectormin = chmin % mNElsPerSector;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordtype">int</span> chinsectormax = chmax % mNElsPerSector;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordtype">float</span> res2 = 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">//TStopwatch t3;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">//t3.Start();</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> = chinsectormin; <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> &lt;= chinsectormax; ++<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = binxmin; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= binxmax; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = mHisto[sector].at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      res2 += <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">//t3.Stop();</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Time for integral looping over axis (result = &quot;</span> &lt;&lt; res2 &lt;&lt; <span class="stringliteral">&quot;):&quot;</span>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">//t3.Print();</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">return</span> res2;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a9ae346a1679b7e611ddbeb5872c55ef3">  391</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch, <span class="keywordtype">int</span> binxmin, <span class="keywordtype">int</span> binxmax)<span class="keyword"> const</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in [binmin, binmax]</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ch, ch, binxmin, binxmax);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a7c50332d0130cb6aeda3e6358146fbe6">  399</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch)<span class="keyword"> const</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in the full x-range</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">return</span> mEntries.at(ch);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">//-------------------------------------------------------------------</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">// TOF Channel Calibrator</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">//-------------------------------------------------------------------</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a793ebcd2348a6f001258ce67d46e4517">  411</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a793ebcd2348a6f001258ce67d46e4517">TOFChannelCalibrator&lt;T&gt;::finalizeSlotWithCosmics</a>(<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a>&amp; slot)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="comment">// Extract results for the single slot</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a>* <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a> = slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">getContainer</a>();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Finalize slot for calibration with cosmics &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>() &lt;&lt; <span class="stringliteral">&quot; &lt;= TF &lt;= &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a1477ee455be0381a720a32610a5a87d7">getTFEnd</a>();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// for the CCDB entry</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  std::map&lt;std::string, std::string&gt; md;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">TimeSlewing</a>&amp; ts = mCalibTOFapi-&gt;getSlewParamObj(); <span class="comment">// we take the current CCDB object, since we want to simply update the offset</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                                     <span class="comment">//  ts.bind();</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">int</span> nbins = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getNbins();</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a> = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getRange();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  std::vector&lt;int&gt; entriesPerChannel = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getEntriesPerChannel();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">if</span> (mNThreads &lt; 1) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    mNThreads = <a class="code" href="../../d2/d0e/test__Algorithm_8cxx.html#ad0703ae2a355d516ebdb16176a805b61">std::min</a>(omp_get_max_threads(), NMAXTHREADS);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Number of threads that will be used = &quot;</span> &lt;&lt; mNThreads;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="preprocessor">#pragma omp parallel for schedule(dynamic) num_threads(mNThreads)</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  mNThreads = 1;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sector = 0; sector &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a>; sector++) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    TMatrixD mat(3, 3);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordtype">int</span> ithread = 0;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ithread = omp_get_thread_num();</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Processing sector &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; with thread &quot;</span> &lt;&lt; ithread;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordtype">double</span> xp[NCOMBINSTRIP], <a class="code" href="../../d2/d41/Detectors_2DCS_2src_2StringUtils_8cxx.html#ace2160f4712f738ceb0e0ee8c80fa04e">exp</a>[NCOMBINSTRIP], deltat[NCOMBINSTRIP], edeltat[NCOMBINSTRIP];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    std::array&lt;double, 3&gt; fitValues;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    std::vector&lt;float&gt; histoValues;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">auto</span>&amp; histo = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getHisto(sector);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">int</span> offsetPairInSector = sector * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a52f130aea4ceee8757a03e4adbefad92">Geo::NSTRIPXSECTOR</a> * NCOMBINSTRIP;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">int</span> offsetsector = sector * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a52f130aea4ceee8757a03e4adbefad92">Geo::NSTRIPXSECTOR</a> * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">Geo::NPADS</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> istrip = 0; istrip &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a52f130aea4ceee8757a03e4adbefad92">Geo::NSTRIPXSECTOR</a>; istrip++) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Processing strip &quot;</span> &lt;&lt; istrip;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordtype">double</span> fracUnderPeak[<a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">Geo::NPADS</a>] = {0.};</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keywordtype">bool</span> isChON[96] = {<span class="keyword">false</span>};</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordtype">int</span> offsetstrip = istrip * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">Geo::NPADS</a> + offsetsector;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordtype">int</span> goodpoints = 0;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordtype">int</span> allpoints = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      TLinearFitter localFitter(1, mStripOffsetFunction.c_str());</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordtype">int</span> offsetPairInStrip = istrip * NCOMBINSTRIP;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      localFitter.StoreData(kFALSE);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      localFitter.ClearPoints();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipair = 0; ipair &lt; NCOMBINSTRIP; ipair++) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordtype">int</span> chinsector = ipair + offsetPairInStrip;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordtype">int</span> ich = chinsector + offsetPairInSector;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keyword">auto</span> entriesInPair = entriesPerChannel.at(ich);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        xp[allpoints] = ipair + 0.5; <span class="comment">// pair index</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span> (entriesInPair == 0) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          localFitter.AddPoint(&amp;(xp[allpoints]), 0.0, 1.0);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          allpoints++;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          <span class="keywordflow">continue</span>; <span class="comment">// skip always since a channel with 0 entries is normal, it will be flagged as problematic</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span> (entriesInPair &lt; mMinEntries) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;pair &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; will not be calibrated since it has only &quot;</span> &lt;&lt; entriesInPair &lt;&lt; <span class="stringliteral">&quot; entries (min = &quot;</span> &lt;&lt; mMinEntries &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;          localFitter.AddPoint(&amp;(xp[allpoints]), 0.0, 1.0);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          allpoints++;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        fitValues.fill(-99999999);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        histoValues.clear();</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="comment">// make the slice of the 2D histogram so that we have the 1D of the current channel</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nbins; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = histo.at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, chinsector);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;channel = &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot;, in sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; (where it is channel = &quot;</span> &lt;&lt; chinsector &lt;&lt; <span class="stringliteral">&quot;) bin = &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; value = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          histoValues.push_back(<a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordtype">double</span> fitres = entriesInPair - 1;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        fitres = <a class="code" href="../../d9/d2e/namespaceo2_1_1math__utils.html#af85a79f8b3ca6ee6051c80fb6e23bf5b">fitGaus</a>(nbins, histoValues.data(), -<a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a>, fitValues, <span class="keyword">nullptr</span>, 2., <span class="keyword">true</span>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> (fitres &gt;= 0) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Pair &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit result &quot;</span> &lt;&lt; fitres &lt;&lt; <span class="stringliteral">&quot; Mean = &quot;</span> &lt;&lt; fitValues[1] &lt;&lt; <span class="stringliteral">&quot; Sigma = &quot;</span> &lt;&lt; fitValues[2];</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Pair &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit failed with result = &quot;</span> &lt;&lt; fitres;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          localFitter.AddPoint(&amp;(xp[allpoints]), 0.0, 1.0);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          allpoints++;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">if</span> (fitValues[2] &lt; 0) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          fitValues[2] = -fitValues[2];</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordtype">float</span> intmin = fitValues[1] - 5 * fitValues[2]; <span class="comment">// mean - 5*sigma</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordtype">float</span> intmax = fitValues[1] + 5 * fitValues[2]; <span class="comment">// mean + 5*sigma</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> (intmin &lt; -mRange) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          intmin = -mRange;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">if</span> (intmax &lt; -mRange) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          intmax = -mRange;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (intmin &gt; mRange) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          intmin = mRange;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span> (intmax &gt; mRange) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          intmax = mRange;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        xp[allpoints] = ipair + 0.5;      <span class="comment">// pair index</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="../../d2/d41/Detectors_2DCS_2src_2StringUtils_8cxx.html#ace2160f4712f738ceb0e0ee8c80fa04e">exp</a>[allpoints] = 0.0;             <span class="comment">// error on pair index (dummy since it is on the pair index)</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        deltat[allpoints] = fitValues[1]; <span class="comment">// delta between offsets from channels in pair (from the fit) - in ps</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordtype">float</span> integral = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;integral(ich, intmin, intmax);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        edeltat[allpoints] = 20 + fitValues[2] / sqrt(integral); <span class="comment">// TODO: for now put by default to 20 ps since it was seen to be reasonable; but it should come from the fit: who gives us the error from the fit ??????</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        localFitter.AddPoint(&amp;(xp[allpoints]), deltat[allpoints], edeltat[allpoints]);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        goodpoints++;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        allpoints++;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordtype">int</span> ch1 = ipair % 96;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordtype">int</span> ch2 = ipair / 96 ? ch1 + 48 : ch1 + 1;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        isChON[ch1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        isChON[ch2] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordtype">float</span> fractionUnderPeak = entriesInPair &gt; 0 ? integral / entriesInPair : 0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="comment">// we keep as fractionUnderPeak of the channel the largest one that is found in the 3 possible pairs with that channel (for both channels ch1 and ch2 in the pair)</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">if</span> (fracUnderPeak[ch1] &lt; fractionUnderPeak) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;          fracUnderPeak[ch1] = fractionUnderPeak;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">if</span> (fracUnderPeak[ch2] &lt; fractionUnderPeak) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          fracUnderPeak[ch2] = fractionUnderPeak;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">//        mFitCal-&gt;Fill(ipair + offsetPairInStrip + offsetPairInSector, fitValues[1]);</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      } <span class="comment">// end loop pairs</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">// fit strip offset</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> (goodpoints == 0) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;We found &quot;</span> &lt;&lt; goodpoints &lt;&lt; <span class="stringliteral">&quot; good points for strip &quot;</span> &lt;&lt; istrip &lt;&lt; <span class="stringliteral">&quot; in sector &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; --&gt; we can fit the TGraph&quot;</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordtype">bool</span> isFirst = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordtype">int</span> nparams = 0;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;N parameters before fixing = &quot;</span> &lt;&lt; localFitter.GetNumberFreeParameters();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// we fix to zero the parameters that have no entry, plus the first one that we find, which we will use as reference for the other offsets</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 96; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (isChON[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          <span class="keywordflow">if</span> (isFirst) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            localFitter.FixParameter(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0.);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            isFirst = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            nparams++;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          localFitter.FixParameter(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0.);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Strip = &quot;</span> &lt;&lt; istrip &lt;&lt; <span class="stringliteral">&quot; fitted by thread = &quot;</span> &lt;&lt; ithread &lt;&lt; <span class="stringliteral">&quot;, goodpoints = &quot;</span> &lt;&lt; goodpoints &lt;&lt; <span class="stringliteral">&quot;, number of free parameters = &quot;</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                 &lt;&lt; localFitter.GetNumberFreeParameters() &lt;&lt; <span class="stringliteral">&quot;,  NDF = &quot;</span> &lt;&lt; goodpoints - localFitter.GetNumberFreeParameters();</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">if</span> (goodpoints &lt;= localFitter.GetNumberFreeParameters()) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Skipped&quot;</span>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;N real params = &quot;</span> &lt;&lt; nparams &lt;&lt; <span class="stringliteral">&quot;, fitter has &quot;</span> &lt;&lt; localFitter.GetNumberFreeParameters() &lt;&lt; <span class="stringliteral">&quot; free parameters, &quot;</span> &lt;&lt; localFitter.GetNumberTotalParameters() &lt;&lt; <span class="stringliteral">&quot; total parameters, &quot;</span> &lt;&lt; localFitter.GetNpoints() &lt;&lt; <span class="stringliteral">&quot; points&quot;</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot;, strip = &quot;</span> &lt;&lt; istrip &lt;&lt; <span class="stringliteral">&quot; fitted by thread = &quot;</span> &lt;&lt; ithread &lt;&lt; <span class="stringliteral">&quot;: ready to fit&quot;</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      localFitter.Eval();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot;, strip = &quot;</span> &lt;&lt; istrip &lt;&lt; <span class="stringliteral">&quot; fitted by thread = &quot;</span> &lt;&lt; ithread &lt;&lt; <span class="stringliteral">&quot; with Chi/NDF &quot;</span> &lt;&lt; localFitter.GetChisquare() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; goodpoints - localFitter.GetNumberFreeParameters();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Strip = &quot;</span> &lt;&lt; istrip &lt;&lt; <span class="stringliteral">&quot; fitted by thread = &quot;</span> &lt;&lt; ithread &lt;&lt; <span class="stringliteral">&quot; with Chi/NDF &quot;</span> &lt;&lt; localFitter.GetChisquare() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; goodpoints - localFitter.GetNumberFreeParameters();</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">//      if(localFitter.GetChisquare() &gt; (goodpoints - localFitter.GetNumberFreeParameters())*10){</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">//        continue;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="comment">//      }</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">//update calibrations</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ichLocal = 0; ichLocal &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">Geo::NPADS</a>; ichLocal++) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordtype">int</span> ich = ichLocal + offsetstrip;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#acd835969d557e482e85fb2c58c490283">updateOffsetInfo</a>(ich, localFitter.GetParameter(ichLocal));</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        mFitCal-&gt;Fill(ich, localFitter.GetParameter(ichLocal));</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">setFractionUnderPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, fracUnderPeak[ichLocal]);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">setSigmaPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, abs(std::sqrt(localFitter.GetCovarianceMatrixElement(ichLocal, ichLocal))));</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    } <span class="comment">// end loop strips</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  }   <span class="comment">// end loop sectors</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keyword">auto</span> clName = <a class="code" href="../../d5/d71/structo2_1_1utils_1_1MemFileHelper.html#a27bc03604b90439a4dfb28c59dc01e91">o2::utils::MemFileHelper::getClassName</a>(ts);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">auto</span> flName = <a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0f9cdb198ea393fdad982b8452510ad5">o2::ccdb::CcdbApi::generateFileName</a>(clName);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  mInfoVector.emplace_back(<span class="stringliteral">&quot;TOF/Calib/ChannelCalib&quot;</span>, clName, flName, md, slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>(), 99999999999999);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  mTimeSlewingVector.emplace_back(ts);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  TFile fout(<span class="stringliteral">&quot;debug_tof_cal.root&quot;</span>, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  mFitCal-&gt;Write();</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  mChannelDist-&gt;Write();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  fout.Close();</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48478b9bfade98b4b196b942383da672">  626</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48478b9bfade98b4b196b942383da672">TOFChannelCalibrator&lt;T&gt;::finalizeSlotWithTracks</a>(<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a>&amp; slot)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// Extract results for the single slot</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a>* <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a> = slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">getContainer</a>();</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Finalize slot &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>() &lt;&lt; <span class="stringliteral">&quot; &lt;= TF &lt;= &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a1477ee455be0381a720a32610a5a87d7">getTFEnd</a>();</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordtype">int</span> nbins = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getNbins();</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a> = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getRange();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  std::vector&lt;int&gt; entriesPerChannel = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getEntriesPerChannel();</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// for the CCDB entry</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  std::map&lt;std::string, std::string&gt; md;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">TimeSlewing</a>&amp; ts = mCalibTOFapi-&gt;getSlewParamObj(); <span class="comment">// we take the current CCDB object, since we want to simply update the offset</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">//  ts.bind();</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordflow">if</span> (mNThreads &lt; 1) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    mNThreads = <a class="code" href="../../d2/d0e/test__Algorithm_8cxx.html#ad0703ae2a355d516ebdb16176a805b61">std::min</a>(omp_get_max_threads(), NMAXTHREADS);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;Number of threads that will be used = &quot;</span> &lt;&lt; mNThreads;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">#pragma omp parallel for schedule(dynamic) num_threads(mNThreads)</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  mNThreads = 1;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sector = 0; sector &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">Geo::NSECTORS</a>; sector++) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    TMatrixD mat(3, 3);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordtype">int</span> ithread = 0;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    ithread = omp_get_thread_num();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Processing sector &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; with thread &quot;</span> &lt;&lt; ithread;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keyword">auto</span>&amp; histo = <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;getHisto(sector);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    std::array&lt;double, 3&gt; fitValues;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    std::vector&lt;float&gt; histoValues;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> chinsector = 0; chinsector &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>; chinsector++) {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">// make the slice of the 2D histogram so that we have the 1D of the current channel</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordtype">int</span> ich = chinsector + sector * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keyword">auto</span> entriesInChannel = entriesPerChannel.at(ich);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (entriesInChannel == 0) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// skip always since a channel with 0 entries is normal, it will be flagged as problematic</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">if</span> (entriesInChannel &lt; mMinEntries) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; will not be calibrated since it has only &quot;</span> &lt;&lt; entriesInChannel &lt;&lt; <span class="stringliteral">&quot; entries (min = &quot;</span> &lt;&lt; mMinEntries &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; will be calibrated since it has &quot;</span> &lt;&lt; entriesInChannel &lt;&lt; <span class="stringliteral">&quot; entries (min = &quot;</span> &lt;&lt; mMinEntries &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      fitValues.fill(-99999999);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      histoValues.clear();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">// more efficient way</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> = chinsector; <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a> &lt;= chinsector; ++<a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>) {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nbins; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = histo.at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;channel = &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot;, in sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; (where it is channel = &quot;</span> &lt;&lt; chinsector &lt;&lt; <span class="stringliteral">&quot;) bin = &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; value = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          histoValues.push_back(<a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordtype">double</span> fitres = <a class="code" href="../../d9/d2e/namespaceo2_1_1math__utils.html#af85a79f8b3ca6ee6051c80fb6e23bf5b">fitGaus</a>(nbins, histoValues.data(), -<a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a>, fitValues, <span class="keyword">nullptr</span>, 2., <span class="keyword">true</span>);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;channel = &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; fitted by thread = &quot;</span> &lt;&lt; ithread;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">if</span> (fitres &gt;= 0) {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit result &quot;</span> &lt;&lt; fitres &lt;&lt; <span class="stringliteral">&quot; Mean = &quot;</span> &lt;&lt; fitValues[1] &lt;&lt; <span class="stringliteral">&quot; Sigma = &quot;</span> &lt;&lt; fitValues[2];</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit failed with result = &quot;</span> &lt;&lt; fitres;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">setFractionUnderPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, -1);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">setSigmaPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, 99999);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (fitValues[2] &lt; 0) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        fitValues[2] = -fitValues[2];</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="keywordtype">float</span> fractionUnderPeak;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordtype">float</span> intmin = fitValues[1] - 5 * fitValues[2]; <span class="comment">// mean - 5*sigma</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordtype">float</span> intmax = fitValues[1] + 5 * fitValues[2]; <span class="comment">// mean + 5*sigma</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">if</span> (intmin &lt; -mRange) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        intmin = -mRange;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">if</span> (intmax &lt; -mRange) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        intmax = -mRange;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">if</span> (intmin &gt; mRange) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        intmin = mRange;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="keywordflow">if</span> (intmax &gt; mRange) {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        intmax = mRange;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      fractionUnderPeak = entriesInChannel &gt; 0 ? <a class="code" href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a>-&gt;integral(ich, intmin, intmax) / entriesInChannel : 0;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="comment">// now we need to store the results in the TimeSlewingObject</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">setFractionUnderPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, fractionUnderPeak);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">setSigmaPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">Geo::NPADSXSECTOR</a>, abs(fitValues[2]));</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#acd835969d557e482e85fb2c58c490283">updateOffsetInfo</a>(ich, fitValues[1]);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      mFitCal-&gt;Fill(ich, fitValues[1]);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a>) &lt;&lt; <span class="stringliteral">&quot;udpdate channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; fitValues[1] &lt;&lt; <span class="stringliteral">&quot; offset in ps&quot;</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    } <span class="comment">// end loop channels in sector</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  }   <span class="comment">// end loop over sectors</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keyword">auto</span> clName = <a class="code" href="../../d5/d71/structo2_1_1utils_1_1MemFileHelper.html#a27bc03604b90439a4dfb28c59dc01e91">o2::utils::MemFileHelper::getClassName</a>(ts);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keyword">auto</span> flName = <a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0f9cdb198ea393fdad982b8452510ad5">o2::ccdb::CcdbApi::generateFileName</a>(clName);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  mInfoVector.emplace_back(<span class="stringliteral">&quot;TOF/Calib/ChannelCalib&quot;</span>, clName, flName, md, slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>(), 99999999999999);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  mTimeSlewingVector.emplace_back(ts);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="preprocessor">#ifdef DEBUGGING</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  TFile fout(<span class="stringliteral">&quot;debug_tof_cal.root&quot;</span>, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  mFitCal-&gt;Write();</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  mChannelDist-&gt;Write();</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  fout.Close();</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <a class="code" href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#ac34bb5516ada721d97d3b2bbf34d28f4">Utils::printFillScheme</a>();</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">//_____________________________________________</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html">TOFChannelCalibrator&lt;o2::dataformats::CalibInfoTOF&gt;</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html">TOFChannelCalibrator&lt;o2::tof::CalibInfoCluster&gt;</a>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;} <span class="comment">// end namespace tof</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;} <span class="comment">// end namespace o2</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00055">TOFChannelCalibrator.h:55</a></div></div>
<div class="ttc" id="aclasso2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">o2::dataformats::CalibTimeSlewingParamTOF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00026">CalibTimeSlewingParamTOF.h:26</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tof_html"><div class="ttname"><a href="../../d7/dae/namespaceo2_1_1tof.html">o2::tof</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbc/SimTraits_8h_source.html#l00120">SimTraits.h:120</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a614156c60d17bc95b9e04ea0f93a96f2"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">o2::tof::TOFChannelData::integral</a></div><div class="ttdeci">float integral(int chmin, int chmax, float binmin, float binmax) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00306">TOFChannelCalibrator.cxx:306</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a870978c60ce50506bf2737d65ad20cda"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">o2::tof::TOFChannelData::findBin</a></div><div class="ttdeci">int findBin(float v) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00288">TOFChannelCalibrator.cxx:288</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_ae6857148899e64edd5017e78eea7c0ca"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">o2::tof::TOFChannelData::merge</a></div><div class="ttdeci">void merge(const TOFChannelData *prev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00167">TOFChannelCalibrator.cxx:167</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a4568fc090febc136eed4577a600739ca"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a></div><div class="ttdeci">const GLdouble * v</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00832">glcorearb.h:832</a></div></div>
<div class="ttc" id="aclasso2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_aa7c651da6f6e5fe8a5fa4b43788d6153"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">o2::dataformats::CalibTimeSlewingParamTOF::setFractionUnderPeak</a></div><div class="ttdeci">void setFractionUnderPeak(int sector, int channel, float value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00076">CalibTimeSlewingParamTOF.h:76</a></div></div>
<div class="ttc" id="aGPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00412">GPUCommonAlgorithm.h:412</a></div></div>
<div class="ttc" id="aclasso2_1_1ccdb_1_1CcdbApi_html_a0f9cdb198ea393fdad982b8452510ad5"><div class="ttname"><a href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0f9cdb198ea393fdad982b8452510ad5">o2::ccdb::CcdbApi::generateFileName</a></div><div class="ttdeci">static std::string generateFileName(const std::string &amp;inp)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5f/CcdbApi_8cxx_source.html#l00536">CcdbApi.cxx:536</a></div></div>
<div class="ttc" id="aclasso2_1_1calibration_1_1TimeSlot_html_a1477ee455be0381a720a32610a5a87d7"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a1477ee455be0381a720a32610a5a87d7">o2::calibration::TimeSlot::getTFEnd</a></div><div class="ttdeci">TFType getTFEnd() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00048">TimeSlot.h:48</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelCalibrator_html_a48478b9bfade98b4b196b942383da672"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48478b9bfade98b4b196b942383da672">o2::tof::TOFChannelCalibrator::finalizeSlotWithTracks</a></div><div class="ttdeci">void finalizeSlotWithTracks(Slot &amp;slot)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00626">TOFChannelCalibrator.cxx:626</a></div></div>
<div class="ttc" id="aclasso2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_a340c4b8fb43facc2f938bbb46aca75ca"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">o2::dataformats::CalibTimeSlewingParamTOF::setSigmaPeak</a></div><div class="ttdeci">void setSigmaPeak(int sector, int channel, float value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00077">CalibTimeSlewingParamTOF.h:77</a></div></div>
<div class="ttc" id="anamespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00023">BitstreamReader.h:23</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a06add85eec10c887c41817a821735a5a"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">o2::tof::TOFChannelData::fill</a></div><div class="ttdeci">void fill(const gsl::span&lt; const o2::dataformats::CalibInfoTOF &gt; data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00039">TOFChannelCalibrator.cxx:39</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelCalibrator_html"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html">o2::tof::TOFChannelCalibrator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00140">TOFChannelCalibrator.h:140</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a91d2245fae116e7ebde1de0d43e9b062"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">o2::tof::TOFChannelData::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00229">TOFChannelCalibrator.cxx:229</a></div></div>
<div class="ttc" id="anamespaceo2_1_1its_1_1gpu_1_1utils_1_1device_html_a4679f96aa931479958ac05d8c19002de"><div class="ttname"><a href="../../df/d73/namespaceo2_1_1its_1_1gpu_1_1utils_1_1device.html#a4679f96aa931479958ac05d8c19002de">o2::its::gpu::utils::device::int</a></div><div class="ttdeci">const int</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d27/Detectors_2ITSMFT_2ITS_2tracking_2GPU_2ITStrackingGPU_2Utils_8h_source.html#l00061">Utils.h:61</a></div></div>
<div class="ttc" id="aGPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00056">GPUCommonLogger.h:56</a></div></div>
<div class="ttc" id="aTOFChannelCalibrator_8h_html"><div class="ttname"><a href="../../db/dc2/TOFChannelCalibrator_8h.html">TOFChannelCalibrator.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Geo_html_ab8ab3733fc270083bb053f638332c733"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">o2::tof::Geo::NCHANNELS</a></div><div class="ttdeci">static constexpr int NCHANNELS</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/TOF_2base_2include_2TOFBase_2Geo_8h_source.html#l00122">Geo.h:122</a></div></div>
<div class="ttc" id="aLogger_8h_html"><div class="ttname"><a href="../../dd/da4/Logger_8h.html">Logger.h</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a0d278f986cbaae17e4af336f2431f89f"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a0d278f986cbaae17e4af336f2431f89f">o2::tof::TOFChannelData::NCOMBINSTRIP</a></div><div class="ttdeci">static constexpr int NCOMBINSTRIP</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00063">TOFChannelCalibrator.h:63</a></div></div>
<div class="ttc" id="atest__Algorithm_8cxx_html_ad0703ae2a355d516ebdb16176a805b61"><div class="ttname"><a href="../../d2/d0e/test__Algorithm_8cxx.html#ad0703ae2a355d516ebdb16176a805b61">min</a></div><div class="ttdeci">const size_t min</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0e/test__Algorithm_8cxx_source.html#l00043">test_Algorithm.cxx:43</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_aef2b3470d9c23d365364d3060d5f68a0"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">o2::tpc::sum</a></div><div class="ttdeci">DataT sum(const Vector&lt; DataT, N &gt; &amp;a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d54/TPC_2spacecharge_2include_2TPCSpaceCharge_2Vector_8h_source.html#l00138">Vector.h:138</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelCalibrator_html_a793ebcd2348a6f001258ce67d46e4517"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a793ebcd2348a6f001258ce67d46e4517">o2::tof::TOFChannelCalibrator::finalizeSlotWithCosmics</a></div><div class="ttdeci">void finalizeSlotWithCosmics(Slot &amp;slot)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00411">TOFChannelCalibrator.cxx:411</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Utils_html_ac34bb5516ada721d97d3b2bbf34d28f4"><div class="ttname"><a href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#ac34bb5516ada721d97d3b2bbf34d28f4">o2::tof::Utils::printFillScheme</a></div><div class="ttdeci">static void printFillScheme()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d61/Detectors_2TOF_2base_2src_2Utils_8cxx_source.html#l00099">Utils.cxx:99</a></div></div>
<div class="ttc" id="anamespaceo2_1_1math__utils_html_af85a79f8b3ca6ee6051c80fb6e23bf5b"><div class="ttname"><a href="../../d9/d2e/namespaceo2_1_1math__utils.html#af85a79f8b3ca6ee6051c80fb6e23bf5b">o2::math_utils::fitGaus</a></div><div class="ttdeci">Double_t fitGaus(const size_t nBins, const T *arr, const T xMin, const T xMax, std::vector&lt; T &gt; &amp;param)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d71/fit_8h_source.html#l00231">fit.h:231</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_a1777d0fe702c095d9819568246bc63cf"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a1777d0fe702c095d9819568246bc63cf">o2::tof::TOFChannelData::getHisto</a></div><div class="ttdeci">boostHisto &amp; getHisto(int isect)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00109">TOFChannelCalibrator.h:109</a></div></div>
<div class="ttc" id="aVariantJSONHelpers_8h_html_a92b9653745b1ddd58664de621c944ba2"><div class="ttname"><a href="../../d9/d86/VariantJSONHelpers_8h.html#a92b9653745b1ddd58664de621c944ba2">debug</a></div><div class="ttdeci">std::ostringstream debug</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d86/VariantJSONHelpers_8h_source.html#l00303">VariantJSONHelpers.h:303</a></div></div>
<div class="ttc" id="anamespaceo2_1_1framework_html_a08b2ccf173a847e0fd176f8af57da8a1"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#a08b2ccf173a847e0fd176f8af57da8a1">o2::framework::runtime_error</a></div><div class="ttdeci">RuntimeErrorRef runtime_error(const char *)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/RuntimeError_8cxx_source.html#l00073">RuntimeError.cxx:73</a></div></div>
<div class="ttc" id="aclasso2_1_1calibration_1_1TimeSlot_html_a6d93b6aefa753710338dc444293e2f69"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">o2::calibration::TimeSlot::getContainer</a></div><div class="ttdeci">const Container * getContainer() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00049">TimeSlot.h:49</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Geo_html_a52f130aea4ceee8757a03e4adbefad92"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a52f130aea4ceee8757a03e4adbefad92">o2::tof::Geo::NSTRIPXSECTOR</a></div><div class="ttdeci">static constexpr Int_t NSTRIPXSECTOR</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/TOF_2base_2include_2TOFBase_2Geo_8h_source.html#l00114">Geo.h:114</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Geo_html_a926ba139cfed8d51e3f31a7fa840a25f"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a></div><div class="ttdeci">static constexpr Int_t NPADSXSECTOR</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/TOF_2base_2include_2TOFBase_2Geo_8h_source.html#l00116">Geo.h:116</a></div></div>
<div class="ttc" id="aRawData_8h_html_a5ee9234d389c6be7f0a75b450da09722"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#a5ee9234d389c6be7f0a75b450da09722">j</a></div><div class="ttdeci">uint32_t j</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d62/RawData_8h_source.html#l00314">RawData.h:314</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Utils_html_a41fb6a309fd255c39d87453254492034"><div class="ttname"><a href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#a41fb6a309fd255c39d87453254492034">o2::tof::Utils::addCalibTrack</a></div><div class="ttdeci">static void addCalibTrack(float time)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d61/Detectors_2TOF_2base_2src_2Utils_8cxx_source.html#l00062">Utils.cxx:62</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a8922a680b00df660c57f47c1971d04c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00298">glcorearb.h:298</a></div></div>
<div class="ttc" id="aclasso2_1_1calibration_1_1TimeSlot_html_aeb4ac27a93d80114f40a046b1d213ee7"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">o2::calibration::TimeSlot::getTFStart</a></div><div class="ttdeci">TFType getTFStart() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00047">TimeSlot.h:47</a></div></div>
<div class="ttc" id="aclasso2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_acd835969d557e482e85fb2c58c490283"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#acd835969d557e482e85fb2c58c490283">o2::dataformats::CalibTimeSlewingParamTOF::updateOffsetInfo</a></div><div class="ttdeci">bool updateOffsetInfo(int channel, float residualOffset)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d93/CalibTimeSlewingParamTOF_8cxx_source.html#l00147">CalibTimeSlewingParamTOF.cxx:147</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_aec9a4bf9c9cd1a976392f5ee9c0ef343"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">o2::tof::TOFChannelData::hasEnoughData</a></div><div class="ttdeci">bool hasEnoughData(int minEntries) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00179">TOFChannelCalibrator.cxx:179</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Geo_html_a5d8b7a738f21dab9a08dc53c5de6d5fe"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a5d8b7a738f21dab9a08dc53c5de6d5fe">o2::tof::Geo::NPADS</a></div><div class="ttdeci">static constexpr Int_t NPADS</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/TOF_2base_2include_2TOFBase_2Geo_8h_source.html#l00108">Geo.h:108</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1TOFChannelData_html_af539ee62d5961e7895bad7a627b20f89"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">o2::tof::TOFChannelData::printEntries</a></div><div class="ttdeci">void printEntries() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00275">TOFChannelCalibrator.cxx:275</a></div></div>
<div class="ttc" id="astructo2_1_1calibration_1_1Utils_html"><div class="ttname"><a href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">o2::calibration::Utils</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de0/Detectors_2Calibration_2include_2DetectorsCalibration_2Utils_8h_source.html#l00034">Utils.h:34</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1CalibTOFapi_html_a785c71a70e06703e36dd6d4d08581449"><div class="ttname"><a href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">o2::tof::CalibTOFapi::getTimeCalibration</a></div><div class="ttdeci">float getTimeCalibration(int ich, float tot)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d35/CalibTOFapi_8cxx_source.html#l00247">CalibTOFapi.cxx:247</a></div></div>
<div class="ttc" id="aclasso2_1_1calibration_1_1TimeSlot_html"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">o2::calibration::TimeSlot</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00029">TimeSlot.h:29</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a73b00379db2c7ac5e30a3aa2954a50ee"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a73b00379db2c7ac5e30a3aa2954a50ee">range</a></div><div class="ttdeci">GLenum GLint * range</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01899">glcorearb.h:1899</a></div></div>
<div class="ttc" id="astructo2_1_1utils_1_1MemFileHelper_html_a27bc03604b90439a4dfb28c59dc01e91"><div class="ttname"><a href="../../d5/d71/structo2_1_1utils_1_1MemFileHelper.html#a27bc03604b90439a4dfb28c59dc01e91">o2::utils::MemFileHelper::getClassName</a></div><div class="ttdeci">static std::string getClassName(const T &amp;obj)</div><div class="ttdoc">get the class name of the object</div><div class="ttdef"><b>Definition:</b> <a href="../../da/db7/MemFileHelper_8h_source.html#l00038">MemFileHelper.h:38</a></div></div>
<div class="ttc" id="aDetectors_2DCS_2src_2StringUtils_8cxx_html_ace2160f4712f738ceb0e0ee8c80fa04e"><div class="ttname"><a href="../../d2/d41/Detectors_2DCS_2src_2StringUtils_8cxx.html#ace2160f4712f738ceb0e0ee8c80fa04e">exp</a></div><div class="ttdeci">uint64_t exp(uint64_t base, uint8_t exp) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d41/Detectors_2DCS_2src_2StringUtils_8cxx_source.html#l00192">StringUtils.cxx:192</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Utils_html_a5f452177904878a16144ade530f21e93"><div class="ttname"><a href="../../d5/d2e/classo2_1_1tof_1_1Utils.html#a5f452177904878a16144ade530f21e93">o2::tof::Utils::mLHCPhase</a></div><div class="ttdeci">static float mLHCPhase</div><div class="ttdef"><b>Definition:</b> <a href="../../df/da4/Detectors_2TOF_2base_2include_2TOFBase_2Utils_8h_source.html#l00057">Utils.h:57</a></div></div>
<div class="ttc" id="aRawData_8h_html_aaf5d342e977c5857e99310eea0e72e4b"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#aaf5d342e977c5857e99310eea0e72e4b">c</a></div><div class="ttdeci">uint32_t c</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d62/RawData_8h_source.html#l00316">RawData.h:316</a></div></div>
<div class="ttc" id="aclasso2_1_1tof_1_1Geo_html_a1b8f91c6018f30830cdb591dc84244bb"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">o2::tof::Geo::NSECTORS</a></div><div class="ttdeci">static constexpr Int_t NSECTORS</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/TOF_2base_2include_2TOFBase_2Geo_8h_source.html#l00118">Geo.h:118</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_577c839d346a264df4e9e588ca2a45dd.html">TOF</a></li><li class="navelem"><a class="el" href="../../dir_7559d374f7e4089a12282edb4b89411f.html">calibration</a></li><li class="navelem"><a class="el" href="../../dir_433e21cb2528786b2d3a126cc8ab6bdb.html">src</a></li><li class="navelem"><a class="el" href="../../d9/dff/TOFChannelCalibrator_8cxx.html">TOFChannelCalibrator.cxx</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:40:53 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
