<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: PHOS Calibration</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/d8d/refDetectorsPHOScalibration.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PHOS Calibration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>PHOS calibration objects (see DataDormats/Detectors/PHOS/)</h1>
<p>The following objects are used for PHOS calibration </p><h2><a class="el" href="../../d9/d1f/classPedestals.html" title="CCDB container for the full set of CPV calibration coefficients.">Pedestals</a></h2>
<p>Calculated during dedicate runs with and used for FEE configuration in later physics runs</p>
<h2><a class="el" href="../../da/daa/classCalibParams.html" title="CCDB container for the full set of CPV calibration coefficients.">CalibParams</a></h2>
<p>Include channel-by channel gain parameters, High Gain/Low Gain ratio and time offsets for High Gain and Low Gain channels separately.</p>
<h2>TriggerMap</h2>
<p>Object contains trigger bad map and 14 parameterizations of L0 turn-on curves (one for each DDL)</p>
<h2>Runbyrun</h2>
<p>Time-dependent energy scale corrections, one number per module (plus uncertainty of the fitting procedure)</p>
<h2>BadChannelsMap</h2>
<p>Bad channels map used in reconstruction and simulation. Caclulated by combining inputs from pedestal, noisy, LED and physics runs and DCS configuration</p>
<h1>Calibration procedures</h1>
<h2>Pedestal calculation</h2>
<p>Dedicated pedestal runs (trigger rate ~10 Hz) and length ~100 s to collect ~1000 events. Analyzed with class PHOSPedestalCalibDevice which uses as input vector of <a class="el" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html">o2::phos::Cell</a>, produced with raw to cell converted with option &ndash;pedestal. In this conficuration Cell::Energy contains mean and Cell::Time contains RMS of pedestal. </p><div class="fragment"><div class="line">o2-raw-file-reader-workflow --input-conf PHSraw.cfg |</div>
<div class="line">o2-phos-reco-workflow --input-type raw --output-type cells --disable-root-output --pedestal on |</div>
<div class="line">o2-phos-calib-workflow --pedestals</div>
</div><!-- fragment --><h1>High Gain/Low Gain ratio calculation</h1>
<p>Dedicated LED runs (trigger rate ~1000 Hz) and length ~100 s to collect 10^5 events. Analyzed with class PHOSHGLGRatioCalibDevice which uses output of standard reconstruction but wich switched off merging of HG and LG channels: </p><div class="fragment"><div class="line">o2-raw-file-reader-workflow --input-conf PHSraw.cfg |</div>
<div class="line">o2-phos-reco-workflow --input-type raw --output-type cells --disable-root-output --keepHGLG on |</div>
<div class="line">o2-phos-calib-workflow --hglgratio</div>
</div><!-- fragment --><h2>Turn-on curve and trigger bad map calculation</h2>
<p>Run over physics run, selecting events not marked as PHOS L0 trigger. Performed with classes PHOSTurnonCalibDevice and PHOSTurnonCalibrator. Stores transient object to CCDB if sufficient statistics not collected yet or calculates TriggerMap objects and stores it at CCDB. Uses list of Cells and FullClusters as input. Running on MC digits </p><div class="fragment"><div class="line">o2-phos-reco-workflow --input-type digits --output-type cells --disable-root-output |</div>
<div class="line">o2-phos-reco-workflow --input-type cells --output-type clusters --fullclu-output --disable-root-output --disable-root-input |</div>
<div class="line">o2-phos-calib-workflow  --turnon</div>
</div><!-- fragment --><h2>Run-by-run correction</h2>
<p>Calculated pi0 peak position in each module in current run (or equivavlt period). Use list of FullClusters as input and produce 8 numbers: peak position and fit uncertainties for each module. Run as </p><div class="fragment"><div class="line">o2-phos-reco-workflow --input-type digits --output-type cells --disable-root-output |</div>
<div class="line">o2-phos-reco-workflow --input-type cells --output-type clusters --fullclu-output --disable-root-output --disable-root-input |</div>
<div class="line">o2-phos-calib-workflow  --runbyrun</div>
</div><!-- fragment --><h2>Energy and time calibration</h2>
<p>Relative energy scale per channel and time offsets for High Gain and Low Gain channels is calculated with iterative procedure. At the first step physics (better PHOS triggered) data are scanned and list of digits contributed to PHOS clusters are stored in local root files on EPN. digits are packed as std::vector&lt;uint32_t&gt; and simutaneously a list of inv. mass and time histograms are filled. Then new calibration coefficients are calculated from collected histograms and list of clusters re-scanned with new calibration. Few (~5) iterations is necessary to reach final accuracy. First scan is ran as </p><div class="fragment"><div class="line">o2-phos-reco-workflow --input-type digits --output-type cells --disable-root-output |</div>
<div class="line">o2-phos-reco-workflow --input-type cells --output-type clusters --fullclu-output --disable-root-output --disable-root-input |</div>
<div class="line">o2-phos-calib-workflow --not-use-ccdb --energy</div>
</div><!-- fragment --><h2>Bad map calculation</h2>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../da/d80/refDetectorsPHOS.html">PHOS</a></li>
    <li class="footer">Generated on Mon Feb 14 2022 05:41:08 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
